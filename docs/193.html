<html>
<head>
<title>Useful Sudoers configurations for setting ‘sudo’ in Linux | ElderNode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Linux | ElderNode博客中设置“sudo”的有用Sudoers配置</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/sudoers-configurations-setting-sudo/#0001-01-01">https://blog.eldernode.com/sudoers-configurations-setting-sudo/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/ef9223b8e236db82c81280f6a317dfb6.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Useful Sudoers configurations for setting ‘sudo’ in Linux" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2169.png"/><p>一个Linux系统管理员需要知道一些Linux技巧。在本文中，您将了解到在Linux 中设置“sudo”的有用的Sudoers配置。</p><p>在Linux和其他类似Unix的操作系统中，只有<strong> root </strong>用户可以运行所有命令并在系统上执行某些关键操作，如安装和更新、删除软件包、创建用户和组、修改重要的系统配置文件等。</p><p>具有根用户角色的<span> <a href="https://en.wikipedia.org/wiki/System_administrator#:~:text=A%20system%20administrator%2C%20or%20sysadmin,user%20computers%2C%20such%20as%20servers." target="_blank" rel="noopener noreferrer">系统管理员</a> </span>可以允许其他普通系统用户在sudo命令和一些配置的帮助下运行一些命令以及执行一些重要的系统操作，包括上面提到的那些。</p><p>此外，系统管理员可以共享root用户密码。但是不建议让普通系统用户通过<strong> su </strong>命令访问root用户帐户。</p><h2><span class="ez-toc-section" id="Useful_Sudoers_configurations_for_setting_sudo_in_Linux"/><span>Linux中设置“sudo”的有用Sudoers配置</span> <span class="ez-toc-section-end"/></h2><p>加入我们，完成本指南的步骤，了解<span> <strong> Sudoers配置</strong>。</span></p><p><strong> sudo </strong>允许授权用户以root用户身份执行命令。您可以在下面查看安全策略。</p><ol><li>它读取并解析<strong> /etc/sudoers </strong>，查找调用用户及其权限，</li><li>然后提示调用用户输入密码(通常是用户的密码，但也可以是目标用户的密码。或者可以用NOPASSWD标签跳过)，</li><li>之后，sudo创建一个子进程，在这个子进程中，它调用<strong> setuid() </strong>切换到目标用户</li><li>接下来，它执行一个shell或上面的子进程中作为参数给出的命令。</li></ol><p> </p><p>现在，让我们看看十个<strong> /etc/sudoers </strong>文件配置，使用<strong>默认值</strong>条目来修改<strong> sudo </strong>命令的行为。</p><pre><code class="language-bash">sudo cat /etc/sudoers  </code></pre><p class="code-label">/etc/sudoers文件</p><pre><code class="language-bash">This file MUST be edited with the 'visudo' command as root.    Please consider adding local content in /etc/sudoers.d/ instead of  directly modifying this file.    See the man page for details on how to write a sudoers file.    <strong>Defaults	env_reset  Defaults	mail_badpass  Defaults	secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"  Defaults	logfile="/var/log/sudo.log"  Defaults	lecture="always"  Defaults	badpass_message="Password is wrong, please try again"  Defaults	passwd_tries=5  Defaults	insults  Defaults	log_input,log_output</strong></code></pre><p><span class="ez-toc-section" id="Types_of_defaults_entries"/> <span>默认条目类型</span> <span class="ez-toc-section-end"/></p><h4> </h4><pre><code class="language-bash">Defaults                parameter,   parameter_list     affect all users on any host  <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0246676463776e7671424a6d7176">[email protected]</a>_List      parameter,   parameter_list     affects all users on a specific host  Defaults:User_List      parameter,   parameter_list     affects a specific user  Defaults!Cmnd_List      parameter,   parameter_list     affects  a specific command   Defaults&gt;Runas_List     parameter,   parameter_list     affects commands being run as a specific user</code></pre><p>在本指南中，我们将在下面的表格中将第一种类型的<strong>默认值</strong>归零。参数可以是标志、整数值、字符串或列表。</p><p>请注意:标志是隐式布尔值，可以使用<span>'！'关闭</span>操作符，而列表有两个额外的赋值操作符，<span> += </span>(添加到列表中)和-=(从列表中移除)</p><p><span class="ez-toc-section" id="1-_Set_a_Secure_PATH"/> <span> 1-设置安全路径</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">Defaults     parameter  OR  Defaults     parameter=value  OR  Defaults     parameter -=value     Defaults     parameter +=value    OR  Defaults     !parameter       </code></pre><h3>对于使用sudo运行的每个命令，您可以使用这个路径，它有两个<strong>重要性</strong>:</h3><p>当系统管理员不信任sudo用户拥有安全的PATH环境变量时使用</p><ol><li>为了区分“根路径”和“用户路径”，只有由<strong> exempt_group </strong>定义的用户不受此设置的影响。</li><li>要设置它:</li></ol><p><span class="ez-toc-section" id="2-_Enable_sudo_on_TTY_user_login_session"/> <span> 2-在TTY用户登录会话上启用sudo</span><span class="ez-toc-section-end"/></p><pre><code class="language-bash">Defaults secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"  </code></pre><p>如果您需要从一个真正的<strong> tty </strong>中调用sudo，而不是通过像<strong> cron </strong>或<strong> cgi-bin </strong>脚本这样的方法，请使用下面的命令:</p><h3> </h3><p><strong>您可能会感兴趣:</strong></p><pre><code class="language-bash">Defaults  requiretty     </code></pre><p><span> <a href="https://eldernode.com/create-user-on-debian-with-root-access/" target="_blank" rel="noopener noreferrer">如何在Debian上创建一个拥有root权限的用户</a> </span></p><p><span class="ez-toc-section" id="3-_Run_Sudo_command_using_a_pty"/> <span> 3-使用pty </span>运行Sudo命令<span class="ez-toc-section-end"/></p><p class="fjpost-title px-0">攻击者可以使用sudo运行恶意程序几次。如果发生这种情况，再次分叉一个后台进程，即使主程序已经完成执行，该进程仍保留在用户的终端设备上。</p><h3>但是您可以通过配置sudo来防止它，并且无论I/O日志记录是否打开，都可以使用<span> <strong> use_pty </strong> </span>参数仅从<strong>pseudo-pty</strong>运行其他命令。</h3><p> </p><p><span class="ez-toc-section" id="4-_Create_a_Sudo_log_file"/> <span> 4-创建一个Sudo日志文件</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">Defaults  use_pty  </code></pre><p>默认情况下，sudo通过syslog(3)记录日志。但是，要指定自定义日志文件，请使用log file参数，如下所示。</p><h3>您可以使用<strong> log_host </strong>和<strong> log_year </strong>参数分别在自定义日志文件中记录主机名和四位数年份。</h3><p> </p><pre><code class="language-bash">Defaults  logfile="/var/log/sudo.log"  </code></pre><p><span class="ez-toc-section" id="5-_Log_Sudo_command_InputOutput"/> <span> 5- Log Sudo命令输入/输出</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">Defaults  log_host, log_year, logfile="/var/log/sudo.log"  </code></pre><p>您可以启用<strong> log_input </strong>和<strong> log_output </strong>参数，以使sudo能够在伪tty中运行命令，并记录所有用户输入和欺骗性地发送到屏幕的所有输出。使用log_input和log_output参数</p><h3>默认情况下，I/O日志目录为<strong> /var/log/sudo-io </strong>，如果有会话序列号，则存储在该目录中。您可以通过<strong> iolog_dir </strong>参数指定一个自定义目录。</h3><p>支持一些转义序列，如<span> <strong> %{seq} </strong> </span>扩展为以36为基数单调递增的序列号，如000001，其中每两个数字组成一个新目录，如<strong> 00/00/01 </strong>，如下例所示:</p><p> </p><pre><code class="language-bash">Defaults   log_input, log_output  </code></pre><p><strong> <span> <a href="https://eldernode.com/vps/" target="_blank" rel="noopener noreferrer">购买VPS服务器</a> </span> </strong></p><pre><code class="language-bash">cd /var/log/sudo-io/  ls  cd  <span>00/00/01</span>  ls  cat log</code></pre><p><span class="ez-toc-section" id="6-_Lecture_Sudo_users"/> <span> 6-讲座Sudo用户</span> <span class="ez-toc-section-end"/></p><p class="fjtitle1 text-uppercase1">您可以使用下面的<strong>讲座</strong>参数，向sudo用户讲解系统上的密码用法。</p><h3>让我们回顾3个可能的值:</h3><p>总是-总是教训用户。</p><p>仅在用户第一次执行sudo命令时讲解一次。</p><ol><li>永远不要对用户说教。</li><li><span class="ez-toc-section" id="7-_Show_custom_message_when_you_enter_wrong_Sudo_password"/> <span> 7-输入错误的数独密码时显示自定义信息</span> <span class="ez-toc-section-end"/></li><li>每当用户输入错误的密码时，都会在命令行上显示一条消息。默认消息是“<strong>对不起，再试一次</strong>”，通过使用以下命令，您可以使用<strong> badpass_message </strong>参数修改该消息。</li></ol><pre><code class="language-bash">Defaults  lecture="always"  </code></pre><p> </p><h3><span class="ez-toc-section" id="8-_Increase_sudo_password_tries_limit"/> <span> 8-增加sudo密码尝试次数限制</span> <span class="ez-toc-section-end"/></h3><p>要指定用户可以尝试输入密码的次数，可以使用<strong> passwd_tries </strong>参数。</p><pre><code class="language-bash">Defaults  badpass_message="Password is wrong, please try again"  </code></pre><p> </p><h3>此外，您可以使用下面的命令来设置密码超时(默认为5分钟)</h3><p> </p><pre><code class="language-bash">Defaults   passwd_tries=5   </code></pre><p><span class="ez-toc-section" id="9-_Let_Sudo_insult_you_when_you_enter_wrong_password"/> <span> 9-当你输入错误的密码时让须藤侮辱你</span> <span class="ez-toc-section-end"/></p><p>如果用户输入了错误的密码，Sudo将在终端上显示带有侮辱参数的侮辱。这将自动关闭<strong> badpass_message </strong>参数。</p><pre><code class="language-bash">Defaults   passwd_timeout=2  </code></pre><p> </p><h3><span> <strong>好样的</strong> </span>！至此，您已经完成了教程，并学习了一些新的有用技巧。按照顺序，你需要多阅读，遵循<span> <a href="https://eldernode.com/tag/linux-tricks/"> <strong> Linux的窍门</strong> </a> </span></h3><p> </p><pre><code class="language-bash">Defaults  insults   </code></pre><p>亲爱的用户，我们希望您喜欢本教程，您可以在评论区提出关于本次培训的问题，或者解决<a href="https://eldernode.com/"> Eldernode </a>培训领域的其他问题，请参考<span> <a href="https://eldernode.com/ask" target="_blank" rel="noopener noreferrer">提问页面</a> </span>部分并在其中提出您的问题。</p><p><span><strong>Good job</strong></span>! at this point, you finished the tutorial and learned some new useful tips. In order, you need to read more, follow the <span><a href="https://eldernode.com/tag/linux-tricks/"><strong>Linux tricks</strong></a></span></p><p> </p><p>Dear user, we hope you would enjoy this tutorial, you can ask questions about this training in the comments section, or to solve other problems in the field of <a href="https://eldernode.com/">Eldernode</a> training, refer to the <span><a href="https://eldernode.com/ask" target="_blank" rel="noopener noreferrer">Ask page</a></span> section and raise your problems in it.</p></div></div>    
</body>
</html>