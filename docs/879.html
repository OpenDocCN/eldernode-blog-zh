<html>
<head>
<title>Tutorial Install Varnish Cache on Debian with Apache - Eldernode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>教程用Apache - Eldernode博客在Debian上安装Varnish缓存</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-varnish-cache-on-debian-with-apache/#0001-01-01">https://blog.eldernode.com/install-varnish-cache-on-debian-with-apache/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/8db5d75a65a3aa44b3b11537894574e5.png" data-src="https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Tutorial Install Varnish Cache on Debian with Apache" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache.png 2069w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/11/install-varnish-cache-on-debian-with-apache.png"/><p>Varnish Cache是开源的，因此，该软件属于自由软件许可家族，允许以最小的限制使用和分发。在本文中，我们将教你如何用Apache在Debian上安装Varnish Cache。如果你想购买一台<a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener"> <strong> Linux VPS </strong> </a>服务器，你可以访问<a href="https://eldernode.com/" target="_blank" rel="noopener"> Eldernode </a>中的软件包。</p><p> </p><h2><span class="ez-toc-section" id="How_to_Install_Varnish_Cache_on_Debian_Linux"/> <strong>如何在Debian Linux上安装Varnish Cache</strong><span class="ez-toc-section-end"/></h2><h3><span class="ez-toc-section" id="Varnish_Cache_Features"/>清漆缓存功能<span class="ez-toc-section-end"/></h3><p>Varnish在用户第一次访问web服务器提供的页面时获取并保存该页面的副本。这将加快网站的速度。下次用户请求同一个页面时，Varnish会提供一个副本，而不是从web服务器请求页面。这样，您的网络服务器将管理更少的流量，您的网站性能和可扩展性将更高。根据您的架构，Varnish cache可将您的web内容交付提高80%或更多。</p><h2><span class="ez-toc-section" id="Install_Varnish_Cache_on_Debian_with_Apache"/> <strong>用Apache </strong>在Debian上安装Varnish Cache<span class="ez-toc-section-end"/></h2><h3><span class="ez-toc-section" id="Step_1_Installing_Apache"/>步骤1) <strong>安装Apache</strong>T3】</h3><p>要安装和配置Varnish缓存，我们必须首先在我们的节点上安装Apache。这个过程的第一步是更新debian操作系统:</p><pre><code class="language-bash">apt update</code></pre><pre><code class="language-bash">apt upgrade</code></pre><p>下载软件包后，更新操作系统并安装Apache 2.4:</p><pre><code class="language-bash">apt -y install apache2</code></pre><p>安装完成后，启用Apache服务:</p><pre><code class="language-bash">systemctl enable apache2 &amp;&amp; systemctl start apache2</code></pre><p>如果启用UFW，可以使用以下命令。如果UFW未启用，请跳过以下命令:</p><pre><code class="language-bash">ufw allow 80/tcp</code></pre><pre><code class="language-bash">ufw allow 443/tcp</code></pre><pre><code class="language-bash">ufw reload</code></pre><h3><span class="ez-toc-section" id="Step_2_Install_and_configure_Varnish_Cache"/>步骤2) <strong>安装并配置清漆缓存</strong>T3】</h3><p>完成Apache安装后，就该安装Varnish缓存了。<br/>第一步是下载GPG密钥，然后添加它:</p><pre><code class="language-bash">curl -L https://packagecloud.io/varnishcache/varnish5/gpgkey | sudo apt-key add -</code></pre><p>接下来，必须安装软件包要求:</p><pre><code class="language-bash">apt install -y debian-archive-keyring apt-transport-https</code></pre><p>然后必须将存储库添加到源列表中:</p><pre><code class="language-bash">echo "deb https://packagecloud.io/varnishcache/varnish5/debian/ stretch main" &gt;</code></pre><pre><code class="language-bash">/etc/apt/sources.list.d/varnishcache5.list</code></pre><p>还需要更新包管理器来添加新的存储库:</p><pre><code class="language-bash">apt update</code></pre><p>既然已经安装了存储库，并且更新了必要的组件，那么可能会安装Varnish Cache:</p><pre><code class="language-bash">apt install -y varnish</code></pre><p>在每次安装结束时，检查安装的版本是否与您期望的相匹配是很重要的。有必要检查Varnish缓存的安装及其适当的版本:</p><pre><code class="language-bash">varnishd -V</code></pre><p>确认安装后，通过编辑以下文件将Varnish缓存配置为监听端口80，并将端口80替换为端口6081:</p><pre><code class="language-bash">nano /lib/systemd/system/varnish.service</code></pre><p>出发地:</p><pre><code class="language-bash">ExecStart=/usr/sbin/varnishd -a :6081 -T localhost:6082 -f /etc/varnish/default.vcl -S /etc/varnish/secret -s malloc,256m</code></pre><p>收件人:</p><pre><code class="language-bash">ExecStart=/usr/sbin/varnishd -a :80 -T localhost:6082 -f /etc/varnish/default.vcl -S /etc/varnish/secret -s malloc,256m</code></pre><p>编辑文件后，我们必须重新加载系统守护程序来更新文件:</p><pre><code class="language-bash">systemctl daemon-reload</code></pre><p>重新加载后，应修改默认配置，并告知系统将收到的Varnish缓存请求定向到哪里:</p><pre><code class="language-bash">nano /etc/varnish/default.vcl  backend default {  .host = "127.0.0.1";  .port = "8080";  }</code></pre><p>Apache 2.4也需要一些小的改动，允许它监听端口8080，而不是端口80:</p><pre><code class="language-bash">nano /etc/apache2/ports.conf</code></pre><pre><code class="language-bash">Listen 8080</code></pre><pre><code class="language-bash">nano /etc/apache2/sites-enabled/000-default.conf  &lt;VirtualHost *:8080&gt;</code></pre><p>修复之后，是时候重启Apache 2.4和Varnish缓存了。完全重启后，启用清漆缓存:</p><pre><code class="language-bash">systemctl restart apache2</code></pre><pre><code class="language-bash">systemctl restart varnish</code></pre><pre><code class="language-bash">systemctl enable varnish</code></pre><p>在这一点上，我们测试Varnish Cache和Apache 2.4，以确保它们都能按预期工作:</p><pre><code class="language-bash">curl -I http://127.0.0.1  HTTP/1.1 200 OK  Server: Apache/2.4.25 (Debian)  Vary: Accept-Encoding  Content-Type: text/html  X-Varnish: 2  Age: 0  Via: 1.1 varnish (Varnish/5.1)  EW/"29cd-55771150d08a7-gzip"  Accept-Ranges: bytes  Connection: keep-alive</code></pre><p>如有必要，您可以使用以下命令检查Varnish缓存统计信息:</p><pre><code class="language-bash">varnishstat</code></pre><p> </p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>那么，您已经成功地在您的Debian Linux上安装并配置了Apache 2.4和Varnish Cache。此安装允许您简化网页的分发，并允许用户比以前更快、更有效地访问信息。</p></div></div>    
</body>
</html>