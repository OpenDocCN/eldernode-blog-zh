<html>
<head>
<title>How to Configure VPLS on Mikrotik</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Mikrotik上配置VPLS</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/configure-vpls-on-mikrotik/#0001-01-01">https://blog.eldernode.com/configure-vpls-on-mikrotik/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/e9dd2acd0914441c9c19a545b8fbfbd7.png" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik.webp" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to Configure VPLS on Mikrotik" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik.webp 2069w, https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik-300x164.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik-1024x561.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik-768x421.webp 768w, https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik-1536x842.webp 1536w, https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik-2048x1122.webp 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/How-to-Configure-VPLS-on-Mikrotik.webp"/><p>当您的组织或企业有多个分支机构时，您将需要使用第二层互联网平台。VPLS实际上是具有多点功能的第二层VPN，可用于此目的。这篇文章将教你如何在Mikrotik上配置VPLS。如果您打算购买一台Mikrotik VPS服务器，您可以查看我们网站上提供的套装。</p><h2><span class="ez-toc-section" id="Tutorial_Install_VPLS_on_Mikrotik_VPS"/> <strong>教程在Mikrotik VPS上安装VPLS</strong><span class="ez-toc-section-end"/></h2><h3><span class="ez-toc-section" id="What_is_VPLS"/> <strong>什么是VPLS？</strong>T3】</h3><p>VPLS代表虚拟专用局域网服务，是一种通过IP或MPLS网络提供基于以太网的多点对多点通信的方式。这项技术使您能够通过MPLS主干网将地理上分散的以太局域网(LAN)站点相互连接起来。事实上，对于实施VPLS的客户来说，所有站点都将位于同一个以太网LAN上。它为创建一个广泛、互联且安全的网络提供了最佳解决方案。</p><h2><span class="ez-toc-section" id="How_to_Setup_VPLS_on_Mikrotik"/> <strong>如何在Mikrotik </strong>上设置VPLS<span class="ez-toc-section-end"/></h2><p>在之前的帖子中，我们已经教过<a href="https://blog.eldernode.com/setup-mpls-on-mikrotik/">如何在Mikrotik </a>中设置MPLS。在本节中，您将学习如何在Mikrotik上配置VPLS。</p><p>您可以将VPLS接口视为类似EoIP接口的隧道接口。建立以下隧道以实现客户站点之间的透明以太网网段转发:</p><p>–&gt; R1-R5(客户A)</p><p>–&gt; R1-R4(客户A)</p><p>–&gt; R4-R5(客户A)</p><p>–&gt; R1-R5(客户B)</p><p>每个隧道设置都涉及在两个隧道端点上创建VPLS接口。</p><p>LDP协议协商VPLS隧道–两个端点交换隧道标签以用于隧道。要在隧道中转发数据，您需要在数据包上贴上两个标签，即隧道标签和传输标签。事实上，此标签确保流量传递到隧道的另一个端点。</p><p>VPLS隧道配置在/接口VPLS菜单中。vpls-id参数对于该隧道和远程对等体之间的每个隧道必须是唯一的，并且标识vpls隧道。</p><h3><span class="ez-toc-section" id="Required_Setups"/> <strong>所需设置</strong> <span class="ez-toc-section-end"/></h3><pre><code class="language-bash">/interface vpls add name=A1toA2 remote-peer=9.9.9.5 mac-address=00:00:00:00:00:a1 vpls-id=10 disabled=no</code></pre><pre><code class="language-bash">/interface vpls add name=A1toA3 remote-peer=9.9.9.4 mac-address=00:00:00:00:00:a1 vpls-id=10 disabled=no</code></pre><pre><code class="language-bash">/interfacevpls add name=B1toB2 remote-peer=9.9.9.5 mac-address=00:00:00:00:00:b1 vpls-id=11 disabled=no</code></pre><pre><code class="language-bash">/interface vpls add name=A3toA1 remote-peer=9.9.9.1 mac-address=00:00:00:00:00:a3 vpls-id=10 disabled=no</code></pre><pre><code class="language-bash">/interface vpls add name=A3toA2 remote-peer=9.9.9.5 mac-address=00:00:00:00:00:a3 vpls-id=10 disabled=no</code></pre><pre><code class="language-bash">/interface vpls add name=A2toA1 remote-peer=9.9.9.1 mac-address=00:00:00:00:00:a2 vpls-id=10 disabled=no</code></pre><pre><code class="language-bash">/interface vpls add name=A2toA3 remote-peer=9.9.9.4 mac-address=00:00:00:00:00:a2 vpls-id=10 disabled=no</code></pre><pre><code class="language-bash">/interface vpls add name=B2toB1 remote-peer=9.9.9.1 mac-address=00:00:00:00:00:b2 vpls-id=11 disabled=no</code></pre><p>VPLS隧道配置创建动态LDP邻居，并建立“目标”LDP会话。目标LDP会话是在不是直接邻居的两个路由器之间建立的会话。在此设置之后，R1 LDP邻居如下所示:</p><p> </p><p><img data-lazyloaded="1" src="../Images/3ed915a8f0383dbcf5bf8fa0b9d310c4.png" decoding="async" loading="lazy" class="aligncenter wp-image-43067 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/R1-LDP-neighbors.webp" alt="R1-LDP-neighbors" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/R1-LDP-neighbors.webp 1505w, https://blog.eldernode.com/wp-content/uploads/2023/02/R1-LDP-neighbors-300x60.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/R1-LDP-neighbors-1024x204.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/R1-LDP-neighbors-768x153.webp 768w" data-sizes="(max-width: 1505px) 100vw, 1505px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/R1-LDP-neighbors.webp"/></p><p> </p><p>IP路由标签也在VPLS对等体之间交换，但是都不能使用。路由器维护所有交换的标签，以便在需要时可以立即使用。</p><p>要查看有关VPLS接口的信息，您应该监控其状态:</p><p> </p><p><img data-lazyloaded="1" src="../Images/020a787dbc9d5ff86fe7bd5efee8920e.png" decoding="async" loading="lazy" class="aligncenter wp-image-43071 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/State-of-VPLS-interface.webp" alt="State-of-VPLS-interface" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/State-of-VPLS-interface.webp 1489w, https://blog.eldernode.com/wp-content/uploads/2023/02/State-of-VPLS-interface-300x36.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/State-of-VPLS-interface-1024x124.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/State-of-VPLS-interface-768x93.webp 768w" data-sizes="(max-width: 1489px) 100vw, 1489px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/State-of-VPLS-interface.webp"/></p><p> </p><p>如您所见，R1为R1和R4之间的隧道指定了标签27。MPLS转发表指示该标签在该隧道上被检测和接收，而不是转发到下一跳:</p><p> </p><p><img data-lazyloaded="1" src="../Images/76f1c399a5a0fa84525c8fab034c84e0.png" decoding="async" loading="lazy" class="wp-image-43074 size-full aligncenter" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/forwarding-table-print.webp" alt="forwarding-table-print" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/forwarding-table-print.webp 1488w, https://blog.eldernode.com/wp-content/uploads/2023/02/forwarding-table-print-300x28.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/forwarding-table-print-1024x96.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/forwarding-table-print-768x72.webp 768w" data-sizes="(max-width: 1488px) 100vw, 1488px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/forwarding-table-print.webp"/></p><p> </p><p>远程端点(R4)被分配标签24。</p><p>igp-prefix表示用于到达隧道远程端点的路由。也就是说，当流量被转发到隧道的远程端点时，该路由器会施加传输标签，即由路由9.9的下一跳向9.9.9.4/32分发的标签。9.4/32路线。所以，你可以在R2证实这一点:</p><p> </p><p><img data-lazyloaded="1" src="../Images/0efb0b6b319abf9a6115eb5072934317.png" decoding="async" loading="lazy" class="aligncenter wp-image-43075 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/confirmed-on-R2.webp" alt="confirmed-on-R2" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/confirmed-on-R2.webp 1489w, https://blog.eldernode.com/wp-content/uploads/2023/02/confirmed-on-R2-300x36.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/confirmed-on-R2-1024x124.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/confirmed-on-R2-768x93.webp 768w" data-sizes="(max-width: 1489px) 100vw, 1489px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/confirmed-on-R2.webp"/></p><p> </p><p>应用于数据包的隧道标签由该隧道的远程路由器(R4)决定。</p><p>强加的标签反映了这种配置:由隧道生成的数据包上有2个标签:21和24。</p><h3><span class="ez-toc-section" id="Penultimate_Effects_of_Hop_Popping_in_VPLS_Tunnels"/><strong>VPLS隧道里啤酒花爆开的倒数第二个效果</strong> <span class="ez-toc-section-end"/></h3><p>传输标签的倒数第二跳弹出导致数据包到达只有一个隧道标签的VPLS隧道的端点。这导致VPLS隧道端点仅寻找标签来找出如何处理分组。因此，您可以使用<a href="https://blog.eldernode.com/trace-an-ip-address-with-the-linux-traceroute/"> traceroute </a>工具观察隧道端点之间的传输标签行为。例如，从R1到R4的跟踪路由如下:</p><p> </p><p><img data-lazyloaded="1" src="../Images/d6cb948886be6017c139dd084ebcea02.png" decoding="async" loading="lazy" class="aligncenter wp-image-43076 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/Traceroute-from-R1-to-R4.webp" alt="Traceroute-from-R1-to-R4" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/Traceroute-from-R1-to-R4.webp 1499w, https://blog.eldernode.com/wp-content/uploads/2023/02/Traceroute-from-R1-to-R4-300x37.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/Traceroute-from-R1-to-R4-1024x128.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/Traceroute-from-R1-to-R4-768x96.webp 768w" data-sizes="(max-width: 1499px) 100vw, 1499px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/Traceroute-from-R1-to-R4.webp"/></p><p> </p><p>在traceroute输出中，您可以看到隧道端点正在接收一个未标记的探测。事实上，在VPLS隧道流量中也会发生同样的情况，传输标签(18)在R3上弹出，数据包只与隧道标签交换。</p><p>将隧道标记的数据包传送到隧道端点的要求解释了使用“环回”IP地址作为隧道端点的配置建议。由于R3将3.3.3.0/24网络作为其连接网络，如果在这种情况下，R4使用其3.3.3.4地址建立了LDP会话，则倒数第二跳将出现在R2上。这会导致R3(而不是R4)收到只有隧道标签的数据包，从而产生无法预测的结果。包括在R3无法识别数据包时丢弃帧或以错误的方式发送。</p><p>另一个可能发生的问题是直接连接VPLS隧道的端点。它们之间不能使用任何传输标签，因为它们都指示对方成为其隧道端点地址的倒数第二跳弹出路由器。例如在R5中:</p><p> </p><p><img data-lazyloaded="1" src="../Images/958e88db640f86914d5d7092dd77f92c.png" decoding="async" loading="lazy" class="aligncenter wp-image-43078 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/Remote-bindings-print.webp" alt="Remote-bindings-print" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/Remote-bindings-print.webp 1492w, https://blog.eldernode.com/wp-content/uploads/2023/02/Remote-bindings-print-300x31.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/Remote-bindings-print-1024x107.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/Remote-bindings-print-768x80.webp 768w" data-sizes="(max-width: 1492px) 100vw, 1492px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/Remote-bindings-print.webp"/></p><p> </p><p>这样，VPLS隧道在发送数据包时将只使用隧道标签:</p><p> </p><p><img data-lazyloaded="1" src="../Images/5244fcba986b9ec7e080261d65ddeb31.png" decoding="async" loading="lazy" class="aligncenter wp-image-43079 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/int-vpls-monitor.webp" alt="int-vpls-monitor" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/int-vpls-monitor.webp 1496w, https://blog.eldernode.com/wp-content/uploads/2023/02/int-vpls-monitor-300x35.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/int-vpls-monitor-1024x120.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/int-vpls-monitor-768x90.webp 768w" data-sizes="(max-width: 1496px) 100vw, 1496px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/int-vpls-monitor.webp"/></p><p> </p><h3><span class="ez-toc-section" id="How_to_bridge_Ethernet_Segments_with_VPLS"/> <strong>如何用VPLS </strong>桥接以太网网段<span class="ez-toc-section-end"/></h3><p>VPLS隧道在路由器之间提供虚拟以太网链路。它们应该通过VPLS隧道桥接，以透明地连接两个物理以太网网段。事实上，它的工作方式类似于EoIP接口。</p><p>运行以下命令，透明地桥接连接到R1和R5的客户B网络:</p><pre><code class="language-bash">/interface bridge add name=B</code></pre><pre><code class="language-bash">/interface bridge port add bridge=B interface=ether1</code></pre><pre><code class="language-bash">/interface bridge port add bridge=B interface=B1toB2</code></pre><p><strong>在R5上:</strong></p><pre><code class="language-bash">/interface bridge add name=B</code></pre><pre><code class="language-bash">/interface bridge port add bridge=B interface=ether3</code></pre><pre><code class="language-bash">/interface bridge port add bridge=B interface=B2toB1</code></pre><p>因为除了R1和R5之间的单个VPLS隧道之外，B1段和B2段之间没有链路，所以您不需要在网桥上运行(R)STP协议。</p><h3><span class="ez-toc-section" id="Split_Horizon_Bridging"/><strong/><span class="ez-toc-section-end"/></h3><p>在示例设置中，设置了3条隧道来连接段A1、A2和A3，从而在所涉及的段之间建立了隧道的所谓“全网状”。如果在没有(R)STP的情况下启用桥接，则会出现流量环路。如果您正在寻找一些解决方案，请阅读以下内容:</p><h4><span class="ez-toc-section" id="Enabling_RSTP"/> <strong>启用(R)STP </strong> <span class="ez-toc-section-end"/></h4><p>这消除了环路，但有一个缺点，即(R)STP协议禁止通过其中一个隧道进行转发，只保留它用于备份目的。这样，两个网段之间的流量必须通过两个隧道，这使得设置效率低下。</p><h4><span class="ez-toc-section" id="Use_a_bridge_firewall"/> <strong>使用桥接防火墙</strong> <span class="ez-toc-section-end"/></h4><p>这可确保流量不会形成环路，并包括设置防火墙规则，降低桥接效率。</p><h4><span class="ez-toc-section" id="Use_the_bridge_horizon_feature"/> <strong>使用桥梁地平线功能</strong> <span class="ez-toc-section-end"/></h4><p>水平分割桥接的基本思想是，到达某个端口的流量永远不会被转发到一组端口。如上所述，数据包的发送方连接到目标网络本身。这意味着通过一个VPLS隧道到达的数据包永远不能发送到另一个VPLS隧道。</p><p>例如，如果A1中的设备发送一个广播或未知MAC地址的数据包(这会导致网桥淹没所有接口)，该数据包会通过VPLS隧道发送到R5和R4。例如，在常规设置中，当R5通过VPLS隧道接收到此类数据包时，会将其发送到与之相连的A2，并通过VPLS隧道发送到R4。因此，R4收到了同一个数据包的两个副本，导致流量形成环路。</p><p>您可以使用网桥水平功能来配置具有水平设置的网桥端口，以便从具有水平值X的端口接收到的数据包不会被发送或泛洪到具有相同水平值X的任何端口。在VPLS隧道的全网状情况下，您应该为它们桥接在一起的VPLS隧道配置具有相同水平值的每台路由器。</p><p>使用以下R1配置命令为客户A启用桥接:</p><pre><code class="language-bash">/interface bridge add name=A</code></pre><pre><code class="language-bash">/interface bridge port add bridge=A interface=A1toA2 horizon=1</code></pre><pre><code class="language-bash">/interface bridge port add bridge=A interface=A1toA3 horizon=1</code></pre><p>同样，您应该在R4和R5上配置网桥。物理以太网端口没有配置水平值。如果是的话，它将完全禁止网桥发送数据。</p><p>horizon值仅在本地有意义，不会通过网络传输，因此，如果在参与桥接网络的所有路由器上配置相同的值，也没有关系。</p><h2><span class="ez-toc-section" id="How_to_Optimize_Label_Distribution"/> <strong>如何优化标签分配</strong> <span class="ez-toc-section-end"/></h2><p>在本文的其余部分，我们将教您如何在Mikrotik上配置VPLS。</p><h3><span class="ez-toc-section" id="Label_Binding_Filtering"/> <strong>标签绑定过滤</strong> <span class="ez-toc-section-end"/></h3><p>当您实现给定的示例设置时，很明显并非所有的标签绑定都是必要的。因为它们永远不会被使用，所以您不需要在R1和R5或者R1和R4之间交换IP路由标签绑定。此外，如果给定的网络核心仅提供到指定客户端以太网段的连接，那么为连接路由器的网络分配标签就没有实际意义。唯一重要的路线是通往VPLS隧道终点的/32路线。</p><p>您可以使用标签绑定过滤来仅分发特定的标签集，以减少资源使用和网络负载。</p><p>以下是标签绑定过滤器类型:</p><p>–&gt;要通告给LDP邻居的标签绑定，在/mpls ldp advertise-filter中配置</p><p>–&gt;要从LDP邻居接受的标签绑定，在/mpls ldp accept-filter中配置</p><p>过滤器被组织成一个有序列表，并指定应该包含根据过滤器测试的前缀和邻居(或通配符)的前缀。</p><p>您可以将所有路由器配置为仅对允许访问隧道端点的路由通告标签。对于这两个通告过滤器，您需要在所有路由器上进行如下配置:</p><pre><code class="language-bash">/mpls ldp advertise-filter add prefix=9.9.9.0/24 advertise=yes</code></pre><pre><code class="language-bash">/mpls ldp advertise-filter add prefix=0.0.0.0/0 advertise=no</code></pre><p>此筛选器会公布覆盖隧道端点(9.9.9.1/32，9.9.9.4/32, 9 . 9 . 9 . 5/32)的前缀为9.9.9.0/24的路由的绑定。</p><p>由于默认的过滤结果是当没有匹配的规则时允许有问题的操作，所以第二个规则是必要的。</p><p>在给定的配置中，不需要设置accept filter，因为上面提到的2个规则引入的约定是没有LDP路由器分发不必要的连接。</p><p>过滤器更改不会影响现有映射，因此必须重置邻居之间的连接才能应用过滤器。您可以通过删除它们来实现这一点:</p><p><img data-lazyloaded="1" src="../Images/01fbfb887c19856383fbfa4b58350f98.png" decoding="async" loading="lazy" class="aligncenter wp-image-43094 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/1.webp" alt="setup VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/1.webp 1490w, https://blog.eldernode.com/wp-content/uploads/2023/02/1-300x62.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/1-1024x212.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/1-768x159.webp 768w" data-sizes="(max-width: 1490px) 100vw, 1490px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/1.webp"/></p><p> </p><p>在<strong> R1 </strong>，您将获得:</p><p> </p><p><img data-lazyloaded="1" src="../Images/119009096fcbb6c066677d1481029349.png" decoding="async" loading="lazy" class="aligncenter wp-image-43095 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/2.webp" alt="tutorial VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/2.webp 1508w, https://blog.eldernode.com/wp-content/uploads/2023/02/2-300x84.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/2-1024x288.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/2-768x216.webp 768w" data-sizes="(max-width: 1508px) 100vw, 1508px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/2.webp"/></p><p> </p><p>请注意，仍然有不必要的绑定。由于与VPLS隧道(链接9.9.9.5和9.9.9.4)的远程端点分布的有目的的LDP会话，绑定被分布。</p><p>您必须配置路由器来过滤它们，以便它们不会向任何隧道端点路由器分发任何IP绑定。例如，在R1，筛选器表应该如下所示:</p><p> </p><p><img data-lazyloaded="1" src="../Images/3a963faa0b6f05499c81f9b5c9297111.png" decoding="async" loading="lazy" class="aligncenter wp-image-43096 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/3.webp" alt="install VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/3.webp 1491w, https://blog.eldernode.com/wp-content/uploads/2023/02/3-300x35.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/3-1024x118.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/3-768x89.webp 768w" data-sizes="(max-width: 1491px) 100vw, 1491px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/3.webp"/></p><p> </p><p>这将为路由器提供最少的标签绑定表，例如在<strong> R1 </strong>上:</p><p> </p><p><img data-lazyloaded="1" src="../Images/407702274bc8da43a057e4c297c59ec1.png" decoding="async" loading="lazy" class="aligncenter wp-image-43097 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/4.webp" alt="setup VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/4.webp 1495w, https://blog.eldernode.com/wp-content/uploads/2023/02/4-300x77.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/4-1024x264.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/4-768x198.webp 768w" data-sizes="(max-width: 1495px) 100vw, 1495px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/4.webp"/></p><p> </p><p>尽管它们是隧道端点，但不应在R4和R5之间禁用IP绑定分发。R4和R5不需要绑定到VPLS数据隧道的IP，这样做不会影响正常情况。但是，如果R3和R5之间的链路断开，来自R1的所有R5流量都必须通过R4重新路由。在这种情况下，R5不会将IP绑定分发到R4，导致R4无法将MPLS流量转发到R5。</p><h3><span class="ez-toc-section" id="What_are_the_Effects_of_Label_Binding_Filtering_on_Data_Forwarding_in_the_Network"/> <strong>标签绑定过滤对网络中的数据转发有什么影响？</strong>T3】</h3><p>现在，您应该会注意到这些更改后的traceroute结果。从R1到R5的traceroute使用R1的环回地址作为源地址，其行为仍然相同。每个跃点报告收到的标签:</p><p> </p><p><img data-lazyloaded="1" src="../Images/c26040d144b000762a47100dea4a13a4.png" decoding="async" loading="lazy" class="aligncenter wp-image-43098 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/5.webp" alt="Configure VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/5.webp 1501w, https://blog.eldernode.com/wp-content/uploads/2023/02/5-300x35.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/5-1024x121.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/5-768x91.webp 768w" data-sizes="(max-width: 1501px) 100vw, 1501px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/5.webp"/></p><p> </p><p>在使用R1面向网络地址的traceroute中:</p><p> </p><p><img data-lazyloaded="1" src="../Images/a8bcdc682d0f7efdeb8e0413970d873d.png" decoding="async" loading="lazy" class="aligncenter wp-image-43099 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/6.webp" alt="Configure VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/6.webp 1501w, https://blog.eldernode.com/wp-content/uploads/2023/02/6-300x28.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/6-1024x96.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/6-768x72.webp 768w" data-sizes="(max-width: 1501px) 100vw, 1501px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/6.webp"/></p><p> </p><p>除了最后一跳，所有的跳都会被响应。因为没有从R5到R1的标签交换路径(这次使用地址1.1.1.1 ),也没有分发标签绑定。因此，ICMP响应被路由，返回途中的路由器(R3和R2)收到带有源地址的数据包，并立即丢弃这些数据包，而不进行路由。</p><p>使用它们的非环回地址跟踪从R1到R5的路由:</p><p> </p><p><img data-lazyloaded="1" src="../Images/4eb460b2e8c950a056d88c1d90bd0b56.png" decoding="async" loading="lazy" class="aligncenter wp-image-43100 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/02/7.webp" alt="Configure VPLS on Mikrotik" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/02/7.webp 1500w, https://blog.eldernode.com/wp-content/uploads/2023/02/7-300x26.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/02/7-1024x88.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/02/7-768x66.webp 768w" data-sizes="(max-width: 1500px) 100vw, 1500px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/02/7.webp"/></p><p> </p><p>这种跟踪路由不需要标签交换，其工作方式与没有MPLS的网络完全一样。</p><p>就是这样！</p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，我们教您如何在Mikrotik上配置VPLS，并向您介绍了VPLS。我希望本教程对你有用，并能帮助你在Mikrotik上配置VPLS。如果你遇到任何问题，你可以在评论区联系我们。</p></div></div>    
</body>
</html>