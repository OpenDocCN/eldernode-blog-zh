<html>
<head>
<title>Install Varnish Cache For Apache On Ubuntu - Eldernode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Ubuntu - Eldernode博客上为Apache安装Varnish缓存</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/varnish-cache-for-apache-on-ubuntu/#0001-01-01">https://blog.eldernode.com/varnish-cache-for-apache-on-ubuntu/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/8c490142ce51b30deb55b05c2155f6ac.png" data-src="https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Install Varnish Cache For Apache On Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04.png 2069w, https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/04/Install-Varnish-Cache-For-Apache-On-Ubuntu-20.04.png"/><p>Varnish Cache是一个流行且强大的开源HTTP引擎/反向HTTP代理，适用于高流量网站。Varnish缓存，也称为Varnish，是一个HTTP加速器，专为内容丰富的动态网站和API而设计。Varnish被设计为HTTP加速器。它与Squid不同，Squid最初是客户端缓存，甚至与Apache和Nginx形成对比，后者主要是源服务器。如果你正在寻找一个解决方案来加速你的Apache服务器，加入我们这篇文章来学习如何<strong>在Ubuntu 20.04 </strong>上安装Varnish Cache For Apache。在<a href="https://eldernode.com/" target="_blank" rel="noopener"> Eldernode </a>上找到您考虑的软件包，并购买您自己的<a href="https://eldernode.com/ubuntu-vps/" target="_blank" rel="noopener"> Ubuntu VPS </a>，享受我们技术团队的支持。</p><h2><span class="ez-toc-section" id="Tutorial_Install_Varnish_Cache_For_Apache_On_Ubuntu_2004"/> <strong>教程在Ubuntu 20.04上为Apache安装Varnish缓存</strong> <span class="ez-toc-section-end"/></h2><p>之前，你已经学习了在Ubuntu 20.04 上安装<a href="https://blog.eldernode.com/apache-web-server-ubuntu-20/" target="_blank" rel="noopener"> Apache。因此，我们假设您已经安装并运行了Apache。接下来，我们将在非标准端口8080上运行Apache，然后在端口80上运行Varnish作为反向代理。此外，我们将使用Apache作为后端服务器，它不能在标准的HTTP端口80下运行。和我们一起学习如何在</a><a href="https://blog.eldernode.com/tag/ubuntu/"> Ubuntu </a> 20.04上安装和配置Varnish。</p><h3><span class="ez-toc-section" id="Prerequisites_to_Install_Varnish_Cache_on_Ubuntu_2004"/> <strong>在Ubuntu 20.04上安装清漆缓存的先决条件</strong> <span class="ez-toc-section-end"/></h3><p>为了让本教程更好地工作，请考虑以下先决条件:</p><p>_ Ubuntu 20.04 lt</p><p>_拥有Sudo权限的非root用户。</p><p>_要进行设置，请遵循我们在Ubuntu 20.04 上的<a href="https://blog.eldernode.com/initial-server-setup-on-ubuntu-20/" target="_blank" rel="noopener">初始服务器设置。</a></p><h3><span class="ez-toc-section" id="How_to_Install_Apache_Webserver_on_Ubuntu_2004"/> <strong>如何在Ubuntu 20.04上安装Apache web server</strong>T3】</h3><p>如果您重视速度、性能、可扩展性，并希望节省服务器基础设施，您会喜欢Varnish，并发现它是您的业务所必需的。当您在任何使用HTTP的服务器前安装Varnish并将其配置为缓存内容时，Varnish通过缓存用户经常访问的内容并将其存储在内存中来加速网站，从而保证更快地检索网页。让我们来看一下这个指南的步骤，在Ubuntu 20.04上安装Varnish cache for Apache并提高你的网站速度。</p><p><em>第一步:</em></p><p>首先，您需要安装Apache服务器。因为默认情况下它在Ubuntu存储库中可用。因此，使用以下命令更新Ubuntu存储库，然后安装Apache:</p><pre><code class="language-bash">apt update</code></pre><pre><code class="language-bash">apt install -y apache2</code></pre><p><em>第二步:</em></p><p>一旦安装完成，您就可以启动Apache服务，并使它在系统引导时自动运行。所以，运行:</p><pre><code class="language-bash">systemctl start apache2</code></pre><pre><code class="language-bash">systemctl enable apache2</code></pre><p><em>第三步:</em></p><p>在这一步中，您必须允许所有人在我们的防火墙规则上访问web服务器、HTTP和HTTPS。使用以下UFW命令打开新的SSH、HTTP和HTTPS端口:</p><pre><code class="language-bash">ufw allow ssh</code></pre><pre><code class="language-bash">ufw allow http</code></pre><pre><code class="language-bash">ufw allow https</code></pre><p>然后，使用下面的命令启动防火墙服务，并使其在系统启动时自动启动。同样，输入<em> ' <strong> y </strong> ' </em>并按<strong>回车</strong>确认:</p><pre><code class="language-bash">ufw enable</code></pre><p>这样，HTTP、HTTPS和SSH的新端口已经打开，并且可以从网络外部访问。</p><h3><span class="ez-toc-section" id="How_to_change_Apache_default_Port_on_Ubuntu_2004"/> <strong>如何在Ubuntu 20.04上更改Apache默认端口</strong> <span class="ez-toc-section-end"/></h3><p>Apache web服务器将在端口8080上作为后端运行，标准的HTTP端口80将由“Varnish”使用。因此，在这一部分，您需要更改默认的apache端口。为此，您应该编辑apache配置'<strong> ports.conf </strong>'和“sites-available”目录下的所有虚拟主机配置。</p><p>首先，转到Apache配置目录并运行:</p><pre><code class="language-bash">cd /etc/apache2</code></pre><p><strong> <em>注意</em> : </strong>你还需要将Apache配置'<strong> ports.conf </strong>'中的端口' 80 '替换为' 8080 '，以及“sites-available”目录下的所有虚拟主机文件。</p><p>为此，请使用下面的命令:</p><pre><code class="language-bash">sed -i -e 's/80/8080/g' ports.conf</code></pre><pre><code class="language-bash">sed -i -e 's/80/8080/g' sites-available/*</code></pre><p>现在，您可以<strong>测试</strong>Apache配置。如果您没有遇到错误，您可以重新启动Apache服务。</p><pre><code class="language-bash">apachectl configtest</code></pre><pre><code class="language-bash">systemctl restart apache2</code></pre><p>由于Apache运行在HTTP端口' 8080 '下，您可以使用以下命令来检查它:</p><pre><code class="language-bash">netstat -plntu</code></pre><h2><span class="ez-toc-section" id="How_To_Install_Varnish_On_Ubuntu_2004"/> <strong>如何在Ubuntu 20.04上安装清漆</strong> <span class="ez-toc-section-end"/></h2><p>在本节中，您可以使用以下命令从Ubuntu存储库中安装Varnish:</p><pre><code class="language-bash">apt install -y varnish</code></pre><p>安装完成后，运行以下命令启动Varnish并使在系统启动时自动启动:</p><pre><code class="language-bash">systemctl start varnish</code></pre><pre><code class="language-bash">systemctl enable varnish</code></pre><p>现在，你应该已经在Ubuntu 20.04上安装了Varnish，默认情况下，它运行在公共地址的端口“6081”和本地主机地址的端口“6082”下。要进行检查，请运行:</p><pre><code class="language-bash">netstat -plntu</code></pre><h3><span class="ez-toc-section" id="How_to_Configure_Varnish_HTTP_Cache_to_listen_on_port_80"/> <strong>如何配置Varnish HTTP Cache监听端口80 </strong> <span class="ez-toc-section-end"/></h3><p>因为Varnish将把HTTP请求转发到Apache web服务器，所以在这一步中，您将配置Varnish加速器监听端口80，然后配置Apache监听端口8080。</p><p><em>第一步:后端配置<br/> </em></p><p>转到' varnish '配置目录，备份默认文件'<strong> <em> default.vcl </em> </strong>':</p><pre><code class="language-bash">cd /etc/varnish/</code></pre><pre><code class="language-bash">cp default.vcl default.vcl.aseli</code></pre><p>这里，我们使用<a href="https://blog.eldernode.com/use-vi-full-text-editor/" target="_blank" rel="noopener"> vim编辑器</a>编辑清漆配置‘default . VCL’:</p><pre><code class="language-bash">vim default.vcl</code></pre><p>在第16行定义“后端”配置。我们设置的后端是Apache，它运行在端口8080上，保存并关闭它。</p><p><em>步骤2:在端口80上运行清漆</em></p><p>现在，您必须更改默认端口“6081”和“6082”。另外，您需要将公共地址的端口更改为HTTP端口80。</p><p>再次编辑“<strong> /etc/default”目录</strong>中的清漆参数配置。</p><pre><code class="language-bash">cd /etc/default/</code></pre><pre><code class="language-bash">vim varnish</code></pre><p>然后，编辑“<strong> DAEMON_OPTS </strong>”行，将公共地址的默认端口“6081”更改为标准HTTP端口“80”，保存并关闭它。</p><p>现在，是时候编辑清漆服务文件'<strong> varnish.service </strong>'了。为此，请转到“<strong> /lib/systemd/system </strong>”目录，并使用vim编辑服务文件:</p><pre><code class="language-bash">cd /lib/systemd/system/</code></pre><pre><code class="language-bash">vim varnish.service</code></pre><p>接下来，在'<strong> ExecStart </strong>'行，更改上光启动命令如下:</p><pre><code class="language-bash">ExecStart=/usr/sbin/varnishd -j unix,user=vcache -F -a :80 -T localhost:6082 -f /etc/varnish/default.vcl -S /etc/varnish/secret -s malloc,256m</code></pre><p>完成后，保存并关闭它。要重新加载systemd服务配置，然后<strong>重启</strong> varnish，请键入:</p><pre><code class="language-bash">systemctl daemon-reload</code></pre><pre><code class="language-bash">systemctl restart varnish</code></pre><p>最后，您可以检查varnish并确保它在HTTP端口80上运行。所以，运行:</p><pre><code class="language-bash">netstat -plntu</code></pre><p>如果一切正常，Varnish应该在HTTP端口80下运行，作为Apache web服务器的前端，它位于端口8080上。</p><h3><span class="ez-toc-section" id="How_to_test_Varnish_Cache_on_Apache"/> <strong>如何在Apache </strong>上测试清漆缓存<span class="ez-toc-section-end"/></h3><p>在本指南的最后一节中，您可以测试Varnish缓存是否已启用，以及是否与Apache HTTP服务器一起工作。为此，请运行以下命令:</p><pre><code class="language-bash">curl -I http://localhost</code></pre><p>最后，您将获得Apache内容。</p><p> </p><p><img data-lazyloaded="1" src="../Images/dfb328e99cd134912733d735d0266157.png" decoding="async" loading="lazy" class="size-large wp-image-29390 aligncenter" data-src="https://blog.eldernode.com/wp-content/uploads/2021/04/Cgr5L-659x1024.png" alt="How to test Varnish Cache on Apache" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/04/Cgr5L-659x1024.png 659w, https://blog.eldernode.com/wp-content/uploads/2021/04/Cgr5L-193x300.png 193w, https://blog.eldernode.com/wp-content/uploads/2021/04/Cgr5L-768x1194.png 768w, https://blog.eldernode.com/wp-content/uploads/2021/04/Cgr5L.png 805w" data-sizes="(max-width: 659px) 100vw, 659px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/04/Cgr5L-659x1024.png"/></p><p> </p><p>以下命令允许您检查清漆日志:</p><pre><code class="language-bash">varnishncsa</code></pre><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，您了解了如何在Ubuntu 20.04 <strong>上安装Varnish Cache for Apache。</strong>没什么不同您是需要基本功能的用户，还是拥有专业知识、时间和资源来构建定制模块的高级用户。然而，清漆将对你有用。如果您有兴趣了解更多，请找到我们关于在CentOS 8 上为Apache安装Varnish cache】的相关文章。</p></div></div>    
</body>
</html>