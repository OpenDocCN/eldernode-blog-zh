<html>
<head>
<title>How To Create An SSH Tunnel Or Port Forward In Linux - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Linux - Eldernode中创建SSH隧道或端口转发</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/how-to-create-an-ssh-tunnel-or-port-forward-in-linux/#0001-01-01">https://blog.eldernode.com/how-to-create-an-ssh-tunnel-or-port-forward-in-linux/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/9bd445b73724483cc38db92c9b965d04.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to create an SSH Tunnel or Port Forward in Linux" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/10/How-to-create-an-SSH-Tunnel-or-Port-Forward-in-Linux.png"/><p>[更新]网络上的每个设备都有一个IP。有两种类型的知识产权:公有和私有。公共IP地址在世界任何地方都可用。但是私有类型用于内部网络。例如192.168x.x或10.0x.x。为了从互联网接收信息，数据请求要么与路由器拥有的公共IP地址交换，要么与计算机或连接到网络的任何其它设备的地址相对应的私有IP地址交换。SSH转发对于传输使用未加密协议的服务的网络数据非常有用。在本文中，您将学习如何在Linux中创建SSH隧道或端口转发。逛逛<a href="https://eldernode.com/" target="_blank" rel="noopener"> Eldernode </a>的各种套餐，满足你买自己的<strong> <a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener"> Linux VPS </a> </strong>的期望。</p><h2><span class="ez-toc-section" id="What_Is_SSH_Port_Forwarding"/> <strong>什么是SSH端口转发？</strong>T3】</h2><p>SSH隧道或SSH端口转发非常简单，能够通过SSH隧道将内部网络流量路由到远程主机。这意味着所有传入流量都通过加密得到保护。该解决方案提供了一种创建VPN隧道的简单方法，这是一种通过互联网连接到专用网络的实用方法。它还可以使用互联网平台来访问位于NAT或防火墙后面的服务器。默认情况下，SSH会话允许所有网络通信的隧道。SSH端口转发目前有三种方法:本地、远程和动态。通常我们可以使用SSH安全地连接到我们的服务器。</p><h2><span class="ez-toc-section" id="Tutorial_Setup_SSH_Tunneling_Or_SSH_port_Forwarding_In_Linux"/> <strong>教程在Linux中设置SSH隧道或SSH端口转发</strong> <span class="ez-toc-section-end"/></h2><p>SSH隧道(也称为SSH端口转发)实际上是通过SSH将本地网络流量轻松路由到远程主机。这样，您所有的连接都是安全的加密。这提供了一种定义VPN(虚拟专用网络)的简单方法，VPN通过不安全的公共网络(如互联网)连接到专用网络。您还可以从一个安全的隧道平台访问NAT和防火墙后面的本地服务器，就像ngrok中实现的那样。</p><p> </p><p><img data-lazyloaded="1" src="../Images/210c26b6983791274f32e030c9007928.png" decoding="async" loading="lazy" class="aligncenter wp-image-16316 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/10/what-is-ssh-tunneling.png" alt="what is ssh tunneling" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/10/what-is-ssh-tunneling.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/10/what-is-ssh-tunneling-300x91.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/10/what-is-ssh-tunneling-1024x312.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/10/what-is-ssh-tunneling-768x234.png 768w" data-sizes="(max-width: 1536px) 100vw, 1536px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/10/what-is-ssh-tunneling.png"/></p><p> </p><p>默认情况下，SSH会话允许通过隧道进行网络通信。SSH端口转发也有三种类型:</p><p><strong> 1-本地</strong></p><p><strong> 2-动态</strong></p><p><strong> 3-远程</strong></p><p>我们继续下面关于缺省值的例子:</p><p><strong>本地主机:</strong>您的IP地址</p><p><strong>远程主机:</strong>server1.example.com</p><p>您可以使用SSH安全地连接到远程服务器，如下例所示。我已经在远程和本地主机之间配置了没有密码的ssh登录<a href="https://blog.eldernode.com/linux-login-without-entering-password/" target="_blank" rel="noopener">,所以没有要求我输入密码。</a></p><pre><code class="language-bash">ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7312171e1a1d33001601051601425d160b121e031f165d101c1e">[email protected]</a></code></pre><h3><span class="ez-toc-section" id="Local_SSH_Port_Forwarding"/> <strong>本地SSH端口转发</strong> <span class="ez-toc-section-end"/></h3><p>这种类型的端口转发允许您从本地计算机连接到远程服务器。假设您位于受限防火墙之后，或者被输出防火墙阻止访问远程服务器上端口3000上运行的应用程序。您可以转发一个本地端口(例如8080)，您可以使用该端口在本地访问应用程序。</p><p><em> <strong>注:</strong></em><strong>-L</strong>选项用于定义转发到远程主机的端口和远程端口。</p><pre><code class="language-bash">ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8aebeee7e3e4caf9eff8fceff8bba4eff2ebe7fae6efa4e9e5e7">[email protected]</a> -L 8080: server1.example.com:3000</code></pre><p>添加<strong> -N </strong>选项意味着不执行远程命令，在这种情况下，您将不会收到一个shell。</p><pre><code class="language-bash">ssh -N <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0f6e6b6266614f7c6a7d796a7d3e216a776e627f636a216c6062">[email protected]</a> -L 8080: server1.example.com:3000</code></pre><p><strong> -f </strong>选项在后台环境中执行ssh命令。</p><p>现在，在本地机器上打开浏览器，而不是访问远程应用程序。不用使用<strong><em>【server1.example.com:3000】</em></strong>，可以很容易地使用<strong> localhost: 8080 </strong>或<strong> YouIPAddress: 8080 </strong>如下图:</p><p> </p><p><img data-lazyloaded="1" src="../Images/f2ecbab75513e39f610fb81717a1e0fb.png" decoding="async" loading="lazy" class="aligncenter wp-image-32019 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/10/local-ssh-port-forwarding.jpg" alt="local-ssh-port-forwarding" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/10/local-ssh-port-forwarding.jpg 856w, https://blog.eldernode.com/wp-content/uploads/2020/10/local-ssh-port-forwarding-300x242.jpg 300w, https://blog.eldernode.com/wp-content/uploads/2020/10/local-ssh-port-forwarding-768x620.jpg 768w" data-sizes="(max-width: 856px) 100vw, 856px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/10/local-ssh-port-forwarding.jpg"/></p><h3/><h3><span class="ez-toc-section" id="Remote_SSH_Port_Forwarding"/> <strong>远程SSH端口转发</strong> <span class="ez-toc-section-end"/></h3><p>远程SSH端口转发允许您从远程机器将连接到本地计算机。</p><p><em> <strong>注意:</strong> </em>默认情况下，ssh不允许远程端口转发。您可以使用远程主机上的<strong> etc/ssh/sshd_config/ </strong>配置文件中的主sshd设置中的GatewayPorts部分来启用它。</p><p>打开文件并使用您最喜欢的文本编辑器编辑它:</p><pre><code class="language-bash">sudo vim /etc/ssh/sshd_config</code></pre><p>查找所需的部分，将其从注释中移除，并将其值设置为<strong> yes </strong>，如下所示:</p><p> </p><p><img data-lazyloaded="1" src="../Images/2549c0cd44f06857dbbf98bd28df2cf7.png" decoding="async" loading="lazy" class="aligncenter wp-image-32020 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/10/remote-ssh-port-forwarding-1-1.png" alt="remote-ssh-port-forwarding" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/10/remote-ssh-port-forwarding-1-1.png 492w, https://blog.eldernode.com/wp-content/uploads/2020/10/remote-ssh-port-forwarding-1-1-300x152.png 300w" data-sizes="(max-width: 492px) 100vw, 492px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/10/remote-ssh-port-forwarding-1-1.png"/></p><p> </p><p><strong>保存</strong>更改并退出。然后，为了应用更改，您需要重新启动sshd服务:</p><pre><code class="language-bash">sudo systemctl restart sshd</code></pre><p>运筹学</p><pre><code class="language-bash">sudo service sshd restart</code></pre><p>然后运行以下命令将<strong>远程机器</strong>上的<strong>端口5000 </strong>转发到<strong>本地机器</strong>上的<strong>端口3000 </strong>:</p><pre><code class="language-bash">ssh -f -N <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e081848d898ea0938592968592d1ce8598818d908c85ce838f8d">[email protected]</a> -R 5000:localhost:3000</code></pre><p>一旦您理解了这种隧道方法，您就可以轻松安全地发布本地编程服务器，尤其是当它位于NAT和防火墙之后时。</p><p>像<strong> Ngrok </strong>、<strong> pagekite </strong>、<strong> localtunnel、</strong>以及无数其他方法都是以同样的方式工作的。</p><h3><span class="ez-toc-section" id="Dynamic_SSH_Port_Forwarding"/> <strong>动态SSH端口转发</strong> <span class="ez-toc-section-end"/></h3><p>这是端口转发的第三种方法。与本地端口转发和远程不同，本地端口转发和远程可以与单独的端口进行通信，这种方法允许通过一系列端口进行全面的TCP通信。</p><p>动态端口转发方法将您的计算机设置并定义为SOCKS代理服务器，默认情况下在端口1080上运行。</p><p>首先，SOCKS是一种互联网协议，它定义了客户机如何通过代理服务器(这里是SSH)连接到服务器。您可以使用<strong> -D </strong>选项启用动态端口转发。</p><p>以下命令在端口1080上启动SOCKS代理，允许您连接到远程主机。</p><pre><code class="language-bash">ssh -f -N -D 1080 <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7110151c181f31021403071403405f1409101c011d145f121e1c">[email protected]</a></code></pre><p>从现在开始，您可以让您机器上的应用程序使用这个SSH代理服务器。你所要做的就是配置他们使用这个服务器。</p><p><em>注意【Socks代理将在会话ssh关闭后停止工作。</em></p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，我们解释了从一台机器到另一台机器的不同类型的端口转发，以及通过安全SSH连接的隧道通信。这是SSH的众多用途之一。端口转发ssh有很大的缺点，这个命令可能会产生负面影响。可用于绕过网络监控和流量过滤(或防火墙)应用程序。黑客可以利用它进行恶意活动。如果你有兴趣了解更多，可以在Mikrotik 上找到我们关于<a href="https://blog.eldernode.com/setup-ssh-tunnel-with-putty/" target="_blank" rel="noopener">用Putty </a>设置SSH隧道和<a href="https://blog.eldernode.com/port-forwarding-on-the-mikrotik/">端口转发的文章。</a></p></div></div>    
</body>
</html>