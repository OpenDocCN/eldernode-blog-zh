<html>
<head>
<title>Ways To Set Up SSH Keys on Debian 10 - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Debian 10 - Eldernode上设置SSH密钥的方法</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/ssh-keys-debian-10/#0001-01-01">https://blog.eldernode.com/ssh-keys-debian-10/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/3917aed33eaddb07348acfa89591dddc.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Ways To Set Up SSH Keys on Debian 10" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_2131.png"/><p>SSH或<span>安全外壳</span>是一种加密协议，用于管理<a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener noreferrer">服务器</a>并与之通信。当你在Debian 10的<span>服务器</span>上学习使用SSH时，你会发现你所有的时间都花在了通过SSH连接到你的服务器的终端会话上。由于我们上一篇关于<span> <a href="https://eldernode.com/tutorial-connect-to-ssh-on-linux/"> SSH教程</a>，</span>的文章，你可能已经熟悉了这个主题。</p><p> </p><p> </p><p> </p><h2><span class="ez-toc-section" id="Ways_To_Set_Up_SSH_Keys_on_Debian_10"/> <span>在Debian 10上设置SSH密钥的方法</span>T3】</h2><p>让我们通过本指南的步骤向您展示在Debian 10上设置SSH密钥是多么简单和安全。并使用<a href="https://eldernode.com/configure-ssh-authentication-linux/" target="_blank" rel="noopener noreferrer"> SSH密钥</a>登录您的服务器。除了这些功能，建议所有用户都使用。</p><p> </p><p> </p><h3 id="step-1-—-create-the-rsa-key-pair"><span class="ez-toc-section" id="Step_1_How_To_Create_the_RSA_Key_Pair"/> <span>第一步:如何创建RSA密钥对</span> <span class="ez-toc-section-end"/></h3><p>首先，让我们在客户机上创建一个密钥对。</p><pre><code class="language-bash">ssh-keygen</code></pre><p title="Output"><span>输出</span></p><pre><code class="language-bash">Generating public/private rsa key pair.  Enter file in which to save the key (/your_home/.ssh/id_rsa):</code></pre><p><strong> <span>注1</span></strong>:<span>ssh-keygen</span>的例程效果是创建一个2048位的RSA密钥对。有了这个，你可以确保安全。此外，考虑到您可以选择传入<span> -b 4096 </span>标志来创建一个更大的4096位密钥。</p><p><strong>注2 </strong>:不要忘记在命令提示行中替换您考虑的姓名或电子邮件。</p><p>现在，您需要将密钥对保存到<span>中。ssh/ </span>子目录或者指定一个替代路径。为此，请按enter键。</p><p>您可能已经生成了一个<a href="https://eldernode.com/ssh-connection-softwares/" target="_blank" rel="noopener noreferrer"> SSH密钥</a>对。如果是，您将看到以下提示:</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">/home/your_home/.ssh/id_rsa already exists.  Overwrite (y/n)?</code></pre><p><strong> <span>非常重要</span> </strong>:此时请注意，如果选择<strong>是</strong>，将无法反转。所以，当你确定的时候，选择覆盖磁盘上的密钥。因为在此之后，您就不能再使用之前的密钥进行身份验证了。</p><p>然后，您将看到如下所示的输出。</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">Enter passphrase (empty for no passphrase):</code></pre><p>现在，您可以输入一个安全的密码(可选)。这样，您会看到passphrase增加了一个额外的安全层，以防止未经授权的用户登录。如果您有兴趣了解更多关于安全性的知识，请阅读我们的指南<a href="https://eldernode.com/configure-ssh-authentication-linux/" target="_blank" rel="noopener noreferrer">教程在Linux服务器上配置SSH基于密钥的认证</a>。</p><p>然后，您将看到下面的输出:</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">Your identification has been saved in /your_home/.ssh/id_rsa.  Your public key has been saved in /your_home/.ssh/id_rsa.pub.  The key fingerprint is:  a9:49:2e:2a:5e:33:3e:a9:de:4e:77:11:58:b6:90:26 <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="394c4a5c4b5758545c794b5c54564d5c">[email protected]</a>_host  The key's randomart image is:  +--[ RSA 2048]----+  |     ..o         |  |   E o= .        |  |    o. o         |  |        ..       |  |      ..S        |  |     o o.        |  |   =o.+.         |  |. =++..          |  |o=++.            |  +-----------------+</code></pre><p>因此，您有一个可以用来进行身份验证的公钥和私钥。现在，尝试将公钥放在您的服务器上，以便您可以使用基于SSH密钥的身份验证来登录。</p><pre><code class="language-bash"/></pre><h3 id="step-2-—-copy-the-public-key-to-debian-server"><span class="ez-toc-section" id="Step_2_How_To_Copy_the_Public_Key_to_Debian_Server"/>第二步:如何将公钥复制到Debian服务器<span class="ez-toc-section-end"/></h3><p>让我们看看将您的公钥复制到Debian主机的最快方法是什么。您可以使用一个名为<span> ssh-copy-id </span>的实用程序。这里有一个简单的方法，非常值得推荐。如果您的客户机上没有可用的<span> ssh-copy-id </span>。在下文中，您将看到本节中提供的两种替代方法。</p><p> </p><h3 id="copying-public-key-using-ssh-copy-id"><span class="ez-toc-section" id="How_To_Copy_Public_Key_Using_ssh-copy-id"/>如何使用<span> ssh-copy-id </span>复制公钥<span class="ez-toc-section-end"/></h3><p>您的本地系统上可能有<span> ssh-copy-id </span>工具，因为它在许多操作系统中默认可用。要让这种方法起作用，基于密码的SSH应该是可访问的。</p><p>使用该实用程序的最佳方式是指定您选择连接的远程主机以及您拥有SSH访问密码的用户帐户。正如您所猜测的，这是您的公共SSH密钥将被复制到的帐户。</p><p>以下是考虑过的命令:</p><pre><code class="language-bash">ssh-copy-id <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="30454355425e515d557042555d5f4455">[email protected]</a>_host</code></pre><p><span>输出</span></p><pre><code class="language-bash">The authenticity of host '203.0.113.1 (203.0.113.1)' can't be established.  ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.  Are you sure you want to continue connecting (yes/no)? yes</code></pre><p>上面的输出告诉您，您的本地计算机无法识别远程主机。因为这是您第一次连接到新主机。像往常一样，键入yes”并按ENTER键继续。</p><p>之后，该实用程序将扫描您的本地帐户，查找您之前创建的<span> id_rsa.pub </span>密钥。当它找到密钥时，您将提示输入远程用户帐户的密码。</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed  /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys  <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="20555345524e414d45601210130e100e1111130e11">[email protected]</a>'s password:</code></pre><p>现在，输入密码并按下<span>键进入</span>。因此，使用您提供的密码，该工具将连接到远程主机上的帐户。之后，它会复制你的<span>的内容。ssh/id_rsa.pub </span> key到远程账号的home <span> ~/中的一个文件中。ssh </span>目录调用<span> authorized_keys </span>。</p><p>现在，您会看到如下所示的输出:</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">Number of key(s) added: 1    Now try logging into the machine, with:   "ssh '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="61141204130f000c04215351524f514f5050524f50">[email protected]</a>'"  and check to make sure that only the key(s) you wanted were added.</code></pre><p>现在，您可以确保您的<span> id_rsa.pub </span>密钥已经上传到远程帐户。</p><p> </p><p> </p><h3 id="copying-public-key-using-ssh"><span class="ez-toc-section" id="How_to_Copy_Public_Key_Using_SSH"/>如何使用SSH复制公钥<span class="ez-toc-section-end"/></h3><p>在没有可用的<span> ssh-copy-id </span>的情况下，您可以使用传统的ssh方法上传您的密钥，但是您可以通过基于密码的SSH访问您服务器上的帐户。</p><p>使用<span> cat </span>命令，您可以做到这一点，让它读取本地计算机上的公共SSH密钥的内容，并通过SSH连接将其传输到远程服务器。</p><p>此外，您可以确保存在<span> ~/。ssh </span>目录，并在您使用的帐户下拥有正确的权限。</p><p>因此，您可以将我们通过管道传输的内容输出到这个目录中一个名为<span> authorized_keys </span>的文件中。您可以使用<span> &gt; &gt; </span>重定向符号追加内容，而不是覆盖内容。这样，您可以添加密钥，而不会破坏以前添加的密钥。</p><p>完整的命令如下所示:</p><pre><code class="language-bash">cat ~/.ssh/id_rsa.pub | ssh <span class="highlight">username</span>@<span class="highlight">remote_host</span> "mkdir -p ~/.ssh &amp;&amp; touch ~/.ssh/authorized_keys &amp;&amp; chmod -R go= ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys"</code></pre><p><span>输出</span></p><pre><code class="language-bash">The authenticity of host '203.0.113.1 (203.0.113.1)' can't be established.  ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.  Are you sure you want to continue connecting (yes/no)? yes</code></pre><p>通过接收此输出，您可以看到您的本地计算机无法识别远程主机。像往常一样，键入“yes”并按下<span>键，输入</span>继续。</p><p>在下面，将提示您输入远程用户帐户密码:</p><p title="Output"><span>输出</span></p><pre><code class="language-bash"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="463335233428272b23067476756876687777756877">[email protected]</a>'s password:</code></pre><p>一旦您输入密码，您的<span> id_rsa.pub </span>密钥的内容将被复制到远程用户账户的<span> authorized_keys </span>文件的末尾。</p><p> </p><h3/><h3 id="copying-public-key-manually"><span class="ez-toc-section" id="How_To_Copy_Public_Key_Manually"/>如何手动复制公钥<span class="ez-toc-section-end"/></h3><p>如果您无法使用基于密码的SSH访问服务器，请尝试手动完成上述过程。</p><p>将您的<span> id_rsa.pub </span>文件的内容附加到<span> ~/中。远程机器上的ssh/authorized_keys </span>文件将手动完成。</p><p>现在，在您的本地计算机中键入以下命令来显示您的<span> id_rsa.pub </span>密钥的内容。</p><pre><code class="language-bash">cat ~/.ssh/id_rsa.pub</code></pre><p title="Output"><span>输出</span></p><pre><code class="language-bash">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCqql6MzstZYh1TmWWv11q5O3pISj2ZFl9HgH1JLknLLx44+tXfJ7mIrKNxOOwxIxvcBF8PXSYvobFYEZjGIVCEAjrUzLiIxbyCoxVyle7Q+bqgZ8SeeM8wzytsY+dVGcBxF6N4JS+zVk5eMcV385gG3Y6ON3EG112n6d+SMXY0OEBIcO6x+PnUSGHrSgpBgX7Ks1r7xqFa7heJLLt2wWwkARptX7udSq05paBhcpB0pHtA1Rfz3K2B+ZVIpSDfki9UVKzT8JUmwW6NNzSgxUfQHGwnW7kj4jp4AT0VZk3ADw497M2G/12N0PPB5CnhHf7ovgy6nL1ikrygTKRFmNZISvAcywB9GVqNAVE+ZHDSCuURNsAInVzgYo9xgJDW8wUw2o8U77+xiFxgI5QSZX3Iq7YLMgeksaO4rBJEa54k8m5wEiEE1nUhLuJ0X/vh2xPff6SQ1BL/zkOhvJCACK6Vb15mDOeCSq54Cr7kvS46itMosi/uS66+PujOO+xt/2FWYepz6ZlN70bRly57Q06J+ZJoc9FfBCbCyYH7U/ASsmY095ywPsBo1XQ9PqhnN1/YOorJ068foQDNVpm146mUpILVxmq41Cj55YKHEazXGsdBIbXWhcrRf4G2fJLRcGUr9q8/lERo9oxRm5JFX6TCmj6kmiFqv+Ow9gI0x8GvaQ== <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a0c4c5cdcfe0d4c5d3d4">[email protected]</a></code></pre><p>尝试访问您的远程主机，然后确保存在<span> ~/。ssh </span>目录。使用以下命令将在必要时创建目录，如果目录已经存在，则不执行任何操作。</p><pre><code class="language-bash">mkdir -p ~/.ssh</code></pre><p>是时候修改这个目录中的<span> authorized_keys </span>文件了。此外，您可以将您的<span> id_rsa.pub </span>文件的内容添加到<span> authorized_keys </span>文件的末尾。</p><pre><code class="language-bash">echo public_key_string &gt;&gt; ~/.ssh/authorized_keys</code></pre><p>在上面的命令中，用来自<span> cat ~/的输出替换<span> public_key_string </span>。您在本地系统上执行的ssh/id_rsa.pub </span>命令。应该从<span> ssh-rsa AAAA开始…</span></p><p>最后，键入下面的命令来确保<span> ~/。ssh </span>目录和<span> authorized_keys </span>文件有适当的权限设置:</p><pre><code class="language-bash">chmod -R go= ~/.ssh</code></pre><p>使用此命令会导致移除<span> ~/的所有“群组”和“其他”权限。ssh/ </span>目录。</p><p>请注意，如果您使用<span> root </span>帐户为用户帐户设置密钥，那么<span> ~/也很重要。ssh </span>目录属于用户，不属于<span>根目录</span>:</p><pre><code class="language-bash">chown -R <span class="highlight">noodi</span>:<span class="highlight">noodi</span> ~/.ssh</code></pre><p>正如您所猜测的，我们在本指南中的用户名为<span class="highlight"> noodi </span>，但是您应该将适当的用户名替换到上面的命令中。</p><p>此时，您可以尝试用您的Debian服务器进行无密码认证。如果您需要验证CentOS 8的情况，请查看我们的文章<a href="https://blog.eldernode.com/set-up-ssh-keys-on-centos-8/" target="_blank" rel="noopener noreferrer">教程在CentOS 8上设置SSH键</a></p><p class="blog-details"/><p> </p><h3 id="step-3-—-authenticate-to-debian-server-using-ssh-keys"><span class="ez-toc-section" id="Step_3_How_to_Authenticate_to_Debian_Server_Using_SSH_Keys"/>步骤3:如何使用SSH密钥认证Debian服务器<span class="ez-toc-section-end"/></h3><p>如果最近的所有步骤都已成功完成，您应该能够在没有远程帐户密码的情况下登录到远程主机。</p><pre><code class="language-bash">ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="34414751465a555951744651595b4051">[email protected]</a>_host</code></pre><p><span>输出</span></p><pre><code class="language-bash">The authenticity of host '203.0.113.1 (203.0.113.1)' can't be established.  ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.  Are you sure you want to continue connecting (yes/no)? <span>yes</span></code></pre><p><strong>点</strong>:当你第一次连接这台主机时，你看到上面的输出。</p><p>此外，它还告诉您，您的本地计算机无法识别远程主机。键入“yes”然后按<span>回车</span>继续。</p><p>因此，如果您没有提供私钥的密码，您将立即登录。然后，如果您在创建密钥时提供了私钥的密码，系统会提示您现在输入密码。毕竟，当验证完成时，您将会看到一个新的shell会话将会为您打开，并在Debian服务器上配置好帐户。</p><p>如果基于密钥的身份验证成功，您可以继续学习如何通过禁用密码身份验证来进一步保护您的系统。</p><p> </p><p> </p><h3 id="step-4-—-disable-password-authentication-on-your-server"><span class="ez-toc-section" id="Step_4_How_To_Disable_Password_Authentication_on_your_Server"/>步骤4:如何在您的服务器上禁用密码验证<span class="ez-toc-section-end"/></h3><p>在这一步中，您可以使用SSH登录到您的帐户，而不需要密码，只要您已经成功地为您的帐户配置了基于SSH密钥的身份验证。但是请注意，尽管您的基于密码的身份验证机制仍然有效，但是您的服务器仍然面临暴力攻击。</p><p>检查您是否为该服务器上的root帐户配置了基于SSH密钥的身份验证，或者最好为该服务器上具有<span> sudo </span>权限的非root帐户配置了基于SSH密钥的身份验证。</p><p>从现在开始，您将看到它将如何锁定基于密码的登录，因此确保您仍然能够获得管理访问是至关重要的。</p><p>当您确认您的远程帐户具有管理权限时，使用SSH密钥登录到您的远程服务器。它既可以作为根用户，也可以使用拥有<span> sudo </span>权限的帐户。然后，打开SSH守护程序的配置文件:</p><pre><code class="language-bash">sudo nano /etc/ssh/sshd_config</code></pre><p>在文件内部，搜索名为<span> PasswordAuthentication </span>的指令。这可能会被注释掉。取消对该行的注释，并将值设置为“no”。这将禁止您使用帐户密码通过SSH登录:</p><p class="code-label" title="/etc/ssh/sshd_config">/etc/ssh/sshd_config</p><pre><code class="language-bash">...  PasswordAuthentication no  ...</code></pre><p>现在，您可以在完成后保存并关闭文件。你可以通过按<span> CTRL </span> + <span> X </span>，然后按<span> Y </span>确认保存文件，最后<span>回车</span>退出nano。</p><p>要重新启动<span> sshd </span>服务并实现这些更改:</p><pre><code class="language-bash">sudo systemctl restart ssh</code></pre><p>为了更多地考虑安全性，请打开一个新的终端窗口，并在关闭该会话之前测试SSH服务是否正常工作:</p><pre><code class="language-bash">ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aadfd9cfd8c4cbc7cfead8cfc7c5decf">[email protected]</a>_host</code></pre><p>接下来，当您验证了您的SSH服务后，您可以关闭所有当前的服务器会话。请注意，Debian服务器上的SSH守护进程现在只响应SSH密钥。已成功禁用基于密码的身份验证。</p><pre><code class="language-bash"/></pre><p> </p><h2><span class="ez-toc-section" id="conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>您已经通过了本指南的四个步骤，并学习了如何在Debian 10上设置SSH密钥。您可能也有兴趣获得关于其他服务器上SSH的更多信息。我们推荐你看一下<a href="https://blog.eldernode.com/set-up-ssh-keys-ubuntu-20/" target="_blank" rel="noopener noreferrer">如何在Ubuntu 20.04 </a>上设置SSH密钥。但是，从现在开始，您已经在服务器上配置了基于SSH密钥的身份验证，允许您在不提供帐户密码的情况下登录。</p></div></div>    
</body>
</html>