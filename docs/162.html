<html>
<head>
<title>Move backup from Cpanel to the DirectAdmin - Directadmin Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>将备份从Cpanel移动到DirectAdmin - Directadmin服务器</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/move-backup-from-cpanel-to-the-directadmin/#0001-01-01">https://blog.eldernode.com/move-backup-from-cpanel-to-the-directadmin/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/433a49e865511853fa6b5e5ff458a1ba.png" data-src="https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Move backup from Cpanel to the DirectAdmin" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin.png 2069w, https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2019/10/Move-backup-from-Cpanel-to-the-DirectAdmin.png"/><p>将备份从Cpanel移动到DirectAdmin由于Cpanel在<a href="http://eldernode.com/vps-hosting/" target="_blank" rel="noopener noreferrer">许可</a>方面的变化，如今许多站长正计划将他们的网站从Cpanel转移到<a href="https://blog.eldernode.com/tag/direct-admin/" target="_blank" rel="noopener noreferrer"> DirectAdmin </a>。如果你已经决定移动到DirectAdmin，请阅读本教程到最后，这样你就可以轻松地移动所有的文件，没有任何问题。</p><h4><span class="ez-toc-section" id="Things_to_Know_Before_You_Can_Transfer_Backups_from_Cpanel_to_the_DirectAdmin"/> <strong>将备份从Cpanel传输到DirectAdmin之前需要了解的事项:</strong> <span class="ez-toc-section-end"/></h4><ul><li>您在<strong> CPanel </strong>中创建的备份文件的格式必须是“【cpmove-user.tar.gz】T2的格式</li><li>您的DirectAdmin版本应该高于1/57/4</li><li>检查您的服务器上是否安装了最新版本的Roundcube</li></ul><p>请注意，<strong> CPanel </strong>中邮件列表部分的内容不会传输到DirectAdmin。</p><p>DirectAdmin使用的数据库名称和数据库用户名的格式始终是:“<strong>用户名_数据库</strong>和“<strong>用户名_用户</strong>”。<strong> CPanel </strong>也使用相同的格式，但是通常由于数据库名称和数据库用户之间存在的限制，<strong> CPanel </strong>通常会缩短用户名字段。</p><p> </p><p>但是，DirectAdmin总是将用户名部分完全放在字符串的开头。在将<strong> CPanel </strong>备份转换为DirectAdmin时也是如此，因此在移动之后，您需要更改“【wp-config.php】”文件和存储在其他数据库脚本中的类似文件。</p><p>如果您的<strong> CPanel </strong>备份是由“<strong> Jetbackup </strong>”插件提供的，请注意该插件的输出文件不是“<strong> cpmove-user </strong>”，需要转换。下面是怎么做的。</p><h4><span class="ez-toc-section" id="Note"/>注:<span class="ez-toc-section-end"/></h4><p>我们建议您在将备份转移和恢复到服务器上的DirectAdmin后，保留名为“【cpmove-user.tar.gz】”的<strong> CPanel </strong>核心备份文件，以防仍然由您处理的站点备份文件出现问题或错误。</p><p><a href="https://www.directadmin.com/" target="_blank" rel="noopener noreferrer"> DirectAdmin </a>拥有CPanel所没有的特性，比如直接支持<strong>nginx</strong>/<strong>openlitespeed</strong>、<strong> mysql8 </strong>、<strong> rspamd </strong>等。还有DirectAdmin中不支持的东西，比如<strong> rubby </strong>和<strong> postgresql </strong>。</p><p>因此，如果你有一个网站使用这两个你需要手动转移。</p><p>DirectAdmin中的系统用户名字符串的最大长度是10个字符，MySQL中的最大长度是16个字符，您可以通过下面描述的方法增加该长度。</p><p>如果您有许多CPanel备份，其格式被称为<strong>user.tar.gz</strong>，您通常可以在尝试恢复备份之前将它们转换为正确的<strong> cpmove-user </strong>格式。</p><p>如果您有许多格式为<strong> backup的CPanel备份-…_user.tar.gz </strong>，在尝试恢复备份之前，您通常可以将它们转换回正确的<strong> cpmove-user </strong>格式。</p><p>转移后，您可能看不到“<strong>在经销商</strong>之间移动用户”部分中的部分已转移用户列表，修复此问题的方法将在下面讨论。</p><h3><span class="ez-toc-section" id="Jetpack_Backup_Converter"/> <strong> Jetpack备份转换器:</strong> <span class="ez-toc-section-end"/></h3><p>由于Jetpack插件不生成<strong> cpmove-user </strong>格式的备份，您需要将该插件的备份转换到DirectAdmin来恢复它。为此，在将文件传输到ssh上的DirectAdmin服务器后，运行以下命令。</p><table><tbody><tr><td>jetbackup=yes /usr/local/directadmin/scripts/cpanel_to_da/cpanel_to_da.sh /home/admin/user_backups/cpmove-USERNAME.tar.gz /home/admin/converted_user_backup<p>chown -R管理。/home/admin/converted _ user _ backup</p></td></tr></tbody></table><p><strong>增加DirectAdmin: </strong>中系统和MySQL用户名的字符串长度</p><p>DirectAdmin在命名系统用户时最多支持10个字符，在命名数据库和数据库用户时最多支持16个字符。您可以通过在ssh DirectAdmin服务器上执行以下命令来最大化这个数字。</p><table><tbody><tr><td>/usr/local/direct admin/direct admin set max _用户名_长度16重新启动</td></tr></tbody></table><h3><span class="ez-toc-section" id="Convert_Cpanel_backups_to_the_correct_format_for_transfer_to_the_DirectAdmin"/> <strong>将Cpanel备份转换为正确的格式，以便传输到DirectAdmin: </strong> <span class="ez-toc-section-end"/></h3><p>如果您的CPanel中有形式为<strong>user.tar.gz</strong>或<strong>备份-… -user.tar.gz </strong>的备份，您必须在尝试将它们恢复到DirectAdmin之前将它们转换为<strong>cpmove.tar.gz</strong>。您可以按照下面的说明简单地执行这种转换。如果您的备份是以<strong>user.tar.gz</strong>的形式，运行以下命令:</p><table><tbody><tr><td>对于I in ` ls * . tar . gz | grep '^[a-za-z0-9]*.tar.gz'`；do { mv-VF $ { I } CP move-$ { I }；};完成的</td></tr></tbody></table><p>如果您的备份是以<strong> backup-… -user.tar.gz </strong>的形式，请运行以下命令:</p><table><tbody><tr><td>for i in `ls backup-[0-9]*。* . tar . gz `；do { USERNAME = ` echo $ I | cut-d _-F3 | cut-d ' . '-f1 `；mv-v $ I CP move-$ { USERNAME } . tar . gz；};完成的</td></tr></tbody></table><p>请注意，要在备份所在的目录中运行上述命令。</p><p> </p><h3><span class="ez-toc-section" id="Fixed_the_problem_of_not_displaying_the_user_in_the_Move_users_between_resellers_section_of_the_DirectAdmin"/> <strong>修复了DirectAdmin </strong> <strong> : </strong> <span class="ez-toc-section-end"/>的“在经销商之间移动用户”部分不显示用户的问题</h3><p>如果在DirectAdmin中恢复备份后没有看到所有用户或某些用户，并参考DirectAdmin的“在经销商之间移动用户”部分，请在ssh DirectAdmin服务器上运行以下命令。</p><table><tbody><tr><td>#!/bin/sh<p>CD/usr/local/direct admin/data/users</p><p>对于' ls */reseller.conf | cut -d/ -f1 '中的r；做</p><p>{</p><p>echo“修复经销商$ r…”；</p><p>echo -n " &gt; $r/users.list</p><p>for u in ` grep " ^creator=$r$ " */user . conf | cut-d/-f1 `；做</p><p>{</p><p>ISUSER=`grep -c usertype=user $u/user.conf`</p><p>if[" $ I user " = " 1 "]；然后</p><p>echo $u &gt;&gt; $r/users.list</p><p>船方不负担装货费用</p><p>};</p><p>搞定；</p><p>};</p><p>搞定；</p></td></tr></tbody></table><h3><span class="ez-toc-section" id="Fix_the_problem_of_not_having_users_in_the_correct_representative_subset"/> <strong>修复正确代表子集中没有用户的问题:</strong> <span class="ez-toc-section-end"/></h3><p>如果在备份DirectAdmin时没有首先返回委托，用户将被创建为管理员子集。要解决此问题，请在备份所在的目录中运行以下命令。</p><table><tbody><tr><td>for i in `ls user*.tar.gz`; do { RESELLER=`echo $i | cut -d. -f2`; USER=`echo $i | cut -d’.’ -f3`; /usr/local/directadmin/scripts/move_user_to_reseller.sh $USER admin $RESELLER; }; done<p>echo " action = cache &amp; value = showall users " &gt; &gt;/usr/local/direct admin/data/task . queue</p><p>/usr/local/direct admin/dataskq d</p></td></tr></tbody></table><h3><span class="ez-toc-section" id="Start_the_process_of_transferring_backups_from_CPanel_to_Directadmin"/> <strong>开始将备份从CPanel转移到Directadmin的过程:</strong> <span class="ez-toc-section-end"/></h3><p>”将备份从Cpanel移动到DirectAdmin”:</p><p>要开始传输，首先，在CPanel服务器中登录到您的ssh，并仔细执行以下两个步骤。</p><p><strong> 1。</strong>首先，通过执行以下命令创建所有CPanel帐户的备份。</p><table><tbody><tr><td>mkdir -p /home/all_backups<p>对于“ls /var/cpanel/users/”中的用户；do {/scripts/pkgacct $ { user }/home/all _ backups；};完成的</p></td></tr></tbody></table><p><strong> 2。</strong>在服务器上完成备份过程后，使用以下命令将创建的备份文件传输到DirectAdmin:</p><table><tbody><tr><td>rsync-avt–delete/home/all _ backups/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ed9f828299ad9482989f">【电子邮件保护】</a>_ direct admin _ server . com:/home/admin/all _ backups/</td></tr></tbody></table><p>将备份文件传输到新服务器后，连接到DirectAdmin服务器的ssh服务器，并执行以下命令:</p><table><tbody><tr><td>cd /usr/local/directadmin/custombuild<p>。/build更新</p><p>。/build cpanel_to_da</p><p>chown -R管理。/home/admin/all_backups</p></td></tr></tbody></table><p>完成以上步骤后，进入DirectAdmin，进入<strong>备份&amp;恢复</strong>部分，即可轻松恢复<strong> /home/admin/all_backups </strong>中的备份。</p><p>将备份从Cpanel移动到DirectAdmin。</p><p>祝您好运</p></div></div>    
</body>
</html>