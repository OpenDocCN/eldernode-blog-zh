<html>
<head>
<title>Tutorial Install and use SonarQube on Ubuntu 20.04 - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>教程在Ubuntu 20.04上安装和使用sonar cube-elder node</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-and-use-sonarqube-on-ubuntu/#0001-01-01">https://blog.eldernode.com/install-and-use-sonarqube-on-ubuntu/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/deb91fe35ab1e9fc07db359b95518346.png" data-src="https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Tutorial Install and use SonarQube on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04.png 2069w, https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/06/Tutorial-Install-and-use-SonarQube-on-Ubuntu-20.04.png"/><p>Sonar是一个高质量的源代码管理工具。这个工具能够覆盖和分析设计、编码规则、文档、复制、单元测试、复杂性和程序错误这七个方面的编程质量。Sonar有能力结合指标来生成统计报告。这个工具可以用来分析几乎所有编程语言的源代码。在这篇文章中，我们将教你关于在Ubuntu 20.04 上安装和使用SonarQube的<strong>教程。如果你想购买一台<a href="https://eldernode.com/ubuntu-vps/" target="_blank" rel="noopener"> <strong> Ubuntu VPS </strong> </a>服务器，你可以访问<a href="https://eldernode.com/"> Eldernode </a>中提供的软件包。</strong></p><h2><span class="ez-toc-section" id="Introduction_to_SonarQube"/><strong>SonarQube</strong>简介<span class="ez-toc-section-end"/></h2><p>一般来说，使用SonarQube有以下好处:</p><p><strong> _持续检查:</strong>在SonarQube的帮助下，代码的质量可以得到系统性的提升。</p><p><strong> _识别欺骗性问题:</strong>在这个程序的帮助下，不引用空指针、逻辑错误等欺骗性问题都可以检查识别。</p><p><strong> _与DevOps的集成:</strong>使用该软件的webhooks和内部RestAPI，可以集成制造系统、CI引擎、开发管道等所有DevOps工具。</p><p><strong> _集中质量:</strong>借助该程序，可以集中管理整个项目控制过程的质量</p><p>SonarQube还具有以下特性:</p><p>1-支持用Python、Javascript、Java等多种语言编写的程序的源代码分析。</p><p>2-支持用PL/SQL和TSQL语言编写的数据库函数和过程的源代码分析</p><p>3-支持客户端源代码分析，如JavaScript、CSS、HTML等。</p><p>4-支持Android和iOS等平台下的移动应用程序的源代码分析</p><p>5-从不同的角度分析编程质量，例如设计、编码原则、文档数量、可重用性和复杂性</p><p>6-提供多个图表和统计数据来识别编程错误</p><p>7-提供代码分析结果的综合报告</p><p>下一节，我们将教你如何在<a href="https://blog.eldernode.com/tag/ubuntu/"> Ubuntu </a> 20.04上安装SonarQube。请加入我们。</p><h3><span class="ez-toc-section" id="How_to_Install_Java_on_Ubuntu_2004"/> <strong>如何在Ubuntu 20.04上安装Java</strong><span class="ez-toc-section-end"/></h3><p>鉴于安装SonarQube的先决条件之一是安装Java，所以在这一节中，我们打算教你如何安装Java。为此，只需遵循以下步骤。</p><p>您必须首先使用以下命令更新系统:</p><pre><code class="language-bash">apt update</code></pre><p>在下一步中，如果你想使用<strong> JRE </strong>，你可以使用下面的命令:</p><pre><code class="language-bash">apt install default-jre</code></pre><p>如果您想使用<strong> OpenJDK </strong>，也可以使用以下命令:</p><pre><code class="language-bash">apt install default-jdk</code></pre><h3><span class="ez-toc-section" id="How_to_Install_and_Setup_Database_for_SonarQube_on_Ubuntu_2004"/>如何在Ubuntu 20.04上安装和设置SonarQube的数据库<span class="ez-toc-section-end"/></h3><p>有趣的是，SonarQube支持Windows系统的PostgreSQL、Oracle或MSSQL。在本节中，我们将教您如何安装PostgreSQL。您可以使用以下命令安装PostgreSQL:</p><pre><code class="language-bash">apt install postgresql postgresql-contrib</code></pre><p>现在，您应该以PostgreSQL超级用户的身份登录，并使用以下命令<strong>创建SonarQube PostgreSQL数据库</strong>和<strong>数据库用户</strong>:</p><pre><code class="language-bash">sudo -Hiu postgres</code></pre><pre><code class="language-bash">createuser sonaradmin</code></pre><pre><code class="language-bash">createdb -O sonaradmin sonarqubedb</code></pre><pre><code class="language-bash">psql</code></pre><pre><code class="language-bash">ALTER USER sonaradmin WITH ENCRYPTED password 'changeme';</code></pre><pre><code class="language-bash">\q</code></pre><pre><code class="language-bash">exit</code></pre><p>成功创建并启动PostgreSQL数据库后，现在应该启用安全计算过滤器。需要注意的是，在Ubuntu 20.04上，<strong> Seccomp滤镜</strong>通常默认开启。但是您可以使用下面的命令来检查您的内核中是否存在Seccomp:</p><pre><code class="language-bash">grep SECCOMP /boot/config-$(uname -r)</code></pre><p>最后，安装SonaQube的另一个先决条件是用于生成SonarQube可执行报告的Fontconfig和FreeType字体。您可以使用以下命令来安装它们:</p><pre><code class="language-bash">apt install fontconfig-config libfreetype6</code></pre><h2><span class="ez-toc-section" id="How_to_Install_SonarQube_on_Ubuntu_2004"/> <strong>如何在Ubuntu 20.04上安装sonar cube</strong><span class="ez-toc-section-end"/></h2><p>在这一节，我们想一步一步地教你如何在Ubuntu 20.04上安装SonarQube。为此，只需遵循以下步骤。</p><p>第一步，你要下载SonarQube。要获得下载链接，可以参考<a href="https://binaries.sonarsource.com/Distribution/sonarqube/">sonar cube二进制页面</a>。然后使用以下命令下载SonarQube:</p><pre><code class="language-bash">wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.7.0.41497.zip</code></pre><p>成功下载文件后，您现在必须通过执行以下命令<strong>提取</strong>文件:</p><pre><code class="language-bash">apt install zip</code></pre><pre><code class="language-bash">unzip sonarqube-8.7.0.41497.zip -d /opt/</code></pre><p>您也可以重命名SonarQube来删除版本号:</p><pre><code class="language-bash">mv /opt/sonarqube{-8.7.0.41497,}</code></pre><p>安装sonar cube后，现在可以通过执行以下步骤来创建sonar cube系统帐户。需要记住的一点是，SonarQube不应该以root身份运行。因此，您需要创建一个<strong>非管理员帐户</strong>来运行SonarQube:</p><pre><code class="language-bash">useradd -M -d /opt/sonarqube/ -r -s /bin/bash sonarqube</code></pre><p>最后，您应该使用以下命令将<strong>/opt/sonar cube</strong>的所有权设置为上面创建的sonar用户:</p><pre><code class="language-bash">chown -R sonarqube: /opt/sonarqube</code></pre><h3><span class="ez-toc-section" id="Configure_SonarQube_on_Ubuntu_2004"/> <strong>在Ubuntu 20.04上配置sonar cube</strong><span class="ez-toc-section-end"/></h3><p>成功安装SonarQube后，可以在此阶段对其进行配置。因此，您可以根据上面的PostgreSQL设置来配置数据库连接细节。只需用一个文本编辑器打开配置文件。这里我们使用vim文本编辑器:</p><pre><code class="language-bash">vim /opt/sonarqube/conf/sonar.properties</code></pre><p>对配置文件进行以下更改后，您可以<strong>保存</strong>并退出:</p><pre><code class="language-bash"># DATABASE  ...  # User credentials.  ...  sonar.jdbc.username=sonaradmin  sonar.jdbc.password=changeme  ...  #----- PostgreSQL 9.3 or greater  # By default the schema named "public" is used. It can be overridden with the parameter "currentSchema".  #sonar.jdbc.url=jdbc:postgresql://localhost/sonarqube?currentSchema=my_schema  sonar.jdbc.url=jdbc:postgresql://localhost/sonarqubedb</code></pre><h3><span class="ez-toc-section" id="How_to_Run_and_Use_SonarQube_on_Ubuntu_2004"/> <strong>如何在Ubuntu 20.04上运行和使用sonar cube</strong><span class="ez-toc-section-end"/></h3><p>在这一节中，我们将教你如何运行和使用SonarQube。您可以使用以下脚本绕过start选项以独立模式启动SonarQube。如下面的脚本开始所示，最好使用systemd服务单元:</p><pre><code class="language-bash">/opt/sonarqube/bin/linux-x86-64/sonar.sh</code></pre><p>您可以使用以下命令<strong>创建一个SonarQube Systemd服务</strong>单元文件:</p><p><em> <strong>注:</strong> </em>替换以下命令中的路径，<strong>/opt/sonar cube/lib/sonar-application-8 . 7 . 0 . 41497 . jar</strong>:</p><pre><code class="language-bash">cat &gt; /etc/systemd/system/sonarqube.service &lt;&lt; 'EOL'  [Unit]  Description=SonarQube service  After=syslog.target network.target    [Service]  Type=simple  User=sonarqube  Group=sonarqube  PermissionsStartOnly=true  ExecStart=/bin/nohup java -Xms32m -Xmx32m -Djava.net.preferIPv4Stack=true -jar /opt/sonarqube/lib/sonar-application-8.7.0.41497.jar  StandardOutput=syslog  LimitNOFILE=131072  LimitNPROC=8192  TimeoutStartSec=5  Restart=always  SuccessExitStatus=143    [Install]  WantedBy=multi-user.target  EOL</code></pre><p>在下一步中，您必须使用以下命令重新加载systemd配置:</p><pre><code class="language-bash">systemctl daemon-reload</code></pre><p>我们建议您在下一步中使用以下命令为elasticsearch设置最大内存映射数:</p><pre><code class="language-bash">echo 'vm.max_map_count=262144' &gt;&gt; /etc/sysctl.conf</code></pre><pre><code class="language-bash">sysctl -p</code></pre><p>如果您已经正确地遵循了本教程中的所有步骤，现在您可以使用以下命令轻松地<strong>运行并启用sonar cube</strong>:</p><pre><code class="language-bash">systemctl enable --now sonarqube</code></pre><p>您现在需要安装一个Apache或T2的Nginx web服务器来访问SonarQube web界面。这里我们<strong>使用以下命令安装Nginx </strong>服务器:</p><pre><code class="language-bash">apt install nginx -y</code></pre><p>您现在可以通过运行以下命令来<strong>启用SonarQube Nginx站点</strong>:</p><pre><code class="language-bash">ln -s /etc/nginx/sites-available/sonarqube /etc/nginx/sites-enabled/</code></pre><p>最后，您需要使用以下命令<strong>重启Nginx </strong>:</p><pre><code class="language-bash">systemctl restart nginx</code></pre><p>需要记住的重要一点是，打开防火墙上的<strong>端口80/TCP </strong>或<strong>端口443/TCP </strong>:</p><pre><code class="language-bash">ufw allow "Nginx Full"</code></pre><p>您可以使用以下URL访问SonarQube:</p><pre><code class="language-bash">http://sonarqube-server-host-IP-or-hostname</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/fa8466ee36076de80b297880e44361b6.png" decoding="async" loading="lazy" class="aligncenter wp-image-33542 size-large" data-src="https://blog.eldernode.com/wp-content/uploads/2021/06/SonarQube-login-page-1024x524.jpeg" alt="SonarQube login page" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/06/SonarQube-login-page-1024x524.jpeg 1024w, https://blog.eldernode.com/wp-content/uploads/2021/06/SonarQube-login-page-300x153.jpeg 300w, https://blog.eldernode.com/wp-content/uploads/2021/06/SonarQube-login-page-768x393.jpeg 768w, https://blog.eldernode.com/wp-content/uploads/2021/06/SonarQube-login-page.jpeg 1486w" data-sizes="(max-width: 1024px) 100vw, 1024px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/06/SonarQube-login-page-1024x524.jpeg"/></p><p> </p><p>在下图中，您可以看到SonarQube仪表板:</p><p> </p><p><img data-lazyloaded="1" src="../Images/6df9f85eb8f1f4e9d14511162c191e49.png" decoding="async" loading="lazy" class="aligncenter wp-image-33543 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2021/06/sonarqube-dashboard.png" alt="sonarqube dashboard" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/06/sonarqube-dashboard.png 813w, https://blog.eldernode.com/wp-content/uploads/2021/06/sonarqube-dashboard-300x185.png 300w, https://blog.eldernode.com/wp-content/uploads/2021/06/sonarqube-dashboard-768x474.png 768w" data-sizes="(max-width: 813px) 100vw, 813px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/06/sonarqube-dashboard.png"/></p><p> </p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>SonarQube开源软件是一个强大的工具，用于自动扫描代码，检测Java、C#、JavaScript、C/C++和PHP等20多种编程语言中的bug和编程错误以及代码漏洞。在本文中，我们试图教你如何一步一步地在Ubuntu 20.04上安装和使用SonarQube。</p></div></div>    
</body>
</html>