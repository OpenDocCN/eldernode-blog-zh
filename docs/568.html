<html>
<head>
<title>Synchronize Files Between Two Servers On Debian 10 With Unison</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Unison在Debian 10上的两台服务器之间同步文件</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/synchronize-files-between-two-servers-on-debian/#0001-01-01">https://blog.eldernode.com/synchronize-files-between-two-servers-on-debian/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/36a16d932df735b00963d12987c39702.png" data-src="https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How To Synchronize Files Between Two Servers On Debian 10 With Unison" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison.png 2069w, https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/01/How-To-Synchronize-Files-Between-Two-Servers-On-Debian-10-With-Unison.png"/><p>Unison是一个文件同步软件，它是为OSX、Unix(如Solaris、Linux、OS X)和windows设计的，类似于rsync。有了这个工具，您的文件和文件夹在一个互连的系统上总是最新的。您可以Unison是免费的，并且在通用公共许可证下可以获得全部源代码。Unison用于在不同的主机上存储文件和目录集合的两个副本，分别进行修改，然后通过将每个副本中的更改传播到另一个副本来更新。它也可以存储在同一主机的不同磁盘上。在本教程中，你将学习如何用Unison 在Debian 10上的两台服务器之间<strong>同步文件。如果你正准备购买一台新的<a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener"> Linux VPS </a>你所需要的东西会以你能想象的速度出现。</strong></p><p>为了让本教程更好地发挥作用，请考虑以下<strong>先决条件</strong>:</p><p>拥有sudo权限的非root用户。</p><p>作为根用户运行Unison。</p><p>要进行设置，请按照Debian 10 的<a href="https://blog.eldernode.com/initial-setup-with-debian-10/" target="_blank" rel="noopener">初始设置进行。</a></p><h2><span class="ez-toc-section" id="Tutorial_Files_Synchronization_Between_Two_Servers_On_Debian_10_With_Unison"/>使用Unison在Debian 10上的两个服务器之间同步教程文件<span class="ez-toc-section-end"/></h2><p>加入我们这篇文章，学习如何用Unison在两台Debian服务器之间设置文件同步。您将看到在服务器1上更改的文件将被复制到服务器2，反之亦然。Unison的行为不同于简单的镜像或备份工具，它能够处理对分布式目录结构的两个副本的更新。您需要使用两台Debian服务器，并在两台服务器之间同步目录/var/www。让我们通过这个指南的步骤来学习和完成它。</p><h3><span class="ez-toc-section" id="How_to_install_Unison"/>如何安装Unison <span class="ez-toc-section-end"/></h3><p>你应该在<em>服务器1 </em>和<em>服务器2 </em>上安装Unison。您通过<a href="https://blog.eldernode.com/ssh-keys-debian-10/" target="_blank" rel="noopener"> SSH </a>从服务器1连接到服务器2，因此SSH包是必需的。要编辑文件，您可以在shell上安装并使用nano作为文件编辑器。让我们开始吧:</p><pre><code class="language-bash">apt-get -y install unison openssh-server ssh nano</code></pre><h3><span class="ez-toc-section" id="How_to_create_a_privatepublic_key_pair_on_server_1"/>如何在服务器1上创建私钥/公钥对<span class="ez-toc-section-end"/></h3><p>运行以下命令在server1.example.com上创建一个私有/公共密钥对，并在询问时提示输入。</p><pre><code class="language-bash">ssh-keygen -t dsa</code></pre><p>然后，将您的公钥复制到server2.example.com</p><pre><code class="language-bash">ssh-copy-id -i $HOME/.ssh/id_dsa.pub <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fa8895958ebacbc3c8d4cbccc2d4cad4cbcacb">[email protected]</a></code></pre><pre><code class="language-bash"># ssh-copy-id -i $HOME/.ssh/id_dsa.pub <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4c3e2323380c7d757e627d7a74627c627d7c7d">[email protected]</a></code></pre><p>下一个。，检查服务器1的公钥是否正确传输到服务器2:</p><pre><code class="language-bash">cat $HOME/.ssh/authorized_keys</code></pre><h3><span class="ez-toc-section" id="How_to_run_Unison"/>如何运行Unison <span class="ez-toc-section-end"/></h3><p>此时，您可以第一次运行Unison来同步两台服务器上的/var/www目录。在服务器1上运行以下命令:</p><p><em>注意</em>:由于这是第一次齐步走，你必须回答一些问题。</p><pre><code class="language-bash">unison /var/www ssh://192.168.0.101//var/www</code></pre><p>要确保服务器1和服务器2的同步，请检查它们上的/var/www目录。虽然您不希望以交互方式运行Unison，但可以创建一个类似/root/的首选项文件。unison/default.prf .包含您必须在命令行上指定的所有设置:</p><pre><code class="language-bash">nano /root/.unison/default.prf</code></pre><p>不仅仅是路径的指令，命令应该让文件自我解释。但是如果您没有指定路径指令，那么根指令中的目录将被同步。如果指定path指令，则路径相对于根路径，因此只同步这些子目录，而不是根指令中指定的整个目录。看看Unison的mn页面，了解更多可用选项。</p><pre><code class="language-bash">man unison</code></pre><p>因为您已经将所有设置放在了一个首选项文件中，所以您可以不带任何参数地运行Unison了:</p><pre class="command"><code class="language-bash">unison</code></pre><h3><span class="ez-toc-section" id="How_to_create_a_corn_job_for_Unison"/>如何为Unison创建corn job<span class="ez-toc-section-end"/></h3><p>在这一步中，您需要在server1.example.com上为Unison创建一个corn作业来自动执行同步。</p><pre><code class="language-bash">crontab -e</code></pre><p>以下命令Unison将每5分钟运行一次。此外，您可以根据自己的需要进行调整。</p><pre><code class="language-bash">man 5 crontab</code></pre><p>您可以在这里使用unison的完整路径(/usr/bin/unison)来确保cron知道在哪里可以找到unison。然而，你的调和位置可能是不同的。因此，要查看您的位置，请键入:</p><p>哪个齐奏</p><h3><span class="ez-toc-section" id="How_to_test_Unison"/>如何测试同音<span class="ez-toc-section-end"/></h3><p>t检查设置是否完全工作，测试Unison的双向同步。要创建内容为“Test 1”的测试文件，请在服务器1上使用以下命令:</p><pre><code class="language-bash">echo "Test 1" &gt; /var/www/test.txt</code></pre><p>然后，等待5分钟。要在屏幕上显示文件test.txt的内容，请在服务器2上运行以下命令:</p><pre><code class="language-bash">cat /var/www/test.txt</code></pre><p>现在，要将测试文件的内容更新为“Test 2”，请在服务器2上使用下面的命令:</p><pre><code class="language-bash">echo "Test 2" &gt; /var/www/test.txt</code></pre><p>同样，您应该等待大约5分钟，然后在服务器2上运行以下命令:</p><pre><code class="language-bash">cat /var/www/test.txt</code></pre><p> </p><p>就是这样。这就是在Debian 10上设置两台服务器之间的Unison文件同步所需要的一切。</p><p> </p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，您了解了如何使用Unison在Debian 10上的两台服务器之间同步文件。IPFs、FreeFileSync和Syncthing是Unison的替代工具。它将为您提供一些功能，如配置管理包、分布式文件系统、单向镜像工具。</p></div></div>    
</body>
</html>