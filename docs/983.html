<html>
<head>
<title>How To Install And Configure Wazuh On Centos 7 - Eldernode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Centos 7 - Eldernode博客上安装和配置Wazuh</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-and-configure-wazuh-on-centos-7/#0001-01-01">https://blog.eldernode.com/install-and-configure-wazuh-on-centos-7/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/e84b07b4247121a2a1328bab24be003f.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How To Install And Configure Wazuh On Centos 7" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/11/How-To-Install-And-Configure-Wazuh-On-Centos-7.png"/><p>了解如何在Centos 7 上逐步安装和配置Wazuh。Wazuh是一个开源的入侵检测系统，可以让你自动记录数据分析和监测的完整性。现在，你可以在<a href="https://eldernode.com/" target="_blank" rel="noopener noreferrer"> Eldernode </a>上买到所有便宜的<a href="https://eldernode.com/centos-vps/" target="_blank" rel="noopener noreferrer"> CentOS VPS 7 </a>来享受它的24/7支持和Wazuh功能。无论您使用的是Linux、OpenBSD、FreeBSD、macOS、Solaris还是Windows，它都能为您的操作系统提供入侵检测。</p><h2><span class="ez-toc-section" id="Tutorial_Install_And_Configure_Wazuh_On_Centos_7"/>教程在Centos 7上安装和配置Wazuh<span class="ez-toc-section-end"/></h2><p>您可以使用Wazuh作为威胁预防、检测和响应的开源平台。类似于世界各地成千上万的组织，你将学习如何安装和使用Wazuh，无论你是一个小型或大型企业。跟随这个指南成为它的一部分。此外，Slack频道、谷歌集团和GitHub库也是它的资源。</p><h3 id="main-features"><span class="ez-toc-section" id="Wazuh_Main_Features_Configure_Wazuh_On_Centos_7"/> Wazuh主要特性(在Centos 7上配置Wazuh)<span class="ez-toc-section-end"/></h3><p>1-安全分析</p><p>2-入侵分析</p><p>3-测井数据分析</p><p>4-文件完整性监控</p><p>5-漏洞检测</p><p id="5-vulnerability-detection">6-配置评估</p><p>7-事件响应</p><p id="7-incident-response">8-法规遵从性</p><p>9-云安全</p><p>10-集装箱安全</p><h3><span class="ez-toc-section" id="Wazuh_components"/>瓦祖赫组件<span class="ez-toc-section-end"/></h3><p>瓦祖赫系统由几个部分组成:</p><p><strong>1-</strong>OSSEC HIDS-基于主机的入侵检测系统</p><p><strong>2-</strong>OpenSCAP–开放漏洞评估语言</p><p><strong> 3- </strong> Elastic Stack – Filebeat, Elasticsearch, Kibana</p><p><strong> 4- </strong> Wazuh装载了许多有价值的功能。</p><h2><span class="ez-toc-section" id="Install_Wazuh_Server_On_Centos_7"/>在Centos 7上安装Wazuh服务器<span class="ez-toc-section-end"/></h2><p>1)首先，设置主机名和启动终端:</p><pre><code class="language-bash">hostnamectl set-hostname wazuh-server</code></pre><div class="td-a-ad id_inline_ad1 id_ad_content-horiz-center"><p>2)与往常一样，您应该更新CentOS和包:</p></div><pre><code class="language-bash">yum update -y</code></pre><p>3)使用以下命令安装NTP并检查其服务状态:</p><pre><code class="language-bash">yum install ntp</code></pre><pre><code class="language-bash">systemctl status ntpd</code></pre><div><p>4)您可能会遇到服务未启动的情况，因此运行以下命令来启动它:</p></div><div><p>5)要在系统启动时启用NTP，请键入以下命令:</p><pre><code class="language-bash">systemctl enable ntpd</code></pre></div><p>6)现在您需要修改规则以允许NTP服务，因此，键入以下命令以启用服务:</p><pre><code class="language-bash">firewall-cmd --add-service=ntp --zone=public --permanent</code></pre><pre><code class="language-bash">firewall-cmd --reload</code></pre><h3><span class="ez-toc-section" id="Install_Wazuh_Manager"/>安装Wazuh管理器<span class="ez-toc-section-end"/></h3><p>使用以下命令添加密钥:</p><pre><code class="language-bash">rpm --import https://packages.wazuh.com/key/GPG-KEY-WAZUH</code></pre><p>使用以下命令编辑Wazuh存储库:</p><pre><code class="language-bash">vim /etc/yum.repos.d/wazuh.repo</code></pre><p>接下来，将以下内容添加到文件中。</p><pre><code class="language-bash">[wazuh_repo]  gpgcheck=1  gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH  enabled=1  name=Wazuh repository  baseurl=https://packages.wazuh.com/3.x/yum/  protect=1</code></pre><p>现在，您可以保存并退出该文件。</p><p>然后键入以下命令列出存储库:</p><pre><code class="language-bash">yum repolist</code></pre><p>要安装Wazuh管理器，请运行:</p><pre><code class="language-bash">yum install wazuh-manager -y</code></pre><p>是时候安装Wazuh管理器了。不要忘记检查它的状态。</p><pre><code class="language-bash">systemctl status wazuh-manager</code></pre><figure id="attachment_25903" class="wp-caption alignnone" aria-describedby="caption-attachment-25903"/><h3><span class="ez-toc-section" id="How_To_Install_The_Wazuh_API"/>如何安装Wazuh API <span class="ez-toc-section-end"/></h3><p>在这一部分中，您将添加正式的NodeJS存储库:</p><pre><code class="language-bash">curl --silent --location https://rpm.nodesource.com/setup_8.x | bash -</code></pre><p><em>注意</em>:要运行Wazuh API，需要NodeJS &gt; = 4.6.1。关注我们关于<a href="https://blog.eldernode.com/install-node-js-centos-7/" target="_blank" rel="noopener noreferrer">如何在CentOS 7 </a>上安装Node.js的文章。</p><p>或者安装node.js</p><div><p>如果您安装Wazuh API，它将在需要时更新NodeJS:</p></div><div><p>然后，检查wazuh-api的状态。</p></div><div><pre><code class="language-bash">systemctl status wazuh-api</code></pre></div><div><p>您可以使用以下命令手动更改默认凭据:</p></div><div><pre><code class="language-bash">cd /var/ossec/api/configuration/auth</code></pre></div><p>然后，运行以下命令为用户设置密码:</p><pre><code class="language-bash">node htpasswd -Bc -C 10 user darshana</code></pre><p>您可以随时键入以下内容来重新启动API:</p><pre><code class="language-bash">systemctl restart wazuh-api</code></pre><p>此外，如果需要，您可以手动更改端口。文件/var/ossec/API/configuration/config . js包含参数:</p><pre><code class="language-bash">// TCP Port used by the API.  config.port = "55000";</code></pre><h3><span class="ez-toc-section" id="How_To_Install_Filebeat"/>如何安装Filebeat <span class="ez-toc-section-end"/></h3><p>Filebeat是什么？它是Wazuh服务器上的工具，可以安全地将警报和存档事件转发给Elasticsearch。</p><p>要安装它，请键入:</p><pre><code class="language-bash">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</code></pre><p>设置存储库:</p><pre><code class="language-bash">vim /etc/yum.repos.d/elastic.repo</code></pre><p>向服务器添加以下内容:</p><pre><code class="language-bash">[elasticsearch-7.x]  name=Elasticsearch repository for 7.x packages  baseurl=https://artifacts.elastic.co/packages/7.x/yum  gpgcheck=1  gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch  enabled=1  autorefresh=1  type=rpm-md</code></pre><p>要安装Filebeat:</p><div class="code-block code-block-3"><pre><code class="language-bash">yum install filebeat-7.5.1</code></pre></div><p>Filebeat配置是预先配置的，可以将Wazuh警报转发给Elasticsearch，但您可以从Wazuh存储库下载:</p><pre><code class="language-bash">curl -so /etc/filebeat/filebeat.yml https://raw.githubusercontent.com/wazuh/wazuh/v3.11.0/extensions/filebeat/7.x/filebeat.yml</code></pre><p>如果需要更改文件权限，请使用下面的命令:</p><pre><code class="language-bash">chmod go+r /etc/filebeat/filebeat.yml</code></pre><p>现在，下载Elasticsearch的提醒模板:</p><pre><code class="language-bash">curl -so /etc/filebeat/wazuh-template.json https://raw.githubusercontent.com/wazuh/wazuh/v3.11.0/extensions/elasticsearch/7.x/wazuh-template.json</code></pre><pre><code class="language-bash">chmod go+r /etc/filebeat/wazuh-template.json</code></pre><p>键入以下命令下载用于Filebeat的Wazuh模块:</p><pre><code class="language-bash">curl -s https://packages.wazuh.com/3.x/filebeat/wazuh-filebeat-0.1.tar.gz | sudo tar -xvz -C /usr/share/filebeat/module</code></pre><p>现在，您必须添加Elasticsearch服务器IP。编辑“filebeat.yml”</p><pre><code class="language-bash">vim /etc/filebeat/filebeat.yml</code></pre><p>并修改下面一行:</p><pre><code class="language-bash">output.elasticsearch.hosts: ['http://ELASTIC_SERVER_IP:9200']</code></pre><p>运行以下命令以启用并启动Filebeat服务:</p><pre><code class="language-bash">systemctl daemon-reload  systemctl enable filebeat.service  systemctl start filebeat.service</code></pre><h3><span class="ez-toc-section" id="How_To_Install_Elastic_Stack"/>如何安装弹性堆栈<span class="ez-toc-section-end"/></h3><p>在本步骤中，您将使用ELK配置第二台Centos服务器。您可以在您的弹性堆栈服务器上做到这一点。</p><p>正如您所猜测的，第一步是设置-hostname:</p><pre><code class="language-bash">hostnamectl set-hostname elk</code></pre><p>并使用以下命令更新系统:</p><pre><code class="language-bash">yum update -y</code></pre><h3><span class="ez-toc-section" id="How_To_Install_ELK"/>如何安装ELK <span class="ez-toc-section-end"/></h3><p>在这一部分中，您需要做的就是安装带有RPM包的弹性堆栈，然后添加弹性存储库及其GPG键:</p><pre><code class="language-bash">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</code></pre><p>接下来，创建一个存储库文件:</p><pre><code class="language-bash">vim /etc/yum.repos.d/elastic.repo</code></pre><p>将以下内容添加到文件中:</p><pre><code class="language-bash">[elasticsearch-7.x]  name=Elasticsearch repository for 7.x packages  baseurl=https://artifacts.elastic.co/packages/7.x/yum  gpgcheck=1  gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch  enabled=1  autorefresh=1  type=rpm-md</code></pre><h3><span class="ez-toc-section" id="How_To_Install_Elasticsearch"/>如何安装Elasticsearch <span class="ez-toc-section-end"/></h3><p>对Elasticsearch包运行以下命令:</p><pre><code class="language-bash">yum install elasticsearch-7.5.1.</code></pre><p>默认情况下，Elasticsearch监听环回接口(localhost)。因此，您需要通过编辑/etc/Elasticsearch/elastic search . yml并取消对network.host配置的注释，将elastic search配置为侦听非环回地址。调整您想要连接的IP值:</p><pre><code class="language-bash">network.host: 0.0.0.0</code></pre><p>顺便说一下，你可以改变防火墙规则。</p><pre><code class="language-bash">firewall-cmd --permanent --zone=public --add-rich-rule='  rule family="ipv4"  source address="34.232.210.23/32"  port protocol="tcp" port="9200" accept'</code></pre><p>并重新加载防火墙规则:</p><pre><code class="language-bash">firewall-cmd --reload</code></pre><p>但是，弹性搜索配置文件需要进一步的配置。</p><p>编辑“elasticsearch.yml”文件。</p><pre><code class="language-bash">vim /etc/elasticsearch/elasticsearch.yml</code></pre><p>现在，更改或编辑“节点.名称”和“群集.初始_主节点”。</p><pre><code class="language-bash">node.name: &lt;node_name&gt;</code></pre><pre><code class="language-bash">cluster.initial_master_nodes: ["&lt;node_name&gt;"]</code></pre><p>接下来，运行以下命令来启用并启动Elasticsearch服务:</p><pre><code class="language-bash">systemctl daemon-reload</code></pre><p>并在系统启动时启用。</p><pre><code class="language-bash">systemctl enable elasticsearch.service</code></pre><p>要启动弹性搜索服务，请使用以下命令:</p><pre><code class="language-bash">systemctl start elasticsearch.service</code></pre><p>要检查弹性搜索的状态，请键入:</p><pre><code class="language-bash">systemctl status elasticsearch.service</code></pre><p>您需要检查日志文件中的任何问题。</p><pre><code class="language-bash">tail -f /var/log/elasticsearch/elasticsearch.log</code></pre><p>运行Elasticsearch后需要加载Filebeat模板。因此，在Wazuh服务器上运行以下命令。</p><pre><code class="language-bash">filebeat setup --index-management -E setup.template.json.enabled=false</code></pre><h3><span class="ez-toc-section" id="How_To_Install_Kibana"/>如何安装Kibana <span class="ez-toc-section-end"/></h3><p>要安装Kibana软件包，请键入:</p><pre><code class="language-bash">yum install kibana-7.5.1</code></pre><p>并为Kibana安装Wazuh应用程序插件:</p><pre><code class="language-bash">sudo -u kibana /usr/share/kibana/bin/kibana-plugin install https://packages.wazuh.com/wazuhapp/wazuhapp-3.11.0_7.5.1.zip</code></pre><p>此时，请注意，Kibana插件需要修改Kibana配置，以便从外部访问Kibana。您可以编辑Kibana配置文件。</p><pre><code class="language-bash">vim /etc/kibana/kibana.yml</code></pre><p>此外，您可以更改下面的行。</p><pre><code class="language-bash">server.host: "0.0.0.0"</code></pre><p>然后，配置Elasticsearch实例的URL。</p><pre><code class="language-bash">elasticsearch.hosts: ["http://localhost:9200"]</code></pre><p>再次运行下面的命令来启用和启动Kibana服务:</p><pre><code class="language-bash">systemctl daemon-reload  systemctl enable kibana.service  systemctl start kibana.service</code></pre><h3><span class="ez-toc-section" id="How_To_Add_Wazuh_API_To_Kibana_Configurations"/>如何将Wazuh API添加到Kibana配置中<span class="ez-toc-section-end"/></h3><p>首先，你需要编辑“wazuh.yml。”</p><pre><code class="language-bash">vim /usr/share/kibana/plugins/wazuh/wazuh.yml</code></pre><p>记得编辑主机名、用户名和密码。然后，您可以保存并退出该文件，并重新启动Kibana服务。</p><pre><code class="language-bash">systemctl restart kibana.service</code></pre><p>这样，您就安装了Wazuh服务器和ELK服务器。因此，让我们使用代理添加主机。</p><h3><span class="ez-toc-section" id="Install_Wazuh_agent"/>安装Wazuh代理<span class="ez-toc-section-end"/></h3><p>在这一步中，您需要传递两个部分:</p><p><strong> 1- </strong>添加Ubuntu服务器</p><p><strong> 2- </strong>安装所需的软件包</p><pre><code class="language-bash">apt-get install curl apt-transport-https lsb-release gnupg2</code></pre><p>要安装瓦祖赫库GPG密钥，请使用:</p><pre><code class="language-bash">curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add -</code></pre><p>运行以下命令添加存储库，然后更新存储库。</p><pre><code class="language-bash">echo "deb https://packages.wazuh.com/3.x/apt/ stable main" | tee /etc/apt/sources.list.d/wazuh.list</code></pre><pre><code class="language-bash">apt-get update</code></pre><h3><span class="ez-toc-section" id="Tutorial_Install_The_Wazuh_agent_Configure_Wazuh_On_Centos_7"/>教程安装Wazuh代理(在Centos 7上配置Wazuh)<span class="ez-toc-section-end"/></h3><p>blow命令的作用是在安装wazuh-agent时自动将“waz uh _ MANAGER”IP添加到waz uh-agent配置中。</p><pre><code class="language-bash">WAZUH_MANAGER="52.91.79.65" apt-get install wazuh-agent</code></pre><h3><span class="ez-toc-section" id="How_To_Add_CentOS_host"/>如何添加CentOS主机<span class="ez-toc-section-end"/></h3><p>通过运行下面的命令，您将添加Wazuh存储库。</p><pre><code class="language-bash">rpm --import http://packages.wazuh.com/key/GPG-KEY-WAZUH</code></pre><p>然后，编辑并添加到存储库中:</p><pre><code class="language-bash">vim /etc/yum.repos.d/wazuh.repo</code></pre><p>增加以下内容:</p><pre><code class="language-bash">[wazuh_repo]  gpgcheck=1  gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH  enabled=1  name=Wazuh repository  baseurl=https://packages.wazuh.com/3.x/yum/  protect=1</code></pre><p>使用以下命令安装代理。</p><pre><code class="language-bash">WAZUH_MANAGER="52.91.79.65" yum install wazuh-agent</code></pre><h3><span class="ez-toc-section" id="How_To_Access_To_Wazuh_Dashboard"/>如何访问Wazuh仪表盘<span class="ez-toc-section-end"/></h3><p>首先，使用IP浏览Kibana。</p><pre><code class="language-bash">http://IP or hostname:5601/</code></pre><p>下面的界面应该显示:</p><p><img data-lazyloaded="1" src="../Images/d488d12d90403f8da8e387d02481c964.png" decoding="async" loading="lazy" class="size-large wp-image-18693 aligncenter" data-src="https://blog.eldernode.com/wp-content/uploads/2020/11/Kibana_DashBoard-1068x568-1-1024x545.png" alt="Kibana DashBoard" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/11/Kibana_DashBoard-1068x568-1-1024x545.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/11/Kibana_DashBoard-1068x568-1-300x160.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/11/Kibana_DashBoard-1068x568-1-768x408.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/11/Kibana_DashBoard-1068x568-1.png 1068w" data-sizes="(max-width: 1024px) 100vw, 1024px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/11/Kibana_DashBoard-1068x568-1-1024x545.png"/></p><p> </p><p>如果你点击“Wazuh”图标，你会去它的仪表板，你可以看到“Wazuh”仪表板如下。</p><p><img data-lazyloaded="1" src="../Images/906a3b79a1efd2aea9cfa8ea5ccbdd88.png" decoding="async" loading="lazy" class="size-large wp-image-18695 aligncenter" data-src="https://blog.eldernode.com/wp-content/uploads/2020/11/Wazuh_DashBoard-1068x492-1-1024x472.png" alt="Wazuh Dashboard" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/11/Wazuh_DashBoard-1068x492-1-1024x472.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/11/Wazuh_DashBoard-1068x492-1-300x138.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/11/Wazuh_DashBoard-1068x492-1-768x354.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/11/Wazuh_DashBoard-1068x492-1.png 1068w" data-sizes="(max-width: 1024px) 100vw, 1024px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/11/Wazuh_DashBoard-1068x492-1-1024x472.png"/></p><p> </p><p>现在，您应该看到连接的代理、安全信息管理等。单击安全事件以查看事件的图形视图。</p><p><img data-lazyloaded="1" src="../Images/8656443b1fcc56f942654625f6108e83.png" decoding="async" loading="lazy" class="size-large wp-image-18697 aligncenter" data-src="https://blog.eldernode.com/wp-content/uploads/2020/11/Security_Events-1068x564-1-1024x541.png" alt="Security Events" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/11/Security_Events-1068x564-1-1024x541.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/11/Security_Events-1068x564-1-300x158.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/11/Security_Events-1068x564-1-768x406.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/11/Security_Events-1068x564-1.png 1068w" data-sizes="(max-width: 1024px) 100vw, 1024px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/11/Security_Events-1068x564-1-1024x541.png"/></p><p> </p><h3><span class="ez-toc-section" id="Uninstall_The_Agent"/>卸载代理:<span class="ez-toc-section-end"/></h3><div class="sphinx-tabs docutils container"><div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-QVBU docutils container active" data-tab="tab-QVBU"><div class="highlight-console notranslate"><pre><code class="language-bash">apt-get remove wazuh-agent</code></pre></div></div></div><p>由于某些软件包管理器不会从文件系统中删除这些文件，因此您应该运行以下命令来提供完整的文件删除:</p><div class="highlight-console notranslate"><div id="rst-content"><div id="linux" class="section"><div id="uninstall" class="section"><div class="sphinx-tabs docutils container"><div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-QVBU docutils container active" data-tab="tab-QVBU"><div class="highlight-console notranslate"><div class="highlight"><pre><code class="language-bash">apt-get remove --purge wazuh-agent  </code></pre></div></div></div></div></div></div><p>至此，您已经完成了在CentOS上安装和配置Wazuh服务器所需的全部学习。</p></div></div><p> </p><div><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，您了解了如何在Centos 7上安装和配置Wazuh。由于您的操作系统以及您是否希望从源代码进行构建，安装Wazuh服务器有几种选择。如果你有兴趣阅读更多内容，可以找到我们关于如何在CentOS 7 上安装CWP的文章。</p></div></div></div>    
</body>
</html>