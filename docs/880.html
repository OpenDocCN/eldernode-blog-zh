<html>
<head>
<title>How to Install and Uninstall Umami on Ubuntu 20.04 - Eldernode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Ubuntu 20.04 - Eldernode博客上安装和卸载Umami</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-and-uninstall-umami-on-ubuntu/#0001-01-01">https://blog.eldernode.com/install-and-uninstall-umami-on-ubuntu/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/a54c561c3a3a6fa39cb304c7ba4ca43a.png" data-src="https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to Install and Uninstall Umami on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu.png 2069w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2021/11/install-and-uninstall-umami-on-ubuntu.png"/><p>Umami是一个开源的网络分析程序。它注重简单，设计精良，快捷，注重隐私。Umami是用Node.js编写的，是一个自托管的网络分析工具，可以替代专注于隐私的Google Analytics。Umami可以在MySQL或PostgreSQL数据库中存储关于网站访问者的数据。在这篇文章中，我们将教你如何在Ubuntu 20.04上安装和卸载Umami。如果你想购买一台<a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener"> <strong> Linux VPS </strong> </a>服务器，你可以访问<a href="https://eldernode.com/" target="_blank" rel="noopener"> Eldernode </a>中的软件包。</p><h2><span class="ez-toc-section" id="Tutorial_Install_and_Uninstall_Umami_on_Ubuntu_Linux"/>教程在Ubuntu Linux上安装和卸载Umami<span class="ez-toc-section-end"/></h2><h3><span class="ez-toc-section" id="Install_Umami_on_Ubuntu_2004_Ubuntu_2104"/>在Ubuntu 20.04 | Ubuntu 21.04上安装Umami<span class="ez-toc-section-end"/></h3><p>该存储库将下载到/opt文件夹中。</p><pre><code class="language-bash">cd /opt</code></pre><p>现在，您应该通过输入以下命令从GitHub克隆存储库:</p><pre><code class="language-bash">sudo git clone https://github.com/mikecao/umami.git</code></pre><p>所有软件和配置文件都将位于/opt/umami中。然后转到新创建的鲜味目录:</p><pre><code class="language-bash">cd umami</code></pre><p>在这一步，您需要更新项目docker-compose.yml文件。这个文件是它用来同时配置和启动多个Docker容器的。您必须更改该文件中的两个选项:Umami绑定到的IP，以及在加密数据库中的内容时用作salt的随机散列。</p><p>下一步，生成一个新的随机散列粘贴到文件中。为此，请输入以下命令:</p><pre><code class="language-bash">openssl rand -base64 32</code></pre><pre><code class="language-bash"/></pre><p>openssl命令用于生成32个随机字符。您应该首先将输出复制到剪贴板，然后使用以下命令打开配置文件:</p><pre><code class="language-bash">sudo nano docker-compose.yml</code></pre><p>现在您应该找到HASH_SALT选项并删除占位符文本。然后记住通过输入以下命令粘贴随机散列:</p><pre><code class="language-bash">HASH_SALT: replace-me-with-a-random-string</code></pre><p>然后您应该找到端口:</p><pre><code class="language-bash">ports: - "127.0.01:3000:3000"</code></pre><p>要更新值“3000:3000 ”,只需在其上添加127.0.0.1:。这确保了Umami不是公开可用的，并且只在本地主机接口上侦听。</p><p>即使设置了UFW防火墙，由于Docker网络工作方式的一些奇怪之处，如果您不执行此步骤，您的鲜味容器将在端口3000上对公众可用。</p><p>现在你应该通过按CTRL+O保存文件，然后在nano中输入。最后，按CTRL+X关闭编辑器。</p><p>在这个阶段，您需要设置两个容器。为此，您可以使用以下命令:</p><pre><code class="language-bash">sudo docker-compose up --detach</code></pre><p>Docker-compose在后台创建容器，通过声明–detach标志从终端会话中分离出来:</p><pre><code class="language-bash">Creating umami_db_1 ... done</code></pre><pre><code class="language-bash">Creating umami_umami_1 ... done</code></pre><p>您可以使用以下命令验证获取在本地主机上运行的新Umami容器的主页:</p><pre><code class="language-bash">curl localhost:3000</code></pre><p>输出:</p><pre><code class="language-bash">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charSet="utf-8"/&gt; . . .</code></pre><p>如果一大块HTML输出到您的终端，这表明Umami服务器已经启动并正在运行。</p><h3><span class="ez-toc-section" id="Configure_Nginx_on_Ubuntu_Linux"/> <strong>在Ubuntu Linux上配置Nginx</strong>T3】</h3><p>首先，使用以下命令更新您的包列表:</p><pre><code class="language-bash">sudo apt update</code></pre><p>现在，您可以通过输入以下命令来安装Nginx:</p><pre><code class="language-bash">sudo apt install nginx</code></pre><p>接下来，您需要允许端口80和443进行通信。为此，请使用“Nginx Full”UFW应用配置文件:</p><pre><code class="language-bash">sudo ufw allow "Nginx Full"</code></pre><p>输出:</p><pre><code class="language-bash">Rule added</code></pre><pre><code class="language-bash">Rule added (v6)</code></pre><p>现在，您应该在/etc/nginx/sites-available目录中打开一个新的<a href="https://blog.eldernode.com/secure-nginx-encrypt-debian-10/"> Nginx </a>配置文件:</p><pre><code class="language-bash">sudo nano /etc/nginx/sites-available/umami.conf</code></pre><p>然后将以下内容粘贴到新的配置文件中。记得用您配置的指向Umami服务器的域替换您的_domain_here。</p><pre><code class="language-bash">server {      listen        80;      listen        [::]:80;      server_name  your_domain_here;        access_log  /var/log/nginx/umami.access.log;      error_log   /var/log/nginx/umami.error.log;        location / {        proxy_pass http://localhost:3000;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header Host $host;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    }  }</code></pre><p>上面的配置仅适用于HTTP，因为您允许Certbot在下一步中配置SSL。设置日志位置的配置，然后将所有流量传递到http://localhost:3000。</p><p>现在您应该保存文件并关闭它。</p><p>然后您需要将配置链接到/etc/nginx/sites-enabled/来启用它。为此，请输入以下命令:</p><pre><code class="language-bash"> sudo In -s /etc/nginx/sites-available/umami.conf /etc/nginx/sites-enabled/</code></pre><p>在此步骤中，通过执行以下命令来验证配置文件的语法是否正确:</p><pre><code class="language-bash">sudo nginx -t</code></pre><p>输出:</p><pre><code class="language-bash">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</code></pre><pre><code class="language-bash">nginx: configuration file /etc/nginx/nginx.conf test is successful</code></pre><p>最后，您必须重新加载nginx服务来获取新的配置。为此，请运行以下命令:</p><pre><code class="language-bash">sudo systemctl reload nginx</code></pre><p>鲜味网站可通过简单的HTTP。如果加载http://your_domain_here。</p><h3><span class="ez-toc-section" id="How_to_Install_Certbot_and_Set_up_SSL_Certificates"/> <strong>如何安装Certbot并设置SSL证书</strong> <span class="ez-toc-section-end"/></h3><p>首先，您应该通过输入以下命令来安装Certbot及其Nginx插件:</p><pre><code class="language-bash">sudo apt install certbot python3-certbot-nginx</code></pre><p>您应该在–Nginx模式下运行certbot，并指定在Nginx server_name配置中使用的相同域。为此，请使用以下命令:</p><pre><code class="language-bash">sudo certbot --nginx -d your_domain_here</code></pre><p>现在，您应该同意“让我们加密服务条款”并输入您的电子邮件地址。</p><p>然后，您可以将所有HTTP流量重定向到HTTPS，这样做是安全的。</p><p>接下来，让我们加密确认您的请求，Certbot将下载您的证书。</p><p>您应该在以下位置测试您的配置:</p><pre><code class="language-bash">https://www.ssllabs.com/ssltest/analyze.html?d=umami.example.com</code></pre><p>Certbot会自动重新加载Nginx，以获取新的配置和认证。现在重新加载你的网站，如果你选择重定向选项，它会自动切换到HTTPS。</p><p> </p><h2><span class="ez-toc-section" id="How_to_Uninstall_Umami_on_Ubuntu_2004_Ubuntu_2104"/> <strong>如何卸载Ubuntu 20.04上的鲜味| Ubuntu 21.04 </strong> <span class="ez-toc-section-end"/></h2><p>通过输入以下命令，鲜味将从您的系统中删除。</p><pre><code class="language-bash">sudo apt-get remove umami</code></pre><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，您了解了如何在Ubuntu 20.04上安装和卸载umami。事实上，Umami应用程序和PostgreSQL数据库是使用Docker Compose启动的，然后启动了Nginx反向代理。最后，您可以使用加密SSL证书来保护它。</p></div></div>    
</body>
</html>