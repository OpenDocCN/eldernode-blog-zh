<html>
<head>
<title>Setting Up Time Synchronization On Debian 10 - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Debian 10 - Eldernode上设置时间同步</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/set-up-time-synchronization-debian-10/#0001-01-01">https://blog.eldernode.com/set-up-time-synchronization-debian-10/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/af78058daa6c21a7c3785a0bf60fa633.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Setting up Time Synchronization on Debian 10" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1981.png"/><p>精确的时间同步至关重要。在现代软件中，用户确保日志以正确的顺序记录或数据库更新被正确应用，不同步时间会导致错误、数据损坏和其他难以调试的问题。</p><p>在这篇文章中，你会看到Debian 10是内置时间同步的，默认情况下它是使用标准的<span> ntpd </span>时间服务器激活的，由<span> ntp </span>包提供。为了让你的学习更好地进行，选择你自己的<a href="https://eldernode.com/ubuntu-vps/" target="_blank" rel="noopener noreferrer"> Ubuntu VPS服务器</a>，它可以即时激活。</p><p> </p><p> </p><p>为了让本教程更好地发挥作用，请考虑下面的<strong>先决条件</strong> : <br/>一个拥有<span> sudo </span>权限<br/>的非根用户要进行设置，请遵循我们的<a href="https://eldernode.com/initial-setup-with-debian-10/" target="_blank" rel="noopener noreferrer">Debian 10的初始设置</a></p><p class="fjpost-info"/><p/><p/><h2><span class="ez-toc-section" id="Setting_Up_Time_Synchronization_On_Debian_10"/>在Debian 10上设置时间同步<span class="ez-toc-section-end"/></h2><p>与我们一起回顾一些与时间相关的基本命令，验证ntpd是否处于活动状态并连接到对等方，并了解如何激活备用systemd-timesyncd网络时间服务。因此，让我们准备好浏览本指南的步骤，并了解更多关于Debian 10上的时间同步。</p><p/><p/><p/><div><h3 id="step-1-—-navigating-basic-time-commands"><span class="ez-toc-section" id="Step_1_How_To_Navigate_Basic_Time_Commands"/>步骤1:如何导航基本时间命令<span class="ez-toc-section-end"/></h3><p>您可以使用<span>日期</span>来找出您服务器上的时间。所有用户都能够运行下面的命令并打印出日期和时间。</p><pre><code class="language-bash">date</code></pre><p title="Output">输出</p><pre><code class="language-bash">Wed 31 Jul 2019 06:03:19 PM UTC</code></pre><p>您的服务器将默认为UTC时区，如您在输出中所见。什么是UTC？现在是协调世界时，即经度零度的时间。当您的基础设施跨越多个时区时，一致使用世界时可以减少混乱。但是，如果您有不同的要求并需要更改时区，您也可以使用<span> timedatectl </span>命令。</p><p>首先，列出可用的时区:</p><pre><code class="language-bash">timedatectl list-timezones</code></pre><p>要打印你的屏幕，你需要一个时区列表。按下<span>空格键</span>向下翻页，按下<span> b <span>向上翻页。当你找到正确的时区时，不要忘记记下它，然后键入<span> q </span>退出列表。</span> </span></p><p>是时候用<span> timedatectl set-timezone </span>设置时区了。确保用您在列表中找到的时区替换(美国/纽约)。请记住使用sudo和<span> timedatectl </span>来进行更改:</p><pre><code class="language-bash">sudo timedatectl set-timezone America/New_York</code></pre><p>要验证您的更改，您可以再次运行<span> date </span>:</p><pre><code class="language-bash">date</code></pre><p><span>输出</span></p><pre><code class="language-bash">Wed 31 Jul 2019 02:08:43 PM EDT</code></pre><p>时区缩写应该反映新选择的值。从现在起，你知道如何检查时钟和设置时区。因此，我们将确保我们的时间同步正确。</p><p> </p></div><p> </p><h3 id="step-2-—-checking-the-status-of-ntpd"><span class="ez-toc-section" id="Step_2_How_To_Check_The_Status_Of_ntpd"/>步骤2:如何检查ntpd的状态<span class="ez-toc-section-end"/></h3><div><p>您可以相信Debian 10 bout为您提供了标准的ntpd服务器，它可以让您的系统时间与一组外部时间服务器保持同步，因为它默认运行ntpd。</p><p>要检查它是否正在运行，请使用以下命令:</p><pre><code class="language-bash">sudo systemctl status ntp</code></pre><p>输出</p><pre><code class="language-bash">● ntp.service - Network Time Service     Loaded: loaded (/lib/systemd/system/ntp.service; enabled; vendor preset: enabled)     Active: active (running) since Wed 2019-07-31 13:57:08 EDT; 17min ago       Docs: man:ntpd(8)   Main PID: 429 (ntpd)      Tasks: 2 (limit: 1168)     Memory: 2.1M     CGroup: /system.slice/ntp.service             └─429 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 106:112  . . .</code></pre><p>当你在输出中看到<span> active (running) </span>状态时，说明ntpd启动正常。要获得关于ntpd状态的更多信息，您可以使用<span> ntpq </span>命令:</p><pre><code class="language-bash">ntpq -p</code></pre><p title="Output"><span>输出</span></p><pre class="code-pre"><code class="language-bash">     remote           refid      st t when poll reach   delay   offset  jitter  ==============================================================================   0.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000   1.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000   2.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000   3.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000  +208.67.72.50    152.2.133.55     2 u   12   64  377   39.381    1.696   0.674  +198.46.223.227  204.9.54.119     2 u    6   64  377   22.671    3.536   1.818  -zinc.frizzen.ne 108.61.56.35     3 u   43   64  377   12.012    1.268   2.553  -pyramid.latt.ne 204.123.2.72     2 u   11   64  377   69.922    2.858   0.604  +nu.binary.net   128.252.19.1     2 u   10   64  377   35.362    3.148   0.587  #107.155.79.108  129.7.1.66       2 u   65   64  377   42.380    1.638   1.014  +t1.time.bf1.yah 98.139.133.62    2 u    6   64  377   11.233    3.305   1.118  *sombrero.spider 129.6.15.30      2 u   47   64  377    1.304    2.941   0.889  +hydrogen.consta 209.51.161.238   2 u   45   64  377    1.830    2.280   1.026  -4.53.160.75     142.66.101.13    2 u   42   64  377   29.077    2.997   0.789  #horp-bsd01.horp 146.186.222.14   2 u   39   64  377   16.165    4.189   0.717  -ntpool1.603.new 204.9.54.119     2 u   46   64  377   27.914    3.717   0.939</code></pre><pre><code class="language-bash"/></pre><p><span> ntpq </span>是ntpd的查询工具。<span> -p </span>标志询问ntpd所连接的NTP服务器(或对等体)的信息。您的输出会略有不同，但是应该列出默认的Debian池服务器和一些其他的服务器。请记住，ntpd可能需要几分钟时间来建立连接。</p></div><h5/><h3/><h3 id="step-3-—-switching-to-systemd-timesyncd"><span class="ez-toc-section" id="Step_3_How_To_Switch_To_systemd-timesyncd"/>第三步:如何切换到systemd-timesyncd <span class="ez-toc-section-end"/></h3><p>万一需要替换ntpd，可以使用systemd内置的timesyncd组件。timesyncd是ntpd的轻量级替代方案，与systemd的集成程度更高。但是，请注意，它不支持作为时间服务器运行，并且它在用于保持系统时间同步的技术方面稍微不太成熟。如果您正在运行复杂的实时分布式系统，您可能希望坚持使用ntpd。</p><p>首先，卸载ntpd以使用timesyncd:</p><pre><code class="language-bash">sudo apt purge ntp</code></pre><p>然后，启动timesyncd服务:</p><pre><code class="language-bash">sudo systemctl start systemd-timesyncd</code></pre><p>最后，检查服务的状态以确保它正在运行:</p><pre><code class="language-bash">sudo systemctl status systemd-timesyncd    </code></pre><p title="Output"><span>输出</span></p><pre><code class="language-bash">● systemd-timesyncd.service - Network Time Synchronization     Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: enabled)    Drop-In: /usr/lib/systemd/system/systemd-timesyncd.service.d             └─disable-with-time-daemon.conf     Active: active (running) since Wed 2019-07-31 14:21:37 EDT; 6s ago       Docs: man:systemd-timesyncd.service(8)   Main PID: 1681 (systemd-timesyn)     Status: "Synchronized to time server for the first time 96.245.170.99:123 (0.debian.pool.ntp.org)."      Tasks: 2 (limit: 1168)     Memory: 1.3M     CGroup: /system.slice/systemd-timesyncd.service             └─1681 /lib/systemd/systemd-timesyncd</code></pre><p>您可以使用timedatectl打印出systemd对时间的当前理解:</p><p><span>输出</span></p><pre><code class="language-bash">timedatectl</code></pre><p title="Output">这将打印出本地时间、世界时间(如果您没有从UTC时区切换过来，它可能与本地时间相同)和一些网络时间状态信息。<span>系统时钟同步:是</span>表示时间已经成功同步，<span> NTP service: active </span>表示timesyncd启用并运行。</p><pre><code class="language-bash">               Local time: Wed 2019-07-31 14:22:15 EDT             Universal time: Wed 2019-07-31 18:22:15 UTC                   RTC time: n/a                  Time zone: America/New_York (EDT, -0400)  System clock synchronized: yes                NTP service: active            RTC in local TZ: no</code></pre><p> </p><p><span class="ez-toc-section" id="conclusion"/>结论<span class="ez-toc-section-end"/></p><p><span> <span> <span>在本文中，</span> </span> </span>您学习了如何查看系统时间、更改时区、使用ntpd以及切换到systemd的timesyncd服务。如果你有比我们在这里讨论的更复杂的计时需求，你可以参考NTP官方文档，也可以看看NTP Pool项目，这是一个全球性的志愿者组织，提供了世界上大多数的NTP基础设施。如果你对这个主题感兴趣，可以多看一些关于<a href="https://blog.eldernode.com/set-timezone-ubuntu-18/" target="_blank" rel="noopener noreferrer">在Ubuntu 18 </a> <strong>上设置日期时间和</strong> <a href="https://blog.eldernode.com/set-timezone-centos-7/" target="_blank" rel="noopener noreferrer">在CentOS 7 Linux </a>上设置时区的相关文章。</p><h2><span class="ez-toc-section" id="conclusion"/>结论<span class="ez-toc-section-end"/></h2><p><span> <span> <span>在本文中，</span> </span> </span>您学习了如何查看系统时间、更改时区、使用ntpd以及切换到systemd的timesyncd服务。如果你有比我们在这里讨论的更复杂的计时需求，你可以参考NTP官方文档，也可以看看NTP Pool项目，这是一个全球性的志愿者组织，提供了世界上大多数的NTP基础设施。如果你对这个主题感兴趣，可以多看一些关于<a href="https://blog.eldernode.com/set-timezone-ubuntu-18/" target="_blank" rel="noopener noreferrer">在Ubuntu 18 </a> <strong>上设置日期时间和</strong> <a href="https://blog.eldernode.com/set-timezone-centos-7/" target="_blank" rel="noopener noreferrer">在CentOS 7 Linux </a>上设置时区的相关文章。</p></div></div>    
</body>
</html>