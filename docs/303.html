<html>
<head>
<title>Tutorial set up a Firewall with UFW on Ubuntu 20.04 - ubutnu firewall</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>教程在Ubuntu 20.04上用UFW设置防火墙——ubutnu防火墙</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/setup-firewall-ufw-ubuntu-20/#0001-01-01">https://blog.eldernode.com/setup-firewall-ufw-ubuntu-20/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/7c0ed2bc49cbfb4446a95ef9687f30c0.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Tutorial set up a Firewall with UFW on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2266.png"/><p>作为管理员，保护网络安全是首要任务。在本文中，你将回顾<strong>教程在Ubuntu 20.04 </strong>上用UFW设置防火墙。因此，如果你想开始保护你的网络，但又不确定使用哪种工具，UFW(简单防火墙)可能是你的正确选择。<a href="https://en.wikipedia.org/wiki/Uncomplicated_Firewall" target="_blank" rel="noopener noreferrer"> UFW </a>是一个简化的防火墙管理接口，隐藏了底层包过滤技术的复杂性，如<span> iptables </span>和<span> nftables </span>。</p><p> </p><p><strong>先决条件</strong></p><p>如果您知道以下内容，本教程可能会更有用:</p><p> </p><p><span> <strong>注意</strong> </span> : UFW默认安装在Ubuntu上，但如果卸载了，可以用:</p><pre><code class="language-bash">sudo apt install ufw.</code></pre><p> </p><h2><span class="ez-toc-section" id="Tutorial_set_up_a_Firewall_with_UFW_on_Ubuntu_2004"/> <span>教程在Ubuntu 20.04上用UFW设置防火墙</span> <span class="ez-toc-section-end"/></h2><p>让我们回顾一下学习这种设置的9个步骤。</p><h3><span class="ez-toc-section" id="1-_Using_IPv6_with_UFW"/> <span> 1-使用IPv6与UFW </span> <span class="ez-toc-section-end"/></h3><p>由于本教程是在考虑了IPv4的情况下编写的，所以当您启用IPv6时，它也可以工作。但是如果它在你的Ubuntu服务器上被启用，确保UFW被配置为支持IPv6，并且它将管理除IPv4之外的IPv6的防火墙规则。为此，请键入以下命令。</p><pre><code class="language-bash">sudo nano /etc/default/ufw  </code></pre><p id="step-1-—-using-ipv6-with-ufw-optional">你需要查看如下。</p><p>/etc/default/ufw摘录</p><p class="code-label" title="/etc/default/ufw excerpt"><span class="ez-toc-section" id="2-_Setting_Up_Default_Policies"/> <span> 2-设置默认策略</span> <span class="ez-toc-section-end"/></p><pre title="/etc/default/ufw excerpt"><code class="language-bash">IPV6=<span>yes  </span></code></pre><p>默认情况下，UFW允许所有传出连接，拒绝所有传入连接。因此，任何试图访问您的服务器的人都无法连接，而服务器内的任何应用程序都可以访问外部世界。</p><p>要继续学习本教程，您需要将UFW规则设置回默认值。为此，请使用以下命令。</p><h3 id="step-2-—-setting-up-default-policies"> </h3><p><span> <a href="https://eldernode.com/linux-hosting/">购买Linux虚拟主机</a> </span></p><p> </p><pre><code class="language-bash">sudo ufw default deny incoming  sudo ufw default allow outgoing</code></pre><p><span class="ez-toc-section" id="3-_Allowing_SSH_Connections"/> <span> 3-允许SSH连接</span> <span class="ez-toc-section-end"/></p><p>当您启用UFW防火墙时，它将拒绝所有传入的连接。为了防止这种情况，您可能需要创建规则，明确允许合法的传入连接— <a href="https://eldernode.com/tutorial-connect-to-ssh-on-linux/" target="_blank" rel="noopener noreferrer"> SSH </a>或HTTP连接。在使用云服务器的情况下，您可能希望允许传入的SSH连接，这样您就可以连接并管理您的服务器。</p><p>使用以下命令配置您的服务器，以允许传入的SSH连接。</p><h3 id="step-3-—-allowing-ssh-connections">通过这样做，您将创建防火墙规则，允许端口<span> 22 </span>上的所有连接，SSH守护进程默认监听该端口。因此您将指定端口而不是服务名。</h3><p>如果将SSH守护进程配置为使用不同的端口，则必须指定适当的端口。如果您的SSH服务器正在监听端口<span> 2222 </span>，那么您可以使用这个命令来允许该端口上的连接</p><p> </p><pre><code class="language-bash">sudo ufw allow ssh  </code></pre><p><span class="ez-toc-section" id="4-_Enabling_UFW"/> <span> 4-启用UFW </span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">sudo ufw allow 22  </code></pre><p>使用此命令启用UFW</p><pre><code class="language-bash">sudo ufw allow 2222  </code></pre><pre><code class="language-bash"/></pre><p>您可能会看到一条警告消息，提示您中断现有的SSH连接。由于设置防火墙的规则，已经考虑到，SSH连接是允许的。用<span> y </span>响应提示，并按<span>回车。</span></p><h3 id="step-4-—-enabling-ufw">要查看规则设置，运行<span> sudo ufw status verbose </span>命令，因为防火墙现在是活动的。</h3><p> </p><pre><code class="language-bash">sudo ufw enable  </code></pre><p> </p><p><span class="ez-toc-section" id="5-_Allowing_Other_Connections"/> <span> 5-允许其他连接</span> <span class="ez-toc-section-end"/></p><p>是时候允许您的服务器需要响应的所有其他连接了。如您所知，如何编写规则来允许基于服务名或端口的连接。您也可以这样做，就像您在端口22上对SSH所做的那样。</p><p>未加密的web服务器使用端口80上的HTTP，使用<span> sudo ufw allow http或sudo ufw allow 80 </span></p><h3 id="step-5-—-allowing-other-connections">加密web服务器使用的端口443上的HTTPS，使用<span> sudo ufw allow https或sudo ufw allow 443 </span></h3><p> </p><ul><li>尽管有些应用程序使用多个端口，而不是单个端口，但您可以使用UFW来指定端口范围。要允许使用端口<span> 6000-6007 </span>的X11连接，请使用以下命令:</li></ul><ul><li>当使用UFW指定端口范围时，您需要指定规则应该应用的协议(<span> tcp </span>或<span> udp </span>)。</li></ul><p>您也可以指定IP地址。通过下面的例子，你可能知道更多关于具体的IP地址。</p><p>或者，如果您想要通过将<span>添加到任何端口</span>后跟端口号来连接，您可以指定允许IP地址的特定端口。正如你在下面看到的例子，我们想让203.0.113.4的T2连接到T4的端口22(SSH)</p><pre><code class="language-bash">sudo ufw allow <span><span class="highlight">6000</span>:<span class="highlight">6007</span></span>/tcp  sudo ufw allow <span><span class="highlight">6000</span>:<span class="highlight">6007</span></span>/udp</code></pre><p> </p><p>当您需要允许IP地址的子网时，可以使用CIDR表示法来指定网络掩码。正如你在下面的例子中看到的，当你需要允许从<span>203.0.113.1</span>到<span>203.0.113.254<span>的IP地址时，你可以这样输入。</span> </span></p><pre><code class="language-bash">sudo ufw allow from <span class="highlight">203.0.113.4</span></code></pre><p>如果要指定子网<span> 203.0.113.0/24 <span>连接的目的端口，需要使用端口</span> </span> <span> 22 <span> (SSH)。</span> </span></p><pre><code class="language-bash">sudo ufw allow from <span>203.0.113.4</span> to any port <span>22  </span></code></pre><p>如果您想在继续之前查找您的网络接口，请键入以下命令。</p><p><span>输出摘录</span></p><pre><code class="language-bash">sudo ufw allow from <span>203.0.113.0/24  </span></code></pre><p>如果你的服务器有一个名为<span> eth0 </span>的公共网络接口，你也可以允许HTTP流量(端口<span> 80 </span>)。</p><pre><code class="language-bash">sudo ufw allow from <span><span class="highlight">203.0.113.0</span>/<span class="highlight">24</span></span> to any port 22</code></pre><p>此外，如果您希望MySQL数据库服务器(端口<span> 3306 </span>)监听专用网络接口<span> eth1 </span>上的连接，您可以使用下面的命令。</p><pre><code class="language-bash">ip addr</code></pre><p title="Output Excerpt"> </p><pre><code class="language-bash">2: <span>eth0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state  . . .  3: <span>eth1</span>: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default  . . .</code></pre><p><span class="ez-toc-section" id="6-_Denying_Connections"/> <span> 6-拒绝连接</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">sudo ufw allow in on<span> eth0</span> to any port <span>80  </span></code></pre><p>如果您不更改传入连接的默认策略，UFW会配置拒绝所有传入连接。或者如果您想拒绝基于源IP地址或子网的特定连接，可能是因为您知道您的服务器正受到来自那里的攻击。但是，如果您想将默认的传入策略更改为<strong>允许，您需要为您不想允许连接的任何服务或IP地址创建<strong>拒绝</strong>规则。</strong></p><pre><code class="language-bash">sudo ufw allow in on <span>eth1</span> to any port <span>3306  </span></code></pre><pre><code class="language-bash"/></pre><p>您可以键入上面描述的以下命令(拒绝HTTP连接)，将<strong> allow </strong>替换为<strong> denying，</strong>编写<strong> deny </strong>规则。</p><h3 id="step-6-—-denying-connections">如果您想拒绝来自<span>203.0.113.4</span>的所有连接，也可以使用下面的命令</h3><p> </p><p> </p><pre><code class="language-bash">sudo ufw deny http</code></pre><p><span class="ez-toc-section" id="7-_Deleting_Rules"/> <span> 7-删除规则</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">sudo ufw deny from 203.0.113.4  </code></pre><p>您将学习两种不同的方法来指定现在删除哪些规则。<strong>1</strong>–按规则编号。<strong>2</strong>——按实际规则。</p><p>第一种方法更容易，所以我们将从它开始。</p><h3 id="step-7-—-deleting-rules">当您使用<strong>规则号</strong>删除防火墙规则时，您应该会得到一个防火墙规则列表。</h3><p><span>编号输出:</span></p><p>如果您想要删除规则2，即允许端口80 (HTTP)连接的规则，您应该在UFW删除命令中指定它，如下所示。</p><p>现在，如果您想要指定要删除的实际规则，您可以删除<span> allow http </span>规则，您可以键入如下示例。</p><pre><code class="language-bash">sudo ufw status numbered  </code></pre><p title="Numbered Output:">除了服务名，您还可以通过<span> allow 80 </span>来指定规则</p><pre><code class="language-bash">Status: active         To                         Action      From       --                         ------      ----  [ 1] 22                         ALLOW IN    15.15.15.0/24  [ 2] 80                         ALLOW IN    Anywhere</code></pre><p>此方法将删除IPv4和IPv6规则(如果它们存在)。</p><p> </p><pre><code class="language-bash">sudo ufw delete 2  </code></pre><p> </p><pre><code class="language-bash">sudo ufw delete <span>allow http  </span></code></pre><p><span class="ez-toc-section" id="8-_Checking_UFW_Status_and_Rules"/> <span> 8-检查UFW状态和规则</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">sudo ufw delete <span class="highlight">allow 80</span></code></pre><p>要检查UFW的状态，请使用下面的命令。</p><p>如果UFW是残疾人，你会看到这样的东西，</p><p><span>输出</span></p><h3 id="step-8-—-checking-ufw-status-and-rules">如果UFW处于活动状态，输出将显示它处于活动状态，并列出设置的所有规则(如果您按照步骤3操作，它应该处于活动状态)</h3><p><span>输出</span></p><pre><code class="language-bash">sudo ufw status verbose</code></pre><p>当您想检查UFW是如何配置防火墙的，您应该使用<span> status </span>命令。</p><pre><code class="language-bash"/></pre><p title="Output"> </p><pre><code class="language-bash">Status: inactive</code></pre><p> </p><p title="Output"><span class="ez-toc-section" id="9-_Disabling_or_Resetting_UFW"/> <span> 9-禁用或复位UFW </span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">Status: active  Logging: on (low)  Default: deny (incoming), allow (outgoing), disabled (routed)  New profiles: skip    To                         Action      From  --                         ------      ----  22/tcp                     ALLOW IN    Anywhere</code></pre><p>如果您不想使用UFW，可以使用下面的命令禁用它。</p><p>如果以后需要激活，您可以运行<span> sudo ufw enable </span>。此外，如果您已经配置了UFW规则，但决定要重新开始，也可以使用reset命令。</p><p>默认策略不会更改为其原始设置，这将禁用UFW并删除之前定义的任何规则。</p><h3 id="step-9-—-disabling-or-resetting-ufw-optional"> </h3><p>亲爱的用户，我们希望你会喜欢这个教程在Ubuntu 20.04上用UFW设置防火墙，你可以在评论区提出关于这个培训的问题，或者解决<a href="https://eldernode.com/blog/"> Eldernode培训</a>领域的其他问题，参考<a href="https://eldernode.com/ask">提问页面</a>部分并在里面提出你的问题。</p><pre><code class="language-bash">sudo ufw disable  </code></pre><p><strong>同样，参见</strong></p><pre><code class="language-bash">sudo ufw reset  </code></pre><p><span> <a href="https://eldernode.com/install-nginx-on-ubuntu-20-04-lts/">如何在Ubuntu 20.04上安装Nginx LTS</a>T3】</span></p><p><span> <a href="https://eldernode.com/install-the-latest-phpmyadmin-on-ubuntu-20/">教程在Ubuntu 20.04 Linux上安装最新的phpMyAdmin</a>T3】</span></p><p><span> <a href="https://eldernode.com/how-to-install-lamp-on-ubuntu-20-04/">如何在Ubuntu 20.04上安装lamp</a>T3】</span></p><p> </p><p><strong>Also, see</strong></p><p class="fjpost-title px-0"><span><a href="https://eldernode.com/install-nginx-on-ubuntu-20-04-lts/">How To Install Nginx on Ubuntu 20.04 LTS</a></span></p><p class="fjpost-title px-0"><span><a href="https://eldernode.com/install-the-latest-phpmyadmin-on-ubuntu-20/">Tutorial Install the Latest phpMyAdmin on Ubuntu 20.04 Linux</a></span></p><p class="fjpost-title px-0"><span><a href="https://eldernode.com/how-to-install-lamp-on-ubuntu-20-04/">How to install lamp on Ubuntu 20.04</a></span></p><p class="fjpost-info"/><p class="fjpost-info"/></div></div>    
</body>
</html>