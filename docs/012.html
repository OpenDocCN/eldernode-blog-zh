<html>
<head>
<title>Common Apache Errors Troubleshooting - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>常见Apache错误故障排除- Eldernode</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/apache-errors-troubleshooting/#0001-01-01">https://blog.eldernode.com/apache-errors-troubleshooting/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/e2280e9461d590c6403addd286cfeb17.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Common Apache Errors Troubleshooting" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_1987.png"/><p>在接下来的Apache教程中，在本文中，您将学习常见Apache错误的故障排除。本系列教程解释了如何对使用Apache webserver时可能遇到的一些最常见的错误进行故障排除和修复。</p><div class="description"><p>本系列中的每一篇教程都包括对常见的Apache配置、网络、文件系统或权限错误的描述。本系列文章首先概述了可以用来对<a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"> Apache </a>进行故障排除的命令和日志文件。后续教程详细分析了特定的错误。为了让这个指南更好地发挥作用，尝试购买和使用<a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener noreferrer"> VPS </a>或<a href="https://eldernode.com/linux-hosting/" target="_blank" rel="noopener noreferrer"> Linux虚拟主机</a>。</p><p> </p></div><p> </p><p> </p><h2><span class="ez-toc-section" id="Common_Apache_Errors_Troubleshooting"/>常见Apache错误故障排除<span class="ez-toc-section-end"/></h2><div class="description"><p>有三个主要命令和一组常见的日志位置，可以用来开始排除Apache错误。通常，在对Apache进行故障排除时，您将按此处指示的顺序使用这些命令，然后检查日志文件中的特定诊断数据。</p><p>在大多数Linux发行版中，您通常用来对Apache进行故障排除的命令有:</p><p><strong>system CTL</strong>–用于通过systemd服务管理器控制Linux服务并与之交互。<br/><strong/>——用于查询和查看systemd生成的日志。<br/><strong>Apache CTL</strong>–排除故障时，该命令用于检查Apache的配置。</p><p>这些命令、如何使用它们以及Apache的日志位置(您可以在其中找到关于错误的其他信息)将在下面的章节中详细描述。</p></div><p> </p><p><span> <strong>请注意</strong> </span>:在Debian和Ubuntu系统上，apache的服务和进程名是apache2，而在CentOS、Fedora等RedHat衍生系统上，Apache的服务和进程名是httpd。除了服务和正在运行的进程名之间的差异之外，启动、停止和检查Apache的状态，以及使用journalctl的日志在任何使用systemd管理Apache服务的Linux系统上应该都是一样的。确保为您的Linux发行版使用正确的名称。</p><p> </p><p class="description"/><h3 class="description"><span class="ez-toc-section" id="systemctl_Commands_for_Apache"/> <span> <strong> systemctl </strong> </span>针对阿帕奇的命令<span class="ez-toc-section-end"/></h3><p>要使用<span> <strong> systemd </strong> </span>服务管理器排除常见的Apache错误，第一步是检查系统上Apache进程的状态。下面的<span> <strong> systemctl </strong> </span>命令将查询<span> <strong> systemd </strong> </span>以获得Apache进程的状态。</p><p>在Ubuntu和Debian系统上运行:</p><pre class="code-pre command prefixed"><code class="language-bash">sudo systemctl status apache2.service -l --no-pager</code></pre><p><span> <strong> -l </strong> </span>标志将确保输出不被截断或省略。<span><strong>–无寻呼机</strong> </span>标志将确保输出将直接发送到您的终端，而不需要您进行任何交互来查看它。您应该会收到如下输出:</p><p title="Output"><span>输出</span></p><pre class="code-pre"><code class="language-bash">● apache2.service - The Apache HTTP Server     Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)    Drop-In: /lib/systemd/system/apache2.service.d             └─apache2-systemd.conf     Active: active (running) since Mon 2020-07-13 14:43:35 UTC; 1 day 4h ago    Process: 929 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)   Main PID: 1346 (apache2)      Tasks: 55 (limit: 4702)     CGroup: /system.slice/apache2.service             ├─1346 /usr/sbin/apache2 -k start  . . .</code></pre><p>要在CentOS和Fedora系统上检查Apache进程，请运行:</p><pre><code class="language-bash">sudo systemctl status httpd.service -l --no-pager</code></pre><p title="Output"><span>输出</span></p><pre class="code-pre"><code class="language-bash">● httpd.service - The Apache HTTP Server     Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)     Active: active (running) since Tue 2020-07-14 19:46:52 UTC; 3s ago       Docs: man:httpd.service(8)   Main PID: 21217 (httpd)     Status: "Started, listening on: port 80"      Tasks: 213 (limit: 2881)     Memory: 16.6M     CGroup: /system.slice/httpd.service             ├─21217 /usr/sbin/httpd -DFOREGROUND  . . .  Jul 14 19:46:52 localhost.localdomain httpd[21217]: Server configured, listening on: port 80</code></pre><p>在任一情况下，记下输出中的<span> <strong>活动</strong> </span>行。如果您的Apache服务器没有显示前面例子中突出显示的<span> <strong>活动(运行)</strong> </span>，但是您期望它应该显示，那么可能有一个错误。通常，如果出现问题，您的输出中会有如下一行(注意突出显示的失败部分):</p><p><span>示例错误输出</span></p><p title="Example Error Output">如果您的Apache进程或配置有问题，您可以使用<span> <strong> journalctl </strong> </span>命令进一步排除故障。</p><pre><code class="language-bash">Active: failed (Result: exit-code) since Tue 2020-07-14 20:01:29 UTC; 1s ago</code></pre><p>如果您的Apache进程或配置有问题，您可以使用<span> <strong> journalctl </strong> </span>命令进一步排除故障。</p><p class="fjpost-info"/><p> </p><p><span class="ez-toc-section" id="journalctl_Commands_for_Apache"/><span><strong/></span>用于阿帕奇的命令<span class="ez-toc-section-end"/></p><h3 id="journalctl-commands-for-apache">要检查Apache的<span> <strong> systemd </strong> </span>日志，可以使用<span> <strong> journalctl </strong> </span>命令。Apache的<strong> <span> systemd </span> </strong>日志通常会指出Apache进程的启动或管理是否存在问题。</h3><p>这些日志独立于Apache的请求和错误日志。<span> <strong> journalctl </strong> </span>显示来自<span> <strong> systemd </strong> </span>的日志，这些日志描述了Apache服务本身，从启动到关闭，以及在此过程中可能遇到的任何进程错误。</p><p>在Ubuntu和Debian系统上，使用以下命令检查日志:</p><p><span>–since today</span>标志将限制命令的输出，仅记录当天00:00:00开始的条目。使用此选项将有助于限制在检查错误时需要检查的日志条目的数量。您应该会收到如下输出:</p><pre><code class="language-bash">sudo journalctl -u apache2.service --since today --no-pager</code></pre><pre><code class="language-bash"/></pre><p><span>输出</span></p><p title="Output">如果您使用基于CentOS或Fedora的系统，请使用以下版本的命令:</p><pre><code class="language-bash">Jul 14 20:12:14 ubuntu2004 systemd[1]: Starting The Apache HTTP Server...  Jul 14 20:12:14 ubuntu2004 systemd[1]: Started The Apache HTTP Server.</code></pre><p><span>输出</span></p><pre><code class="language-bash">sudo journalctl -u httpd.service --since today --no-pager</code></pre><p title="Output">如果有错误，您将在输出中看到类似下面的一行，Linux发行版之间的主要区别是突出显示的<span> yourhostname </span>部分:</p><pre><code class="language-bash">Jul 14 20:13:09 centos8 systemd[1]: Starting The Apache HTTP Server...  . . .  Jul 14 20:13:10 centos8 httpd[21591]: Server configured, listening on: port 80</code></pre><p><span>示例错误输出</span></p><p class="secondary-code-label" title="Example Error Output">如果您的Apache服务器在<span> <strong>日志</strong> </span>中有错误，那么下一步就是使用<span> <strong> apachectl </strong> </span>命令行工具调查Apache的配置。</p><pre><code class="language-bash">Jul 14 20:13:37 yourhostname systemd[1]: Failed to start The Apache HTTP Server.</code></pre><p> </p><p> </p><p> </p><p><span class="ez-toc-section" id="Troubleshooting_with_apachectl"/>故障排除用<span><strong>Apache CTL</strong></span>T5】</p><h3 id="troubleshooting-with-apachectl">大多数Linux发行版都包括Apache的<span> <strong> apachectl </strong> </span>实用程序。<span> <strong> apachectl </strong> </span>是一个帮助检测和诊断Apache配置问题的无价工具。</h3><p>要使用<span> <strong> apachectl </strong> </span>解决问题，请使用<span><strong>Apache CTL config test</strong></span>命令测试您的Apache配置。该工具将解析您的Apache文件，并在尝试启动服务器之前检测任何错误或缺失的设置。</p><p>在基于Ubuntu、Debian、CentOS和Fedora的发行版上运行如下命令:</p><p>一个有效的Apache配置将产生如下所示的输出:</p><pre><code class="language-bash">sudo apachectl configtest</code></pre><p><span>输出</span></p><p title="Output">根据您的Linux发行版，可能会有其他行混入输出中，但是重要的一行是说<span> <strong>语法OK </strong> </span>的那一行。</p><pre class="code-pre"><code class="language-bash">Syntax OK</code></pre><p>如果您的Apache配置中有错误，比如某个指令引用了一个未启用的模块，甚至是一个错别字，<span> <strong> apachectl </strong> </span>都会检测到它，并尝试通知您这个问题。</p><p>例如，试图对未启用的Apache模块使用指令将导致如下所示的apachectl configtest消息。</p><p><span>示例错误输出</span></p><p title="Example Error Output">在本例中，<span> <strong> ssl </strong> </span>模块未启用，因此在测试配置时，<span> <strong> SSLEngine </strong> </span>指令会产生错误。最后一行还表示<span><strong>Apache错误日志可能有更多的信息</strong> </span>，这是下一个查找更详细的调试信息的地方。</p><pre class="code-pre"><code class="language-bash">AH00526: Syntax error on line 232 of /etc/apache2/apache2.conf:  Invalid command 'SSLEngine', perhaps misspelled or defined by a module not included in the server configuration  Action 'configtest' failed.  The Apache error log may have more information.</code></pre><p> </p><p><span class="ez-toc-section" id="Apache_Log_Files"/> Apache日志文件<span class="ez-toc-section-end"/></p><h3 id="apache-log-files">Apache日志文件对于故障排除是非常有用的资源。通常，您在浏览器或其他HTTP客户端收到的任何错误都会在Apache的日志中有相应的条目。有时，Apache还会将与配置、内置模块和其他调试信息相关的错误输出到其日志文件中。</h3><p>要在对Fedora、CentOS或RedHat服务器上的Apache进行故障排除时检查日志文件中的错误，请检查<span><strong>/var/log/httpd/error _ log</strong></span>文件。</p><p>如果您正在对Debian或Ubuntu衍生的系统进行故障排除，请使用类似于<span> <strong> tail </strong> </span>或<span> <strong> less </strong> </span>的工具检查<span><strong>/var/log/Apache 2/error . log</strong></span>中的错误。例如，要使用<span><strong/></span>查看错误日志的最后两行，请运行以下命令:</p><p>用你想检查的行数代替命令中的数字<span> <strong> 2 </strong> </span>。在CentOS或Fedora系统上，要检查的日志文件是<span><strong>/var/log/httpd/error _ log</strong></span>。</p><pre><code class="language-bash">sudo tail -n 2 /var/log/apache2/error.log</code></pre><p>错误示例类似于下面几行。不管您使用哪个Linux发行版来运行Apache服务器:</p><p><span>错误日志示例</span></p><p title="Error Log Examples">该输出中的两行是不同的错误消息。它们都引用了导致错误的模块(第一行是<span> <strong>代理</strong> </span>，第二行是<span> <strong>代理_http </strong> </span>)，并且包含了一个特定于该模块的错误代码。第一个，<span> <strong> AH00957 </strong> </span>，表示Apache服务器试图使用<span> <strong>代理</strong> </span>模块连接到后端服务器(在本例中为端口9090上的127.0.0.1 ),但未能成功。</p><pre><code class="language-bash">[Wed Jul 15 01:34:12.093005 2020] [proxy:error] [pid 13949:tid 140150453516032] (13)Permission denied: AH00957: HTTP: attempt to connect to 127.0.0.1:9090 (127.0.0.1) failed  [Wed Jul 15 01:34:12.093078 2020] [proxy_http:error] [pid 13949:tid 140150453516032] [client 127.0.0.1:42480] AH01114: HTTP: failed to make connection to backend: 127.0.0.1</code></pre><p>第二个错误源于第一个错误:AH01114是一个<span> <strong> proxy_http </strong> </span>模块错误，它也表明Apache无法连接到已配置的后端服务器来发出http请求。</p><p>这些示例行仅用于说明目的。如果您正在诊断Apache服务器的错误，那么日志中的错误行可能会有不同的内容。不管您的Linux发行版如何，日志中任何错误行的格式都将包括相关的Apache模块和错误代码，以及错误的文本描述。</p><p>一旦您知道是什么导致了Apache服务器的问题，您就可以继续研究和解决这个问题。错误代码和文本描述特别有用，因为它们为您提供了明确而具体的术语，您可以使用这些术语来缩小问题的可能原因的范围。</p><p> </p><p> </p><p><span class="ez-toc-section" id="conclusion"/> <strong>结论</strong> <span class="ez-toc-section-end"/></p><h2>Apache错误的故障排除范围很广，从诊断服务本身的错误，到定位模块的错误配置选项，或者详细检查定制的访问控制规则。这篇关于诊断Apache问题的介绍解释了如何使用许多实用程序来帮助缩小错误的可能原因。通常，您会以相同的顺序使用这些实用程序，尽管您总是可以跳过一些，或者如果您对问题可能是什么有一个大致的概念，就直接从检查日志开始。如果你有兴趣学习更多关于Apache的知识，可以找到我们的相关文章，比如如何在Debian 10上使用Let's Encrypt来保护Apache的安全，或者如何在Ubuntu 20.04上使用Let's Encrypt来保护Apache的安全，比如T2的文章。</h2><p>但是，作为故障排除的一般顺序，有条不紊地按照描述的顺序使用这些工具会有所帮助。使用<span> systemctl </span>开始故障排除，以检查Apache服务器的状态。如果需要更多信息，可以使用<span> <strong> journalctl </strong> </span>命令检查Apache的<span> <strong> systemd </strong> </span>日志。如果在检查<span> <strong>日志</strong> </span>后问题仍然不明显，下一步是使用<span><strong>Apache CTL config test</strong></span>测试Apache的配置。最后，为了进行深入的故障排除，检查Apache的日志文件通常会指出一个特定的错误，并提供有用的诊断消息和错误代码。</p><div class="centered"><div class="row no-gutters position-relative mt-3"><p class="col-md-2 mb-md-0 p-0 text-white centered">但是，作为故障排除的一般顺序，有条不紊地按照描述的顺序使用这些工具会有所帮助。使用<span> systemctl </span>开始故障排除，以检查Apache服务器的状态。如果需要更多信息，可以使用<span> <strong> journalctl </strong> </span>命令检查Apache的<span> <strong> systemd </strong> </span>日志。如果在检查<span> <strong>日志</strong> </span>后问题仍然不明显，下一步是使用<span><strong>Apache CTL config test</strong></span>测试Apache的配置。最后，为了进行深入的故障排除，检查Apache的日志文件通常会指出一个特定的错误，并提供有用的诊断消息和错误代码。</p></div></div></div></div>    
</body>
</html>