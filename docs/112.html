<html>
<head>
<title>How to set up a Firewall with UFW on Debian 10 - Enabling UFW</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Debian 10上用UFW设置防火墙——启用UFW</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/set-up-firewall-ufw-debian-10/#0001-01-01">https://blog.eldernode.com/set-up-firewall-ufw-debian-10/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/c418b9f5dd9c8d0ac911aa416f99ae92.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to set up a Firewall with UFW on Debian 10" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2097.png"/><p>你已经阅读了我们最新的<span> <a href="https://eldernode.com/tag/firewalld-tutorial/" target="_blank" rel="noopener noreferrer">防火墙</a> </span>教程。在这篇文章中，你将学习<strong>如何在Debian 10 </strong>上用UFW设置防火墙。简单防火墙<strong> (UFW) </strong>是<strong> <span> iptables </span> </strong>的接口，旨在简化配置防火墙的过程。虽然<span> <strong> iptables </strong> </span>是一个可靠而灵活的工具，但对于初学者来说，学习如何使用它来正确配置防火墙可能会很困难。如果你想开始保护你的网络，但又不确定使用哪种工具，UFW可能是你的正确选择。</p><p> </p><p><strong>先决条件</strong></p><p>如果您知道以下内容，本教程可能会更有用:</p><p>拥有<span> sudo </span>权限的非根用户</p><p>按照Debian 10  上的<span> <a href="https://eldernode.com/initial-setup-with-debian-10/" target="_blank" rel="noopener noreferrer">初始服务器设置进行设置</a></span></p><p> </p><h2><span class="ez-toc-section" id="How_to_set_up_a_Firewall_with_UFW_on_Debian_10"/> <span>如何在Debian 10上用UFW设置防火墙</span> <span class="ez-toc-section-end"/></h2><p>请继续关注我们，本教程将向您展示如何在Debian 10上用UFW设置防火墙。回顾以下步骤，获得这方面的专家帮助。</p><p> </p><h3><span class="ez-toc-section" id="1-_Installing_UFW"/> <span> 1-安装UFW</span>T3】</h3><p>由于默认情况下<a href="https://www.debian.org/"> Debian </a>不会安装UFW，你将已经安装并启用了UFW，正如你按照整个<a href="https://eldernode.com/initial-setup-with-debian-10/">初始服务器设置教程</a>所做的那样，你将已经安装并启用了UFW。如果没有，现在使用<span> apt </span>安装:</p><pre><code class="language-bash">sudo apt install ufw</code></pre><p> </p><h3 id="step-2-—-using-ipv6-with-ufw-optional"><span class="ez-toc-section" id="Using_IPv6_with_UFW_Optional"/> <span>【与UFW一起使用IPv6(可选)</span> <span class="ez-toc-section-end"/></h3><p>本教程是在考虑IPv4的情况下编写的，但只要您启用了IPv6，它也适用于IPv6。如果你的Debian服务器支持IPv6，你需要确保UFW支持IPv6；这将确保UFW除了管理IPv4之外，还管理IPv6的防火墙规则。要对此进行配置，请使用<span> nano </span>或您喜欢的编辑器打开UFW配置文件<span> /etc/default/ufw </span></p><pre><code class="language-bash">sudo nano /etc/default/ufw</code></pre><p>确保<span> IPV6 </span>的值为<span>是</span>。它应该是这样的:</p><p class="code-label" title="/etc/default/ufw excerpt"><span> /etc/default/ufw摘录</span></p><pre title="/etc/default/ufw excerpt"><code class="language-bash"><span>IPV6=yes  </span></code></pre><p>您现在可以保存并关闭文件。启用UFW后，它将被配置为写入IPv4和IPv6防火墙规则。但是，在启用UFW之前，您需要确保您的防火墙配置为允许您通过SSH连接。让我们从设置默认策略开始。</p><p> </p><h3 id="step-3-—-setting-up-default-policies"><span class="ez-toc-section" id="3-_Setting_Up_Default_Policies"/> <span> 3-设置默认策略</span> <span class="ez-toc-section-end"/></h3><p>如果您刚刚开始使用防火墙，首先要定义的规则是您的默认策略。这些规则处理不与任何其他规则明确匹配的流量。默认情况下，UFW被设置为拒绝所有传入连接并允许所有传出连接。这意味着任何试图访问您的服务器的人都无法连接，而服务器内的任何应用程序都可以访问外部世界。</p><p>要将您的UFW规则设置回默认值，您可以确信您将能够遵循本教程。要设置UFW使用的默认值，请使用以下命令:</p><pre><code class="language-bash"/></pre><pre><code class="language-bash">sudo ufw default deny incoming  sudo ufw default allow outgoing</code></pre><p> </p><p><a href="https://eldernode.com/bitcoin-vps/"> <span>用</span> <span>比特币</span> </a>购买虚拟机</p><p> </p><h3 id="step-4-—-allowing-ssh-connections"><span class="ez-toc-section" id="4-_Allowing_SSH_Connections"/> <span> 4-允许SSH连接</span> <span class="ez-toc-section-end"/></h3><p>通过启用您的UFW防火墙，它将拒绝所有传入的连接。您将需要创建明确允许合法传入连接的规则，例如SSH或HTTP连接，如果我们希望我们的服务器响应这些类型的请求的话。如果您使用的是云服务器，您可能希望允许传入的SSH连接，这样您就可以连接并管理您的服务器。</p><p>要配置服务器以允许传入的SSH连接:</p><pre><code class="language-bash">sudo ufw allow ssh</code></pre><p>这将创建防火墙规则，允许端口<span> 22 </span>上的所有连接，这是SSH守护程序默认监听的端口。UFW知道端口<span>允许ssh </span>意味着什么，因为它在<span> /etc/services </span>文件中被列为服务。</p><p>总之，您实际上可以通过指定端口而不是服务名来编写等效的规则。例如，此命令会产生与上面命令相同的结果:</p><pre><code class="language-bash">sudo ufw allow 22</code></pre><p>您必须指定适当的端口，如果您将SSH守护进程配置为使用不同的端口，您必须指定适当的端口。例如，如果您的SSH服务器正在侦听端口2222，您可以使用以下命令来允许该端口上的连接:</p><pre><code class="language-bash">sudo ufw allow <span class="highlight">2222      </span></code></pre><h3 id="step-5-—-enabling-ufw"><span class="ez-toc-section" id="5-_Enabling_UFW"/> <span> 5-启用UFW </span> <span class="ez-toc-section-end"/></h3><p><span class="highlight"> <span>因为您配置了防火墙</span> </span>来允许传入的SSH连接，所以您可以启用它。</p><pre><code class="language-bash">sudo ufw enable</code></pre><p>通过运行上面的命令，您会收到一条警告，指出该命令可能会中断现有的SSH连接。我们已经设置了允许SSH连接的防火墙规则，所以应该可以继续了。用<span> y </span>响应提示，点击<span>回车</span>。然后，您会发现防火墙处于活动状态。但是要查看您设置的规则，运行<span> sudo ufw status verbose </span>命令。</p><pre><code class="language-bash"/></pre><h3 id="step-6-—-allowing-other-connections"><span class="ez-toc-section" id="6-_Allowing_Other_Connections"/> <span> 6-允许其他连接</span> <span class="ez-toc-section-end"/></h3><p>从现在开始，允许服务器正常工作所需的所有其他连接。您应该允许的连接取决于您的特定需求。幸运的是，您已经知道如何编写允许基于服务名或端口的连接的规则；我们已经在端口<span> 22上为SSH做了这件事。</span>您也可以这样做:</p><ul><li>端口<span> 80 </span>上的HTTP，这是未加密的web服务器使用的端口。要允许这种类型的流量，您可以键入<span> sudo ufw allow http </span>或<span> sudo ufw allow 80 </span>。</li><li>端口<span> 443 </span>上的HTTPS，这是加密的web服务器所使用的。要允许这种类型的流量，您可以键入<span> sudo ufw allow https </span>或<span> sudo ufw allow 443 </span>。</li></ul><p>但是，让我们验证除了指定端口或已知服务之外，允许连接的其他方法。</p><h4/><h4 id="specific-port-ranges"><span class="ez-toc-section" id="Specific_Port_Ranges"/> <span>具体端口范围</span> <span class="ez-toc-section-end"/></h4><p>您将学习如何使用UFW指定端口范围。例如，一些应用程序使用多个端口而不是单个端口。</p><p>要允许使用端口<span> 6000-6007 </span>的<span> X11 </span>连接，请使用以下命令:</p><pre><code class="language-bash">sudo ufw allow <span class="highlight">6000</span>:<span class="highlight">6007</span>/tcp  sudo ufw allow <span class="highlight">6000</span>:<span class="highlight">6007</span>/udp</code></pre><p> </p><h4 id="specific-ip-addresses"><span class="ez-toc-section" id="Specific_IP_Addresses"/> <span>具体IP地址</span> <span class="ez-toc-section-end"/></h4><p>使用UFW时，您还可以指定IP地址。例如，如果您希望允许来自特定IP地址的连接，例如来自<span>203.0.113.4</span>的工作或家庭IP地址，您需要指定来自的<span>，然后指定IP地址:</span></p><pre><code class="language-bash">sudo ufw allow from <span>203.0.113.4</span></code></pre><pre><code class="language-bash"/></pre><p>您还可以通过在任何端口后添加端口号<span>来指定允许IP地址连接的特定端口。例如，如果你想让203.0.113.4</span>的<span>连接到端口<span> 22 </span> (SSH)，使用这个命令:</span></p><pre><code class="language-bash">sudo ufw allow from<span class="highlight"> 203.0.113.4</span> to any port <span class="highlight">22</span></code></pre><h3/><h4 id="subnets"><span class="ez-toc-section" id="Subnets"/> <span>子网</span></h4><p>如果您想要允许IP地址的子网，您可以使用CIDR符号来指定网络掩码。例如，如果您想要允许从<span>203.0.113.1</span>到<span>203.0.113.254</span>的所有IP地址，您可以使用以下命令:</p><pre><code class="language-bash">sudo ufw allow from <span class="highlight">203.0.113.0</span>/<span class="highlight">24</span></code></pre><p>同样，您也可以指定子网<span> 203.0.113.0 </span> / <span> 24 </span>允许连接的目的端口。同样，我们将使用端口<span> 22 </span> (SSH)作为例子。</p><p> </p><h3 id="connections-to-a-specific-network-interface"><span class="ez-toc-section" id="Connections_to_a_Specific_Network_Interface"/> <span>连接到特定的网络接口</span> <span class="ez-toc-section-end"/></h3><p>如果您想要创建仅适用于特定网络接口的防火墙规则，请在上指定<span> allow in，后跟网络接口的名称</span></p><p>要在继续之前查找您的网络接口:</p><pre><code class="language-bash">ip addr</code></pre><p><span>输出</span></p><pre><code class="language-bash">2: <span>eth0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state  . . .  3: <span>eth1</span>: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default  . . .</code></pre><p>突出显示的输出指示网络接口名称。他们通常会将一些东西命名为eth 0 T1或T2 enp3s 2 T3。</p><p>例如，如果您的服务器有一个名为<span> eth0 </span>的公共网络接口，您可以使用以下命令允许HTTP流量通过它:</p><pre><code class="language-bash">sudo ufw allow in on <span class="highlight">eth0</span> to any port <span class="highlight">80</span></code></pre><p>因此它将允许您的服务器接收来自公共互联网的HTTP请求。</p><p>或者，如果您希望MySQL数据库服务器(端口<span> 3306 </span>)监听专用网络接口<span> eth1 </span>上的连接，您可以使用以下命令:</p><pre><code class="language-bash">sudo ufw allow in on eth1 to any port 3306</code></pre><pre><code class="language-bash"/></pre><pre><code class="language-bash"/></pre><h3 id="step-7-—-denying-connections"><span class="ez-toc-section" id="7-_Denying_Connections"/> <span> 7-拒绝连接</span> <span class="ez-toc-section-end"/></h3><p>很明显，如果您没有更改传入连接的默认策略，UFW被配置为拒绝所有传入连接。但是，这简化了创建安全防火墙策略的过程，因为它要求您创建明确允许特定端口和IP地址通过的规则。</p><p>但是，任何时候您希望拒绝基于源IP地址或子网的特定连接，可能是因为您知道您的服务器正受到来自那里的攻击。此外，如果您想将默认的传入策略更改为<strong>允许</strong>(不推荐)，您需要为您不想允许连接的任何服务或IP地址创建<strong>拒绝</strong>规则。</p><p>要编写<strong>拒绝</strong>规则，您可以使用上述命令，将<strong>允许</strong>替换为<strong>拒绝</strong>。</p><p>拒绝HTTP连接:</p><pre><code class="language-bash">sudo ufw deny http</code></pre><p>此外，如果您想要拒绝来自<span>203.0.113.4</span>的所有连接，您可以使用以下命令</p><pre><code class="language-bash"/></pre><h3 id="step-8-—-deleting-rules"><span class="ez-toc-section" id="8-_Deleting_Rules"/> <span> 8-删除规则</span> <span class="ez-toc-section-end"/></h3><p>了解如何创建和删除防火墙非常重要。有两种方法可以指定要删除的规则:通过规则编号或规则本身。这类似于创建规则时如何指定规则。我们将从解释按规则号删除<strong>的方法开始。</strong></p><h3/><h4 id="by-rule-number"><span class="ez-toc-section" id="By_Rule_Number"/> <span>按规则编号</span> <span class="ez-toc-section-end"/></h4><p>如果您选择使用规则编号来删除防火墙规则，您应该会得到一个防火墙规则列表。UFW <span>状态</span>命令有<span>编号</span>选项，在每个规则旁边显示数字:</p><pre><code class="language-bash">sudo ufw status numbered</code></pre><p title="Output"><span>输出</span></p><pre><code class="language-bash">Status: active         To                         Action      From       --                         ------      ----  [ 1] 22                         ALLOW IN    15.15.15.0/24  [ 2] 80                         ALLOW IN    Anywhere</code></pre><p>通过决定删除规则<span> 2 </span>，它允许端口<span> 80 </span>上的HTTP连接，我们可以在下面的UFW <span> delete </span>命令中指定这一点:</p><p>接下来，您会看到一个确认提示，您可以用<span> y/n </span>来回答。键入y将删除规则<span> 2 </span>。</p><pre><code class="language-bash">sudo ufw delete<span class="highlight"> 2</span></code></pre><p><strong>注意</strong>:如果您启用了IPv6，您还需要删除相应的IPv6规则。</p><p><strong> Note</strong>: If you have IPv6 enabled, you will want to delete the corresponding IPv6 rule as well.</p><h3><span class="ez-toc-section" id="By_Actual_Rule"/> <span>按实际规律</span> <span class="ez-toc-section-end"/></h3><h4 id="by-actual-rule">要使用替代的编号规则，请指定要删除的实际规则。例如，如果您想删除<span>允许http </span>规则，您可以这样写:</h4><p>即使不是服务名，您也可以用<span> allow 80 </span>来指定规则</p><pre><code class="language-bash">sudo ufw delete <span class="highlight">allow http</span></code></pre><p><strong>点</strong>:此方法将删除IPv4和IPv6规则，如果它们存在的话。</p><pre><code class="language-bash">sudo ufw delete<span> allow 80</span></code></pre><p><span class="ez-toc-section" id="9-_Checking_UFW_Status_and_Rules"/> <span> 9-检查UFW状态和规则</span> <span class="ez-toc-section-end"/></p><h3 id="step-9-—-checking-ufw-status-and-rules">要使用以下命令检查UFW的状态:</h3><p>如果UFW被禁用，这是默认设置，您将看到如下内容:</p><pre><code class="language-bash">sudo ufw status verbose</code></pre><p><span>输出</span></p><p title="Output">如果UFW处于活动状态(如果您遵循步骤3，它应该处于活动状态)，输出将显示它处于活动状态，并列出您设置的任何规则。例如，如果防火墙设置为允许来自任何地方的SSH (port <span> 22 </span>)连接，则输出可能如下所示:</p><pre><code class="language-bash">Status: inactive</code></pre><p><span>输出</span></p><p title="Output"><strong>点</strong>:如果你想检查UFW是如何配置防火墙的，使用status命令。</p><pre><code class="language-bash">Status: active    To                         Action      From  --                         ------      ----  22/tcp</code></pre><p> </p><p> </p><p><span class="ez-toc-section" id="10-_Disabling_or_Resetting_UFW_optional"/> <span> 10-禁用或复位UFW(可选)</span> <span class="ez-toc-section-end"/></p><h3 id="step-10-—-disabling-or-resetting-ufw-optional">要使用以下命令禁用它:</h3><p>您用UFW创建的任何规则都将不再有效。如果以后需要激活，您可以运行<span> sudo ufw enable </span>。</p><pre><code class="language-bash">sudo ufw disable</code></pre><p>但是，如果您已经配置了UFW规则，但是您决定重新开始，您可以使用reset命令:</p><p> </p><pre><code class="language-bash">sudo ufw reset</code></pre><p>最后，这将禁用UFW并删除您之前定义的任何规则。请记住，如果您在任何时候修改了默认策略，它们不会更改为原始设置。这应该给你一个新的开始与UFW。</p><p><strong> <span>好样的</span> </strong>！您的防火墙现在配置为允许SSH连接。确保允许服务器需要的任何其他传入连接，同时限制不必要的连接。这将确保您的服务器既正常又安全。</p><p>亲爱的用户，我们希望你会喜欢这篇关于如何在Debian 10上用UFW建立防火墙的教程，你可以在评论区提出关于这次培训的问题，或者要解决<a href="https://eldernode.com/"> Eldernode </a>培训领域的其他问题，请参考<a href="https://eldernode.com/ask">提问页面</a>部分并在里面提出你的问题。</p><p>Dear user, we hope you would enjoy this tutorial How to set up a Firewall with UFW on Debian 10, you can ask questions about this training in the comments section, or to solve other problems in the field of <a href="https://eldernode.com/">Eldernode</a> training, refer to the <a href="https://eldernode.com/ask">Ask page</a> section and raise your problems in it.</p></div></div>    
</body>
</html>