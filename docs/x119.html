<html>
<head>
<title>How to Configure SSH VPN Tunnel on Ubuntu 20.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Ubuntu 20.04上配置SSH VPN隧道</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/configure-ssh-vpn-tunnel-on-ubuntu-20-04/#0001-01-01">https://blog.eldernode.com/configure-ssh-vpn-tunnel-on-ubuntu-20-04/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/070f9077fc53249e0199c3db28e404ca.png" data-src="https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04.webp" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to Configure SSH VPN Tunnel on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04.webp 2069w, https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04-300x164.webp 300w, https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04-1024x561.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04-768x421.webp 768w, https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04-1536x842.webp 1536w, https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04-2048x1122.webp 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/01/How-to-Configure-SSH-VPN-Tunnel-on-Ubuntu-20.04.webp"/><p>SSH是一种安全的通信协议，它通过安全的通信隧道传输数据。SSH隧道是另一种技术，攻击者可以通过这种技术绕过防火墙限制。本文将教你如何在Ubuntu 20.04上配置SSH VPN隧道。如果你打算购买自己的<a href="https://eldernode.com/ubuntu-vps/"> Ubuntu VPS </a>服务器，你可以查看<a href="https://eldernode.com/"> Eldernode </a>网站上提供的软件包。</p><h2><span class="ez-toc-section" id="How_to_Setup_SSH_VPN_Tunnel_on_Ubuntu_VPS"/> <strong>如何在Ubuntu VPS上设置SSH VPN隧道</strong> <span class="ez-toc-section-end"/></h2><p>SSH隧道或SSH端口转发是一种通过加密的SSH连接传输网络数据的方法。事实上，它是OpenSSH的工具之一，允许TCP或UDP端口通过SSH连接进行转发。OpenSSH可以在SSH连接的基础上创建一个虚拟以太网适配器，允许完整的第3层IP连接。这允许您添加通过此虚拟连接的路由，并通过它运行路由协议。</p><h3><span class="ez-toc-section" id="Installing_SSH_VPN_Tunnel_on_Ubuntu_2004"/> <strong>在Ubuntu 20.04上安装SSH VPN隧道</strong> <span class="ez-toc-section-end"/></h3><p>首先，您将设置一个IP SSH隧道，从位于私有物理IP 192.168.0.2的左侧Ubuntu20.04Server-1到位于公共物理IP 192.168.0.2的右侧Ubuntu20.04Server-3。SSH隧道将使用10.0.0.0/30网络。该隧道穿过Cisco路由器上设置的NAT (PAT ),该路由器将Ubuntu20.04Server-1连接到互联网。穿越IP SSH隧道的NAT没有问题。在最后一步中，您将添加静态路由，以允许Ubuntu20.04Server-4通过SSH隧道ping Ubuntu20.04Server-3。</p><p> </p><p><img data-lazyloaded="1" src="../Images/e97adab20e015475089f05379a3c9830.png" decoding="async" loading="lazy" class="aligncenter wp-image-42549 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2023/01/Installing-SSH-VPN-Tunnel-on-Ubuntu-20.04.webp" alt="Installing SSH VPN Tunnel on Ubuntu 20.04" data-srcset="https://blog.eldernode.com/wp-content/uploads/2023/01/Installing-SSH-VPN-Tunnel-on-Ubuntu-20.04.webp 623w, https://blog.eldernode.com/wp-content/uploads/2023/01/Installing-SSH-VPN-Tunnel-on-Ubuntu-20.04-300x206.webp 300w" data-sizes="(max-width: 623px) 100vw, 623px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2023/01/Installing-SSH-VPN-Tunnel-on-Ubuntu-20.04.webp"/></p><p> </p><p><strong> Ubuntu20.04Server-3 </strong></p><p>第一步，在以下命令的帮助下安装OpenSSH服务器:</p><pre><code class="language-bash">sudo apt-get install openssh-server</code></pre><p>您应该以root用户身份从客户端登录，以创建TUN适配器。用所需的文本编辑器打开以下文件:</p><pre><code class="language-bash">sudo nano /etc/ssh/sshd_config</code></pre><p>现在取消注释，将“<strong> PermitRootLogin禁止密码</strong>改为“<strong> PermitRootLogin无密码</strong>”，将“<strong> PermitTunnel no </strong>”改为“<strong> PermitTunnel yes </strong>”。</p><p>完成后，<strong>保存</strong>文件。</p><p><strong>使用下面的命令重启</strong>您的OpenSSH服务器:</p><pre><code class="language-bash">sudo systemctl restart sshd</code></pre><p><strong> Ubuntu20.04Server-1 </strong></p><p>在此步骤中，通过运行以下命令，安装autossh工具来监视ssh会话，并在会话终止时重新启动它们:</p><pre><code class="language-bash">sudo apt-get install autossh</code></pre><p>最后，设置密钥认证，以root用户身份登录到服务器。为此，请输入以下命令:</p><pre><code class="language-bash">ssh-keygen -t rsa   </code></pre><pre><code class="language-bash">cat ~/.ssh/id_rsa.pub | ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="147975667d786d7a5425263a243a243a26">[email protected]</a> "mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys"</code></pre><h3><span class="ez-toc-section" id="Connecting_the_Tunnel_on_Ubuntu_2004"/> <strong>连接隧道上Ubuntu 20.04</strong>T3】</h3><p>首先，从Ubuntu20.04Server-1输入以下命令:</p><pre><code class="language-bash">autossh -M 0 -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" -NTC -o Tunnel=point-to-point -w 0:0 12.0.0.2 &amp;</code></pre><p>–<strong>-m0</strong>:不用，是指监听TCP端口</p><p>–<strong>-o " ServerAliveInterval 30 "</strong>:每30秒发送一次keepalive</p><p>–<strong>-o " ServerAliveCountMax 3"</strong>:最多重试3次keepalive。Autossh到此结束，接下来开始本地ssh命令。</p><p>–<strong>-N</strong>:指示SSH不要执行远程命令</p><p>–<strong>-T</strong>:禁用伪tty分配</p><p>–<strong>-C</strong>:压缩可能会提高性能，也可能会降低性能</p><p>–<strong>-o Tunnel =点对点</strong>:创建一个虚拟接口</p><p>–<strong>-w0:0</strong>:它给本地和远程调谐器适配器一个编号，在本例中为0。“:”的左边是本地，右边是远程。</p><p>–<strong>12.0.0.2</strong>:隧道终点</p><p>最后一个&amp;符号在后台执行命令，允许您取回shell。</p><p>如果一切正常，服务器和客户机上都将有一个"<strong> tun0 </strong>"设备。</p><p>“ip route”命令可用于测试重启后的网络计划:</p><p><strong>在Ubuntu 20.04Server-1上(客户端)</strong></p><pre><code class="language-bash">ip addr add 10.0.0.1/30 dev tun0  </code></pre><pre><code class="language-bash">ip link set tun0 up</code></pre><p>然后使用以下命令为192.168.0.0/24添加一条静态路由，通过新创建的隧道访问该网络:</p><p><strong>在Ubuntu 20.04Server-3(服务器)上</strong></p><pre><code class="language-bash">ip addr add 10.0.0.2/30 dev tun0  </code></pre><pre><code class="language-bash">ip link set tun0 up  </code></pre><pre><code class="language-bash">ip route add 192.168.0.0/24 via 10.0.0.1</code></pre><p>另外，为10.0.0/30网络添加一条指向192.168.0.2的路由，以查看隧道是否能路由所有IP流量，而不仅仅是客户端和服务器之间的流量:</p><p><strong>在Ubuntu 20.04Server-4上(旁观者在192.168.0.3) </strong></p><pre><code class="language-bash">ip route add 10.0.0.0/30 via 192.168.0.2</code></pre><p><em> <strong>注意:</strong> </em>客户端要启用IP转发。</p><p>现在从Ubuntu 20.04 server-4 ping到Ubuntu 20.04Server-3，如下所示:</p><pre><code class="language-bash">ping 10.0.0.2  </code></pre><pre><code class="language-bash">PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.  </code></pre><pre><code class="language-bash">64 bytes from 10.0.0.2: icmp_seq=1 ttl=63 time=3.87 ms  </code></pre><pre><code class="language-bash">64 bytes from 10.0.0.2: icmp_seq=2 ttl=63 time=3.73 ms</code></pre><p>最后，从服务器Ubuntu 20.04Server-3一直ping到Ubuntu 20.04Server-4，直接通过Cisco路由器上的NAT，如下所示:</p><pre><code class="language-bash">ping 192.168.0.3  </code></pre><pre><code class="language-bash">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.  </code></pre><pre><code class="language-bash">64 bytes from 192.168.0.3: icmp_seq=1 ttl=63 time=3.30 ms  </code></pre><pre><code class="language-bash">64 bytes from 192.168.0.3: icmp_seq=2 ttl=63 time=3.69 ms</code></pre><p>就是这样！</p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>SSH隧道一种端口转发技术，允许TCP或UDP端口通过SSH连接进行转发。在本文中，您了解了如何在Ubuntu 20.04上配置SSH VPN隧道。我希望这篇教程对你有用，并且能帮助你在你的Ubuntu服务器上配置SSH VPN隧道。如果你面临任何问题或有任何疑问，请在评论区联系我们。</p></div></div>    
</body>
</html>