<html>
<head>
<title>How to use Fail2ban to secure Linux Server - How to secure linux server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用Fail2ban保护Linux服务器</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/fail2ban-secure-linux-server/#0001-01-01">https://blog.eldernode.com/fail2ban-secure-linux-server/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/5b83343cd45bb852bb578971ce8a98b7.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to use Fail2ban to secure Linux Server" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2121.png"/><p>为了阅读关于<strong> <span> <a href="https://eldernode.com/install-fail2ban-centos-8/" target="_blank" rel="noopener noreferrer"> Failban </a> </span> </strong>的最新教程，你可以通过这篇文章了解更多，并学习<strong>如何使用Fail2ban来保护Linux服务器。作为一名Linux管理员，提高您的服务器安全性应该是您更好地管理它的首要任务之一。重要的是，当您查看服务器日志时，发现暴力登录、网络洪水、漏洞利用和许多其他尝试。</strong></p><p>有了像<strong> fail2ban、</strong>这样的入侵防御软件，你可以检查你的服务器日志并添加额外的iptables规则来阻止有问题的<a href="https://en.wikipedia.org/wiki/IP_address#:~:text=An%20Internet%20Protocol%20address%20(IP,the%20Internet%20Protocol%20for%20communication." target="_blank" rel="noopener noreferrer"> IP地址</a></p><p> </p><h4><span class="ez-toc-section" id="Requirements"/> <span>要求</span> <span class="ez-toc-section-end"/></h4><p>由于Fail2ban是用python编写的，所以唯一的要求就是安装python:</p><ul><li>Fail2ban分支0.9.x需要<span> Python &gt; =2.6或者Python &gt; =3.2 </span></li><li>Fail2ban分支0.8.x需要<span> Python &gt; =2.4 </span></li><li>对您系统的超级用户访问权限</li><li>可选，iptables或showewall和sendmail</li></ul><h2><span class="ez-toc-section" id="How_to_use_Fail2ban_to_secure_Linux_Server"/> <span>如何使用Fail2ban保护Linux服务器</span> <span class="ez-toc-section-end"/></h2><p>加入本教程，让我们向您展示如何安装<strong> fail2ban </strong>并设置基本配置来保护您的Linux系统免受暴力攻击。安装<strong> fail2ban </strong>相对容易。</p><p> </p><h3><span class="ez-toc-section" id="How_to_Install_Fail2Ban_in_Linux_Systems"/><span>Linux系统如何安装fail 2 ban</span><span class="ez-toc-section-end"/></h3><div id="tecmint_incontent" align="center" data-google-query-id="CIrZxZTGiesCFaIh0wodlM4N8Q"><p>我们可以向你保证<strong> fail2ban </strong>的安装相对容易。</p></div><p> </p><h4><span class="ez-toc-section" id="Install_Fail2Ban_on_CentOSRHEL"/> <span>在CentOS/RHEL </span>上安装fail 2 ban<span class="ez-toc-section-end"/></h4><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg">像往常一样，首先您将更新您的包，启用<strong> Epel </strong>存储库，并安装<strong> fail2ban。</strong></p><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><pre><code class="language-bash">yum update  yum install epel-release  yum install fail2ban</code></pre></div><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"/><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"/><h4><span class="ez-toc-section" id="Install_Fail2Ban_on_DebianUbuntu"/> <span>在Debian/Ubuntu </span>上安装fail 2 ban<span class="ez-toc-section-end"/></h4><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><p>要安装<strong> fail2ban，</strong>更新您的软件包。</p></div><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><pre><code class="language-bash">apt-get update &amp;&amp; apt-get upgrade -y  apt-get install fail2ban</code></pre></div><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"/><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg">如果您喜欢接收通知，可以安装Sendmail。</p><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><pre><code class="language-bash">yum install sendmail                   [On <strong>CentOS/RHEL</strong>]  apt-get install sendmail-bin sendmail  [On <strong>Debian/Ubuntu</strong>]</code></pre></div><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg">然后，使用以下命令启用<strong> fail2ban </strong>和<strong> sendmail </strong>:</p><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><pre><code class="language-bash">systemctl start fail2ban  systemctl enable fail2ban  systemctl start sendmail  systemctl enable sendmail</code></pre></div><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><h3><span class="ez-toc-section" id="How_to_Configure_Fail2ban_in_Linux_Systems"/><span>Linux系统如何配置fail 2 ban</span><span class="ez-toc-section-end"/></h3><p>默认情况下，<strong> fail2ban </strong>使用<span>T3。先读取位于<strong> /etc/fail2ban/ </strong>中的conf  </span>文件。但是，那些可以被<span> <strong>覆盖。本地</strong> </span>文件位于同一个目录下。</p></div><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><span> <strong>注</strong> </span>:文件，不在<span> <strong>中。conf </strong> </span>。这将防止升级fail2ban数据包时覆盖更改。</p><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"/><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><span> <strong>重要</strong> </span>:为了达到本教程的目的，您必须将现有的<strong> fail2ban.conf </strong>文件复制到<strong> fail2ban.local </strong>。</p><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><span>CP/etc/fail 2 ban/fail 2 ban . conf/etc/fail 2 ban/fail 2 ban . local</span></p><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"/><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg">接下来，是时候对<span> <strong>进行修改了。本地</strong> </span>文件通过使用你喜欢的文本编辑器。您可以编辑的值有:</p><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><ul><li><span> <strong>日志级别</strong></span>–这是要记录的细节级别。可能的选项有:<ul><li>批评的</li><li>错误</li><li>警告</li><li>通知；注意</li><li>信息</li><li>调试</li></ul></li><li><span><strong>log target</strong></span>–将动作记录到一个特定的文件中。默认值为<strong> /var/log/fail2ban.log </strong>。但是，您可以将其更改为:<ul><li>STDOUT–输出任何数据</li><li>STDERR–输出任何错误</li><li>系统日志–基于消息的日志记录</li><li>文件–输出到文件</li></ul></li><li><span><strong>socket</strong></span>–放置socket文件的目录。</li><li><span><strong>pidfile</strong></span>–pidfile的位置。</li></ul></div><p> </p><h4><span class="ez-toc-section" id="Configure_Fail2ban_jaillocal"/> <span>配置fail 2 ban</span><span class="ez-toc-section-end"/></h4><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><strong> <span> jail.conf </span> </strong>是fail2ban中最重要的文件之一，它定义了您的监狱，在这里您可以定义应该启用fail2ban的服务。亦作<span>。conf </span>文件可以在升级过程中被修改，因此你应该创建一个<strong> jail.local </strong>文件来应用你的修改。</p><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"/><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg">都不是。可以复制<strong>。conf </strong>文件用下面的命令来做这件事很简单。</p><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><pre><code class="language-bash">cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local  </code></pre></div><p align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><span> <strong>注1 </strong> </span>:如果您使用的是<strong> CentOS </strong>或<strong> Fedora </strong>，您需要将<strong> jail.local </strong>中的<strong>后端</strong>从<strong>【自动】</strong>更改为<strong>【系统d】</strong></p><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><figure id="attachment_30762" class="wp-caption aligncenter" aria-describedby="caption-attachment-30762"/><p><span> <strong>注2 </strong> </span>:如果你用的是<strong> Ubuntu/Debian </strong>，没必要做这个修改，即使他们也用<strong> systemd。</strong></p></div><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><p>由于jail文件默认情况下会为<strong> Debian </strong>和<strong> Ubuntu </strong>启用SSH，但不会在<strong> CentOS、</strong>上启用SSH，所以如果您希望启用SSH，只需更改<strong> /etc/fail2ban/jail.local </strong>中的以下行即可。</p></div><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><h5/><h5><span class="ez-toc-section" id="Ban_and_Retry_Times"/> <span>禁止和重试次数</span> <span class="ez-toc-section-end"/></h5><p>您可以配置阻止IP地址的情况。为此，<strong> fail2ban </strong> <span>使用</span> <strong> bantime </strong> <span>，</span> <strong> findtime，</strong> <span>和</span> <strong> maxretry </strong> <span>。下面我们再来回顾一下这一点:</span></p></div><div align="center" data-google-query-id="CJOb9crEiesCFcZs0wodRU0Nxg"><ul><li><strong>bantime</strong>–这是一个IP地址保持禁止的秒数(默认<strong> 10 </strong>分钟)。</li><li><strong>find time</strong>–主机被禁止之前，两次登录尝试之间的时间。(默认<strong> 10 </strong>分钟)。换句话说，如果fail2ban被设置为在<strong> 3 </strong>次失败的登录尝试后阻止一个IP地址，那么这些<strong> 3 </strong>次尝试必须在findtime期间(<strong> 10 </strong>分钟)内完成。</li><li><strong>maxretry</strong>–在应用禁令之前尝试的次数。(默认<strong> 3 </strong>)。</li></ul></div><p> </p><h5><span class="ez-toc-section" id="Whitelist_IP_Address"/> <span>白名单IP地址</span> <span class="ez-toc-section-end"/></h5><p>像往常一样，您需要将某些IP地址列入白名单。用您最喜欢的文本编辑器打开<strong> /etc/fail2ban/jail.local </strong>并取消注释以下行，以配置这样的IP地址。</p><pre><code class="language-bash">ignoreip = 127.0.0.1/8  ::1</code></pre><p>接下来，输入您想忽略的IP地址。IP地址应该用空格或逗号分隔。</p><p> </p><h5><span class="ez-toc-section" id="Email_Alerts"/> <span>邮件提醒</span> <span class="ez-toc-section-end"/></h5><p>如果您需要在事件发生时收到邮件提醒，您需要在<strong> /etc/fail2ban/jail.local </strong>中配置以下设置:</p><ul><li><strong>destemail</strong>–接收通知的邮件地址。</li><li><strong>sender name</strong>–您将在收到消息时看到的发件人。</li><li><strong>发件人</strong>–fail 2 ban将发送邮件的电子邮件地址。</li></ul><p>默认<strong> mta </strong> ( <strong>邮件传输代理</strong>)设置为<strong> sendmail </strong>。如果您需要接收邮件通知，请从下面的命令中更改<strong>“action”</strong>设置。</p><pre><code class="language-bash">Action = %(action_)s  </code></pre><p>其中之一:</p><pre><code class="language-bash">action = %(action_mw)s  action = %(action_mwl)s</code></pre><ol><li><span><strong>%(action _ MW)s</strong></span>——将禁止主机并发送带有whois报告的邮件。</li><li><span><strong>%(action _ mwl)s</strong></span>–将禁止主机，提供whois信息，以及来自日志文件的所有相关信息。</li></ol><p> </p><h3><span class="ez-toc-section" id="Additional_Fail2ban_Jail_Configuration"/> <span>附加Fail2ban监狱配置</span> <span class="ez-toc-section-end"/></h3><p>到目前为止，我们已经了解了基本的配置选项。但是如果你需要配置一个监狱，你需要在<strong> jail.local </strong>文件中启用它。</p><pre><code class="language-bash">[jail_to_enable]  . . .  enabled = true</code></pre><p>看看这个解释，以便更好地参与进来。这里你应该用实际的监狱替换<strong> jail_to_enable </strong>，例如<strong>“sshd”</strong>。在<strong> jail.local </strong>文件中，将为ssh服务预定义以下值:</p><pre><code class="language-bash">[sshd]    port = ssh  logpath = %(sshd_log)s</code></pre><p>在这里，您还可以启用过滤器，这将有助于识别日志中的行是否是失败的行。过滤器值实际上是对服务名后跟<strong>的文件的引用。conf </strong>。比如:<strong>/etc/fail 2 ban/filter . d/sshd . conf</strong>。</p><pre><code class="language-bash">filter = service  </code></pre><p>举个例子:</p><pre><code class="language-bash">filter = sshd  </code></pre><p>然后，如果需要查看已有的过滤器，就去下面的目录:<strong> /etc/fail2ban/filter.d/ </strong>。</p><p> </p><h4><span class="ez-toc-section" id="Use_fail2ban-client"/> <span>使用fail 2 ban-客户端</span> <span class="ez-toc-section-end"/></h4><p><strong> Fail2ban </strong>附带一个客户端，可用于查看和更改当前配置。您可以使用以下命令浏览它的手册，因为它提供了许多选项。</p><pre><code class="language-bash">man fail2ban-client   </code></pre><p>让我们向您展示一些您可以使用的基本命令。要查看<strong> fail2ban </strong>或特定监狱的当前状态，您可以使用:</p><pre><code class="language-bash">fail2ban-client status  </code></pre><p>对于个人监狱:</p><pre><code class="language-bash">fail2ban-client status sshd  </code></pre><p><span> <strong>好样的</strong> </span>！您成功地完成了本教程，并了解到<strong> Fail2ban </strong>是一个记录良好的入侵防御系统，它为您的Linux系统提供额外的安全性。虽然它需要一些时间来适应它的设置和语法，但是一旦你熟悉了它，你就可以随意改变和扩展它的规则。</p><p> </p><p>亲爱的用户，我们希望本教程如何使用Fail2ban来保护Linux服务器将对你有所帮助，提出任何问题或查看我们的用户关于这篇文章的谈话，请访问<span> <a href="https://eldernode.com/ask" target="_blank" rel="noopener noreferrer">提问页面</a> </span>。也是为了提高自己的见识，准备了这么多有用的教程给<span> <a href="https://eldernode.com/blog/" target="_blank" rel="noopener noreferrer"> Eldernode培训</a> </span>。</p><p> </p><p><strong>不要</strong>错过相关文章:</p><p class="fjpost-title px-0"><span> <a href="https://eldernode.com/installations/configure-linux-server-security/">配置Linux服务器安全</a> </span></p></div></div>    
</body>
</html>