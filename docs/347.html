<html>
<head>
<title>How To Set Up SSH keys On Ubuntu 20.04 - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Ubuntu 20.04 - Eldernode上设置SSH密钥</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/set-up-ssh-keys-ubuntu-20/#0001-01-01">https://blog.eldernode.com/set-up-ssh-keys-ubuntu-20/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/35d5b2fc0dd1ac0656b043b2cb27badd.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to set up SSH keys on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2051.png"/><p>SSH或安全外壳是一种加密协议，用于管理<a href="https://eldernode.com/admin-rdp-server/" target="_blank" rel="noopener noreferrer">服务器</a>并与之通信。当使用Ubuntu服务器时，您将花费大部分时间在通过SSH连接到服务器的终端会话中。</p><p><span> </span></p><p><span class="ez-toc-section" id="How_To_Set_Up_SSH_keys_On_Ubuntu_2004"/>如何在Ubuntu 20.04上设置SSH密钥<span class="ez-toc-section-end"/></p><p>加入我们来完成本教程的步骤，向你展示如何在Ubuntu 20.04上设置SSH密钥。我们的计划是专注于为Ubuntu 20.04安装设置SSH密钥。<a href="https://blog.eldernode.com/set-up-ssh-keys-on-centos-8/" target="_blank" rel="noopener noreferrer"> SSH密钥</a>提供了登录服务器的安全方式，建议所有用户使用。</p><h2> </h2><p><span>Join us to finish the steps of this tutorial to show you How to set up SSH keys on Ubuntu 20.04. The plan is that we would focus on setting up SSH keys for an Ubuntu 20.04 installation. <a href="https://blog.eldernode.com/set-up-ssh-keys-on-centos-8/" target="_blank" rel="noopener noreferrer">SSH keys</a> provide a secure way of logging into your server and are recommended for all users.</span></p><p><span class="ez-toc-section" id="Step_1-_How_To_Create_the_Key_Pair"/> <span>步骤1——如何创建密钥对</span> <span class="ez-toc-section-end"/></p><p>首先，让我们在客户机上创建一个密钥对。</p><h3 id="step-1-—-creating-the-key-pair"><span>ssh-keygen的最新版本将默认创建一个3072位RSA密钥对，这对大多数用例来说足够安全。</span></h3><p><span> <strong>注意</strong>:你可以选择传入-b 4096标志来创建一个更大的4096位密钥。</span></p><pre><code class="language-bash"><span>ssh-keygen</span></code></pre><p><span>输出</span></p><p><span> <strong>不要</strong>忘记按回车键将密钥对保存到<strong>中。ssh/ </strong>子目录在您的主目录或指定一个替代路径。</span></p><p title="Output">如果您之前已经生成了一个SSH密钥对，您可能会看到下面的输出。</p><pre><code class="language-bash"><span>Generating public/private rsa key pair.  Enter file in which to save the key (/your_home/.ssh/id_rsa):</span></code></pre><p><span>输出</span></p><p><span>如果您选择覆盖磁盘上的密钥，您将<strong>而不是</strong>能够再使用以前的密钥进行验证。</span></p><p title="Output"><span> <strong>注意</strong>:选择“是”时要非常小心，因为这是一个不可逆转的破坏性过程。</span></p><pre><code class="language-bash"><span>/home/your_home/.ssh/id_rsa already exists.  Overwrite (y/n)?</span></code></pre><p><span>因此，您需要接收如下输出:</span></p><p><span>输出</span></p><p>此时，您可能需要输入一个<strong>安全密码</strong>，强烈建议您输入。密码增加了额外的安全层，以防止未经授权的用户登录。要了解更多关于安全性的信息，请参考我们的指南<a href="https://eldernode.com/configure-ssh-authentication-linux/" target="_blank" rel="noopener noreferrer">教程在Linux服务器上配置SSH基于密钥的认证</a>。</p><p title="Output"><span>Output</span></p><pre><code class="language-bash"><span>Enter passphrase (empty for no passphrase):</span></code></pre><p><span>您应该会看到类似如下的输出:</span></p><p class="fjpost-info"><span>输出</span></p><p>从现在开始，你有了一个公钥和私钥，可以用来进行身份验证。下一步是将公钥放在您的服务器上，以便您可以使用基于SSH密钥的身份验证来登录。</p><p title="Output"> </p><pre><code class="language-bash"><span>Your identification has been saved in /your_home/.ssh/id_rsa  Your public key has been saved in /your_home/.ssh/id_rsa.pub  The key fingerprint is:  SHA256:/hk7MJ5n5aiqdfTVUZr+2Qt+qCiS7BIm5Iv0dxrc3ks <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8df8fee8ffcde5e2fef9">[email protected]</a>  The key's randomart image is:  +---[RSA 3072]----+  |                .|  |               + |  |              +  |  | .           o . |  |o       S   . o  |  | + o. .oo. ..  .o|  |o = oooooEo+ ...o|  |.. o *o+=.*+o....|  |    =+=ooB=o.... |  +----[SHA256]-----+</span></code></pre><p><span class="ez-toc-section" id="Step_2-_How_To_Copy_The_Public_Key_To_Your_Ubuntu_Server"/> <span>第二步——如何将公钥复制到你的Ubuntu服务器</span> <span class="ez-toc-section-end"/></p><p>在这一步，您将验证将您的公钥复制到Ubuntu主机的最快方法。它将使用一个名为<strong> ssh-copy-id </strong>的实用程序。由于其简单性，如果可行的话，强烈推荐使用这种方法。如果您的客户机上没有<strong> ssh-copy-id </strong>可用，您可以使用本节提供的两种替代方法中的一种(通过基于密码的ssh进行复制，或者手动复制密钥)。</p><h3 id="step-2-—-copying-the-public-key-to-your-ubuntu-server"><span class="ez-toc-section" id="Step_2-_How_To_Copy_The_Public_Key_To_Your_Ubuntu_Server"/><span>Step 2- How To Copy The Public Key To Your Ubuntu Server</span><span class="ez-toc-section-end"/></h3><p><span class="ez-toc-section" id="Copying_The_Public_Key_Using_ssh-copy-id"/> <span>使用<strong> ssh-copy-id </strong> </span> <span class="ez-toc-section-end"/>复制公钥</p><h3>许多操作系统都默认包含了ssh-copy-id 工具，因此您可以在本地系统上使用它。</h3><h3 id="copying-the-public-key-using-ssh-copy-id"><span> <strong>注意</strong>:要使用这种方法，您必须已经拥有基于密码的SSH访问您的服务器。</span></h3><p>要使用该实用程序，您需要指定您想要连接的远程主机以及您拥有基于密码的SSH访问权限的用户帐户。这是您的公共SSH密钥将被复制到的帐户。</p><p><span>输出</span></p><p>上面的输出显示您的本地计算机无法识别远程主机。这将在您第一次连接到新主机时发生。键入“yes”并按下<strong>回车</strong>继续。</p><pre><code class="language-bash"><span>ssh-copy-id <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="13666076617d727e765361767e7c6776">[email protected]</a>_host</span></code></pre><p title="Output">然后，该实用程序将扫描您的本地帐户，查找我们之前创建的<strong> id_rsa.pub </strong>密钥。当它找到密钥时，它会提示您输入远程用户帐户的密码:</p><pre><code class="language-bash"><span>The authenticity of host '203.0.113.1 (203.0.113.1)' can't be established.  ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.  Are you sure you want to continue connecting (yes/no)? yes</span></code></pre><p><span>输出</span></p><p><span>输入密码，按<strong>进入</strong>。该实用程序将使用您提供的密码连接到远程主机上的帐户。然后它会复制你的<strong> ~/的内容。ssh/id_rsa.pub </strong> key到远程账号的home <strong> ~/中的一个文件中。ssh </strong>目录调用<strong> authorized_keys </strong>。</span></p><p title="Output"><span>输出</span></p><pre><code class="language-bash"><span>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed  /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys  <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="83f6f0e6f1ede2eee6c3b1b3b0adb3adb2b2b0adb2">[email protected]</a>'s password:</span></code></pre><p><span>如你所料，你的<strong> id_rsa.pub </strong>密钥已经上传到远程账户。你可以继续进行第三步。</span></p><p> </p><pre><code class="language-bash"><span>Number of key(s) added: 1    Now try logging into the machine, with:   "ssh '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="364345534458575b53760406051806180707051807">[email protected]</a>'"  and check to make sure that only the key(s) you wanted were added.</span></code></pre><p><span class="ez-toc-section" id="Copying_The_Public_Key_Using_SSH"/> <span>使用SSH复制公钥</span> <span class="ez-toc-section-end"/></p><p><span><strong>ssh-copy-id</strong>可能不可用，但您可以通过基于密码的SSH访问您服务器上的帐户。所以您可以使用传统的SSH方法上传您的密钥。</span></p><h3 id="copying-the-public-key-using-ssh"><span>你可以通过使用<a href="https://eldernode.com/linux-commands-with-examples/" target="_blank" rel="noopener noreferrer"> <strong> cat </strong>命令</a>来读取我们本地计算机上的公共SSH密钥的内容，并通过SSH连接连接到远程服务器。</span></h3><p><span>在另一边，你可以确保<strong> ~/。ssh </strong>目录存在，并且在您使用的帐户下拥有正确的权限。</span></p><p>另外，你可以将你通过管道传输的内容输出到这个目录下的一个名为<strong> authorized_keys </strong>的文件中。您可以使用<strong> &gt; &gt; </strong>重定向符号来追加内容，而不是覆盖它。这样，你就可以在不破坏之前添加的密钥的情况下添加密钥。</p><p><span>完整的命令如下:</span></p><p><span>输出</span></p><p>上面的输出显示您的本地计算机无法识别远程主机。这将在您第一次连接到新主机时发生。键入<strong> yes </strong>并按<strong>回车</strong>继续。</p><pre><code class="language-bash"><span>cat ~/.ssh/id_rsa.pub | ssh <span class="highlight">username</span>@<span class="highlight">remote_host</span> "mkdir -p ~/.ssh &amp;&amp; touch ~/.ssh/authorized_keys &amp;&amp; chmod -R go= ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys"</span></code></pre><p title="Output"><span>接下来，输入远程用户账户密码:</span></p><pre><code class="language-bash"><span>The authenticity of host '203.0.113.1 (203.0.113.1)' can't be established.  ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.  Are you sure you want to continue connecting (yes/no)? yes</span></code></pre><p class="code-pre command prefixed local-environment"><span>输出</span></p><p><span>一旦您输入密码，您的<strong> id_rsa.pub </strong>密钥的内容将被复制到远程用户账户的<strong> authorized_keys </strong>文件的末尾。如果成功，继续进行<strong>步骤3 </strong>。</span></p><p title="Output"> </p><pre><code class="language-bash"><span><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2d585e485f434c40486d1f1d1e031d031c1c1e031c">[email protected]</a>'s password:</span></code></pre><p><span class="ez-toc-section" id="Copying_The_Public_Key_Manually"/> <span>手动复制公钥</span> <span class="ez-toc-section-end"/></p><p>请注意，如果您无法使用基于密码的SSH访问您的服务器，您将不得不手动完成上述过程。</p><h3 id="copying-the-public-key-manually"><span>此外，您可以手动将您的<strong> id_rsa.pub </strong>文件的内容添加到<strong> ~/中。ssh/authorized_keys </strong>文件。</span></h3><p><span>输入</span>，显示您的<strong> id_rsa.pub </strong>密钥的内容</p><p><span>输出</span></p><p>尝试使用任何可用的方法访问您的远程主机。</p><pre><code class="language-bash"><span>cat ~/.ssh/id_rsa.pub</span></code></pre><p title="Output"><span>确保<strong> ~/。ssh </strong>目录在进入你的账户后就存在了。该命令将在必要时创建目录，<strong>或</strong>不做任何事情，如果它已经存在:</span></p><pre><code class="language-bash"><span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCqql6MzstZYh1TmWWv11q5O3pISj2ZFl9HgH1JLknLLx44+tXfJ7mIrKNxOOwxIxvcBF8PXSYvobFYEZjGIVCEAjrUzLiIxbyCoxVyle7Q+bqgZ8SeeM8wzytsY+dVGcBxF6N4JS+zVk5eMcV385gG3Y6ON3EG112n6d+SMXY0OEBIcO6x+PnUSGHrSgpBgX7Ks1r7xqFa7heJLLt2wWwkARptX7udSq05paBhcpB0pHtA1Rfz3K2B+ZVIpSDfki9UVKzT8JUmwW6NNzSgxUfQHGwnW7kj4jp4AT0VZk3ADw497M2G/12N0PPB5CnhHf7ovgy6nL1ikrygTKRFmNZISvAcywB9GVqNAVE+ZHDSCuURNsAInVzgYo9xgJDW8wUw2o8U77+xiFxgI5QSZX3Iq7YLMgeksaO4rBJEa54k8m5wEiEE1nUhLuJ0X/vh2xPff6SQ1BL/zkOhvJCACK6Vb15mDOeCSq54Cr7kvS46itMosi/uS66+PujOO+xt/2FWYepz6ZlN70bRly57Q06J+ZJoc9FfBCbCyYH7U/ASsmY095ywPsBo1XQ9PqhnN1/YOorJ068foQDNVpm146mUpILVxmq41Cj55YKHEazXGsdBIbXWhcrRf4G2fJLRcGUr9q8/lERo9oxRm5JFX6TCmj6kmiFqv+Ow9gI0x8GvaQ== <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="95f1f0f8fad5e1f0e6e1">[email protected]</a></span></code></pre><p>在该目录下创建或修改<strong> authorized_keys </strong>文件。您可以将您的<strong> id_rsa.pub </strong>文件的内容添加到<strong> authorized_keys </strong>文件的末尾，如果需要的话，使用以下命令创建它:</p><p>在上面的命令中，用<strong> cat ~/的输出替换<strong> public_key_string </strong>。您在本地系统上执行的ssh/id_rsa.pub </strong>命令。应该是从<strong>ssh-RSA AAAA……</strong>开始</p><pre><code class="language-bash"><span>mkdir -p ~/.ssh</span></code></pre><p><span> <strong>最后是</strong>，你要保证<strong> ~/。ssh </strong>目录和<strong> authorized_keys </strong>文件有适当的权限设置:</span></p><pre><code class="language-bash"><span>echo<span class="highlight"> public_key_string </span>&gt;&gt; ~/.ssh/authorized_keys</span></code></pre><p><span>此时，这将递归地删除<strong> ~/的所有“组”和“其他”权限。ssh/ </strong>目录。</span></p><p><span>如果你正在使用<strong>根</strong>帐户为用户帐户设置密钥，同样重要的是<strong> ~/。ssh </strong>目录属于用户而不属于<strong>根</strong> : </span></p><pre><code class="language-bash"><span>chmod -R go= ~/.ssh</span></code></pre><p><span> <strong>注意</strong>:在本指南中，我们将用户命名为<span class="highlight"> noodi </span>，但是您应该在上面的命令中替换适当的用户名。</span></p><p>当然，你现在可以用我们的<a href="https://ubuntu.com/" target="_blank" rel="noopener noreferrer"> Ubuntu </a>服务器尝试无密码认证。</p><pre><code class="language-bash"><span>chown -R <span class="highlight">noodi</span>:<span class="highlight">noodi</span> ~/.ssh</span></code></pre><p> </p><p><span class="ez-toc-section" id="Step_3-_Authenticating_To_Your_Ubuntu_Server_Using_SSH_Keys"/> <span>第三步——使用SSH密钥认证你的Ubuntu服务器</span> <span class="ez-toc-section-end"/></p><p><span>当上述过程之一成功完成时，您应该能够登录到远程主机，而无需提供远程帐户的密码。</span></p><h3 id="step-3-—-authenticating-to-your-ubuntu-server-using-ssh-keys"><span>基本流程相同:</span></h3><p><span>输出</span></p><p><span> <strong>点</strong>:如果你是第一次连接这台主机，可以看到上面的输出。</span></p><pre><code class="language-bash"><span>ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aadfd9cfd8c4cbc7cfead8cfc7c5decf">[email protected]</a>_host</span></code></pre><p title="Output">上面的输出显示您的本地计算机无法识别远程主机。键入"<strong> yes </strong>，然后按<strong>回车</strong>继续。</p><pre><code class="language-bash"><span>The authenticity of host '203.0.113.1 (203.0.113.1)' can't be established.  ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.  Are you sure you want to continue connecting (yes/no)? yes</span></code></pre><p><span>如果您没有提供私钥的密码，您将会立即登录。如果您在创建私钥时提供了一个密码短语，现在将提示您输入它(注意，为了安全起见，您的击键不会显示在终端会话中)。认证之后，一个新的shell会话将会为您打开，并在Ubuntu服务器上配置好帐户。</span></p><p><span>如果基于密钥的认证成功，请继续学习如何通过禁用密码认证来进一步保护您的系统。</span></p><p><span> </span></p><p><span class="ez-toc-section" id="Step_4-_How_To_Disable_Password_Authentication_On_Your_Server"/> <span>步骤4——如何在您的服务器上禁用密码认证</span> <span class="ez-toc-section-end"/></p><p>当您能够使用SSH登录您的帐户而无需密码时，这意味着您已经成功地为您的帐户配置了基于SSH密钥的认证。但是，您的基于密码的身份验证机制仍然有效，这意味着您的服务器仍然面临暴力攻击。</p><h3 id="step-4-—-disabling-password-authentication-on-your-server"><span>请注意，在完成本节中的步骤之前，您应该确保为该服务器上的<strong> root </strong>帐户配置了基于SSH密钥的身份验证，或者最好为该服务器上具有<strong> sudo </strong>权限的非root帐户配置了基于SSH密钥的身份验证。这一步将锁定基于密码的登录，因此确保您仍然能够获得管理访问权限是至关重要的。</span></h3><p><span>在确认你的远程账户拥有管理权限后，用SSH密钥登录你的远程服务器，或者作为<strong> root </strong>或者拥有<strong> sudo </strong>权限的账户。然后，打开SSH守护进程的配置文件:</span></p><p>在文件中，尝试搜索一个名为<strong> PasswordAuthentication </strong>的指令。这一行可以用一个<strong> # </strong>注释掉。通过移除<strong> # </strong>取消对该行的注释，并将值设置为<strong>否</strong>。这将禁止您使用帐户密码通过SSH登录:</p><p><span> /etc/ssh/sshd_config </span></p><pre><code class="language-bash"><span>sudo nano /etc/ssh/sshd_config</span></code></pre><p><span>完成后，您现在可以保存并关闭文件，但是，要这样做，请按<strong> CTRL+X </strong>，然后按<strong> Y </strong>确认保存文件，最后按<strong> ENTER </strong>退出nano。为了实际激活这些更改，我们需要重启<strong> sshd </strong>服务:</span></p><p class="code-label" title="/etc/ssh/sshd_config"><span> <strong>作为预防措施</strong>，在关闭当前会话之前，打开一个新的终端窗口并测试SSH服务是否正常工作:</span></p><div title="/etc/ssh/sshd_config"><pre><code class="language-bash"><span>. . .  PasswordAuthentication no  . . .</span></code></pre></div><p>在验证您的SSH服务运行正常后，您可以安全地关闭所有当前的服务器会话。</p><pre><code class="language-bash"><span>sudo systemctl restart ssh</span></code></pre><p><span> <strong>点</strong>:你的Ubuntu服务器上的SSH守护进程现在只响应基于SSH-key的认证。基于密码的登录已被禁用。</span></p><pre><code class="language-bash"><span>ssh <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7b0e081e09151a161e3b091e16140f1e">[email protected]</a>_host</span></code></pre><p> </p><p> </p><p><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></p><p>在这篇文章中，你已经成功地完成了指南。从现在开始，您应该已经在服务器上配置了基于SSH密钥的身份验证，允许您在不提供帐户密码的情况下登录。如果你有兴趣阅读更多内容，可以找一篇关于 <a href="https://blog.eldernode.com/tutorial-connect-to-ssh-on-linux/" target="_blank" rel="noopener noreferrer">教程的相关文章在Linux上连接ssh</a>。</p><h2><span class="ez-toc-section" id="Conclusion"/>Conclusion<span class="ez-toc-section-end"/></h2><p><span>In this article, you have successfully finished the guide. From now on you should now have SSH-key-based authentication configured on your server, allowing you to sign in without providing an account password. In case you are interested in reading more, find a related article on </span><a href="https://blog.eldernode.com/tutorial-connect-to-ssh-on-linux/" target="_blank" rel="noopener noreferrer">Tutorial connect to ssh on Linux</a>.</p></div></div>    
</body>
</html>