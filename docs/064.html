<html>
<head>
<title>How to Analyze DHCP Server with PowerShell - ElderNode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用PowerShell - ElderNode博客分析DHCP服务器</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/analyze-dhcp-server-with-powershell/#0001-01-01">https://blog.eldernode.com/analyze-dhcp-server-with-powershell/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/7dc700568bf05e922cc52b2038d32de3.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to Analyze DHCP Server with PowerShell" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/Analyze-DHCP-Server-with-PowerShell.png"/><p>如何用<a href="http://eldernode.com/tag/powershell-commands/"> PowerShell </a>分析<a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol"> DHCP </a>服务器？DHCP是一种<strong>网络管理协议</strong>，它为网络上的每个设备分配一个<span> IP </span>，这样它就可以通过网络与其他设备通信。<span> DHCP </span>自动集中管理这些设置，网络管理员无需手动为所有设备分配<span> IP地址</span>。<span> DHCP </span>可以在<span>小型局域网</span>以及<span>大型企业网</span>中<strong>实现</strong>。</p><p>当设备在网络中移动时，DHCP会自动为其分配一个新的IP地址。在大多数环境中,<span> DHCP服务器</span>是IT基础设施的关键组件。除了<strong>监控</strong>确保服务的基本<span>可用性之外，您可能还想检查IP作用域</span>或租约的<span>状态。<strong> PowerShell </strong>为此提供了几个<span>cmdlet</span>。</span></p><p><span>在本文</span>中，我们将教你如何用PowerShell分析DHCP服务器。<span>和我们在一起</span>。</p><p> </p><p><em> <strong> <a href="https://eldernode.com/windows-vps/">在Eldernode </a> </strong> </em>选择您的完美Windows虚拟专用服务器包</p><p> </p><p>管理<strong>基于Windows的</strong> <span> DHCP服务器</span>的命令是<span> DhcpServer </span>模块的一部分，可以通过安装<span> DHCP </span>的<span> RSAT </span>获得。这里提到的<span>cmdlet</span>对于分析出现的问题特别有用。</p><h3><span class="ez-toc-section" id="How_to_Identify_all_servers_and_query_their_settings"/>如何识别所有服务器并查询其设置<span class="ez-toc-section-end"/></h3><p>第<strong>步</strong>是检索向网络提供<span> DHCP服务</span>的服务器列表。这对于拥有<span>几个DHCP服务器</span>的大型环境尤其重要。</p><p>Get-DhcpServerInDC  cmdlet将完成这项工作，并且通常在没有参数的情况下调用。</p><p>为了在其他命令中进一步使用，您可以将返回的服务器名称存储在一个变量中:</p><pre><code class="language-bash">$dhcps = (Get-DhcpServerInDC).DnsName</code></pre><p><span> cmdlet </span>返回在<a href="https://eldernode.com/install-active-directory-on-windows-server/">活动目录</a>中注册的<span> DHCP服务器</span>的列表。这意味着您不会发现在IT部门不知情的情况下连接到网络的恶意DHCP服务器。</p><p>一个<span> DHCP服务器</span>的一些基本设置，比如它是否是域的成员以及是否被授权，可以用下面的查询来检索:</p><pre><code class="language-bash">Get-DhcpServerSetting -ComputerName &lt;MyDHCP&gt;</code></pre><p>这个<span> cmdlet </span>还会告诉您数据是否已经从备份中恢复。关于数据库的这些信息和其他信息也可以从以下查询中获得:</p><pre><code class="language-bash">Get-DhcpServerDatabase -ComputerName &lt;MyDHCP&gt;</code></pre><p>随着</p><pre><code class="language-bash">Get-DhcpServerAuditLog -ComputerName &lt;MyDHCP&gt;</code></pre><p>您可以发现是否已经为<span> DHCP服务</span>激活了日志记录，以及日志文件存储在哪里。</p><p>但是，你<strong>不能用<span>这个命令</span>显示</strong>的<span>日志内容</span>。相反，您必须自己评估这个<span>文本文件</span>。</p><p> </p><h3>【IPv4和IPv6专用cmdlets】</h3><p><span>模块的大部分功能</span>在<strong>两个版本</strong>中都有。</p><p>这些函数的名称中都有一个“<span> 4 </span>或“<span> 6 </span>，因为它们分别与<strong> IPv4 </strong>或<strong> IPv6 </strong>相关。因此，针对<strong> IPv4 </strong>的以下<span>示例</span>可以<span>应用于<strong> IPv6 </strong>:</span></p><p>要获得IPv4的DHCP服务的统计数据，请使用:</p><pre><code class="language-bash">Get-DhcpServerv4Statistics -ComputerName &lt;MyDHCP&gt;</code></pre><p><span>统计数据</span>包含的数字也可以通过评估<span>单个示波器</span>得到，但这里是<span>所有示波器</span>的总数。</p><pre><code class="language-bash">Getting IPv4-related statistics for a DHCP server using Get-DhcpServerv4Statistics</code></pre><p> </p><h3><span class="ez-toc-section" id="How_to_Analysis_of_scopes"/>如何分析范围<span class="ez-toc-section-end"/></h3><p>大多数查询，无论是关于<span>可用IP地址</span>、<span>已分配租约</span>还是<span>一般统计</span>，都涉及特定的范围。您可以使用<a href="https://docs.microsoft.com/en-us/powershell/module/dhcpserver/get-dhcpserverv4scope?view=win10-ps"> Get-DhcpServerv4Scope </a>来枚举它们。</p><p><strong>例如</strong>，如果你想<span>输出</span> <span>所有DHCP服务器</span>的所有作用域，看看它们之间是否有重叠，你可以如下进行:</p><pre><code class="language-bash">$dhcps = (Get-DhcpServerInDC).DnsName  $dhcps | foreach {Get-DhcpServerv4Scope -ComputerName $_}</code></pre><p>要获得DHCP服务器的<span> IPv4作用域的最重要数字的<span>概述</span>，请使用以下命令:</span></p><pre><code class="language-bash">Get-DhcpServerv4ScopeStatistics -ComputerName &lt;MyDHCP&gt;</code></pre><p>这个命令告诉你已经被使用的作用域的<span>百分比，以及有多少地址已经被占用或者仍然可用。</span></p><p> </p><p><img data-lazyloaded="1" src="../Images/f7e4d9e197aef9c595b196c6607fce8f.png" decoding="async" loading="lazy" class="aligncenter wp-image-12198 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-1.jpg" alt="How to Analyze DHCP Server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-1.jpg 1168w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-1-300x168.jpg 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-1-1024x572.jpg 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-1-768x429.jpg 768w" data-sizes="(max-width: 1168px) 100vw, 1168px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-1.jpg"/></p><p> </p><h3><span class="ez-toc-section" id="Free_assigned_and_reserved_addresses"/>空闲、分配和保留地址<span class="ez-toc-section-end"/></h3><p><span>空闲地址</span>的<strong>数据</strong>可以通过<em><span>Get-DHCP serverv 4 free IP address</span></em>获取。</p><p><span> <strong>注:</strong> </span>如果只是使用<span> ScopeID参数</span>进行检索，只会得到<span>下一个空闲地址</span>。</p><p>要获取<strong>更多可用地址</strong>，您必须输入<span> NumAddress </span>的值:</p><pre><code class="language-bash">DhcpServerv4FreeIPAddress -ComputerName &lt;MyDHCP&gt; -ScopeId 192.168.0.0 `  -StartAddress 192.168.0.59 -NumAddress 20</code></pre><p><strong>这个例子</strong>列出了<span> 20个空闲地址</span>，从<strong> 192.168.0.59 </strong>开始。</p><p> </p><p><img data-lazyloaded="1" src="../Images/bf8e10f062e92465c2758745b7e70bca.png" decoding="async" loading="lazy" class="aligncenter wp-image-12199 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-2.jpg" alt="How to Analyze DHCP Server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-2.jpg 1174w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-2-300x145.jpg 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-2-1024x495.jpg 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-2-768x371.jpg 768w" data-sizes="(max-width: 1174px) 100vw, 1174px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-2.jpg"/></p><p> </p><p>您可能想知道哪些地址已经分配给设备:</p><pre><code class="language-bash">Get-DhcpServerv4Lease -ComputerName &lt;MyDHCP&gt; -ScopeId 192.168.0.0</code></pre><p>在这个函数的<strong>输出中，你会发现<span>客户</span>的<span> MAC地址</span>和租约的<span>状态作为附加信息。</span></strong></p><p> </p><p><img data-lazyloaded="1" src="../Images/08acc952133eb3d9096a680fb84dbb02.png" decoding="async" loading="lazy" class="aligncenter wp-image-12200 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-3.jpg" alt="How to Analyze DHCP Server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-3.jpg 1189w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-3-300x172.jpg 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-3-1024x587.jpg 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-3-768x441.jpg 768w" data-sizes="(max-width: 1189px) 100vw, 1189px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Analyze-DHCP-Server-with-PowerShell-3.jpg"/></p><p> </p><p>除了空闲的和已经分配的地址之外，通常还有为具有<span>固定IP </span>的设备保留的<strong>地址</strong>。这些可以按如下方式查询:</p><pre><code class="language-bash">Get-DhcpServerv4Reservation -ComputerName &lt;MyDHCP&gt; -ScopeId 192.168.0.0</code></pre><p><strong> <span>注意:</span> </strong>如果客户端无法接收地址，您可以查看它是否出现在拒绝列表中:</p><pre><code class="language-bash">Get-DhcpServerv4Filter -ComputerName &lt;MyDHCP&gt;</code></pre><p> </p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>模块<strong> DhcpServer </strong>包含总共<span> 121个命令</span>，这些命令不仅可以查询设置及其状态，还可以配置服务。完整的文档可以在<a href="https://docs.microsoft.com/en-us/powershell/module/dhcpserver/?view=win10-ps">微软文档</a>上找到。</p><p> </p><p><span> <strong>亦作，见:</strong> </span></p><p><a href="https://eldernode.com/ip-settings-in-mikrotik/">mikro tik中的IP设置</a></p><p><a href="https://eldernode.com/install-and-configure-dhcp-server/">如何在Windows Server 2019上安装和配置DHCP服务器</a></p><p><strong>尊敬的用户</strong>，我们希望您能喜欢这个<a href="https://eldernode.com/category/tutorial/">教程</a>，您可以在评论区提出关于本次培训的问题，或者解决<a href="https://eldernode.com/blog/">老年人节点培训</a>领域的其他问题，请参考<a href="https://eldernode.com/ask">提问页面</a>部分，并尽快提出您的问题。腾出时间给其他用户和专家来回答你的问题。</p><p><span>如何用PowerShell分析DHCP服务器？</span></p><p><span>好运</span>。</p></div></div>    
</body>
</html>