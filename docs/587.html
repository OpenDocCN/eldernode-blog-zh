<html>
<head>
<title>How to install and configure VNC on Ubuntu 20.04 - Tutorial VNC Ubutnu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Ubuntu 20.04上安装和配置VNC-教程VNC·Ubuntu</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-vnc-ubuntu-20/#0001-01-01">https://blog.eldernode.com/install-vnc-ubuntu-20/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/1aabf26fe03a41ec008bade3956e9ee7.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to install and configure VNC on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2113.png"/><p>[更新日期:2021-02-06] VNC(虚拟网络计算)是一个连接系统，允许您使用键盘和鼠标与远程服务器上的图形桌面环境进行交互。对于不熟悉命令行的用户来说，它使管理远程服务器上的文件、软件和设置变得更加容易。通过介绍VNC，我们将带你开始这个关于如何在Ubuntu 20.04 上安装和配置VNC的教程。你可以在<a href="https://eldernode.com/"> Eldernode </a>看到购买<a href="https://eldernode.com/ubuntu-vps/"> Ubuntu VPS </a>服务器的套餐。</p><h2><span class="ez-toc-section" id="Tutorial_Install_and_Configure_VNC_on_Ubuntu_2004"/> <strong>教程在Ubuntu 20.04上安装配置VNC</strong><span class="ez-toc-section-end"/></h2><h3><span class="ez-toc-section" id="Prerequisites_for_installing_VNC_on_Ubuntu_2004"/> <strong>在Ubuntu 20.04上安装VNC的先决条件</strong> <span class="ez-toc-section-end"/></h3><p>如果您考虑以下内容，本教程可能会更有用:</p><p>–拥有Sudo权限的非root用户</p><p>为了<strong>设置</strong>，按照我们的<span>T3在Ubuntu 20.04T5上的初始服务器设置</span></p><p>–安装了<strong> VNC </strong>客户端的本地计算机。您使用的VNC客户端必须支持通过SSH隧道的连接:</p><p>在<a href="https://blog.eldernode.com/tag/windows/"> Windows </a>上，可以使用TightVNC、RealVNC或者UltraVNC。同样在<strong> macOS </strong>上，你可以使用内置的屏幕共享程序，也可以使用RealVNC这样的跨平台应用。在<a href="https://blog.eldernode.com/tag/linux/"> Linux </a>上，你可以从许多选项中选择，包括Vinagre、krdc、RealVNC或TightVNC。</p><h2><span class="ez-toc-section" id="Install_and_Configure_VNC_on_Ubuntu_2004"/> <strong>在Ubuntu 20.04上安装配置VNC</strong>T3】</h2><p>让我们通过本教程的步骤来学习如何在<a href="https://blog.eldernode.com/tag/ubuntu/"> Ubuntu </a> 20.04上<span>安装和配置VNC。所以j </span>和我们一起来看看如何在Ubuntu 20.04服务器上用<span> <a href="https://www.tightvnc.com/" target="_blank" rel="noopener noreferrer"> TightVNC </a> </span>建立一个VNC服务器，并通过SSH隧道安全地连接到它。然后，您将在本地机器上使用VNC客户端程序，通过图形桌面环境与服务器进行交互。</p><p>由于Ubuntu 20.04服务器没有默认安装图形桌面环境或VNC服务器，所以你将从安装它们开始。在选择VNC服务器和桌面环境时，您有很多选择。</p><p>在本教程中，您将为最新的Xfce桌面环境安装软件包，并从官方Ubuntu资源库安装TightVNC软件包。Xfce和TightVNC都以轻量级和快速而闻名，这将有助于确保VNC连接即使在较慢的互联网连接上也是平滑和稳定的。</p><h3 id="step-1-—-installing-the-desktop-environment-and-vnc-server"><span class="ez-toc-section" id="How_to_Install_the_Desktop_Environment_and_VNC_Server"/> <strong>如何安装桌面环境和VNC服务器</strong> <span class="ez-toc-section-end"/></h3><p>使用SSH连接到您的服务器后，更新您的软件包列表:</p><pre><code class="language-bash">sudo apt update</code></pre><p>然后，安装Xfce和<strong> xfce4-goodies </strong>包，该包包含一些针对桌面环境的增强功能:</p><pre><code class="language-bash">sudo apt install xfce4 xfce4-goodies  </code></pre><p>您可能会看到一些提示，要求您为Xfce选择一个默认的显示管理器。它将允许您通过图形界面选择并登录到桌面环境。只有当你连接到VNC客户端时，你才会使用Xfce，在这些Xfce会话中，你已经以非根Ubuntu用户的身份登录了。因此，出于本教程的目的，您选择的显示管理器是不相关的。选择任意一个并按下<strong>键进入</strong>。</p><p>接下来，安装TightVNC服务器:</p><pre><code class="language-bash">sudo apt install tightvncserver  </code></pre><p>要设置VNC访问密码，请运行<strong> vncserver </strong>命令。创建初始配置文件，并启动一个VNC服务器实例:</p><pre><code class="language-bash">vncserver</code></pre><p>当系统提示您输入并验证密码以远程访问您的计算机时:</p><p title="Output"><strong>输出</strong></p><pre><code class="language-bash">You will require a password to access your desktops.    Password:  Verify:</code></pre><p>如您所知，<a href="https://blog.eldernode.com/how-to-create-strong-password/" target="_blank" rel="noopener noreferrer">密码</a>的长度必须在6到8个字符之间。超过8个字符的密码将被自动截断。</p><p>验证密码后，您可以选择创建一个仅供查看的密码。使用只读密码登录的用户将无法使用鼠标或键盘控制VNC实例。如果您想向使用您的VNC服务器的其他人演示一些东西，这是一个有用的选项，但这不是必需的。</p><p>您可以看到该过程为服务器创建了必要的默认配置文件和连接信息。尽管如此，它在端口5901上启动一个默认的服务器实例。这个端口被称为显示端口，被VNC称为:1。VNC可以在其他显示端口上启动多个实例，2表示端口5902，3表示端口5903，依此类推:</p><p><strong>输出</strong></p><pre><code class="language-bash">Would you like to enter a view-only password (y/n)? n  xauth:  file /home/noodi/.Xauthority does not exist    New 'X' desktop is your_hostname:1    Creating default startup script /home/noodi/.vnc/xstartup  Starting applications specified in /home/noodi/.vnc/xstartup  Log file is /home/noodi/.vnc/your_hostname:1.log</code></pre><p><em> <strong>记住</strong> : </em>如果您想要更改密码或添加只读密码，可以使用vncpasswd命令:</p><pre><code class="language-bash">vncpasswd</code></pre><p>刚才，VNC服务器已经安装并运行。现在让我们将其配置为启动Xfce，并通过图形界面访问服务器。</p><h3 id="step-2-—-configuring-the-vnc-server"><span class="ez-toc-section" id="How_to_Configure_the_VNC_Server"/> <strong>如何配置VNC服务器</strong> <span class="ez-toc-section-end"/></h3><p>为了帮助您学习这一步，请注意VNC服务器需要知道在启动时要执行哪些命令。具体来说，VNC需要知道它应该连接到哪个图形桌面环境。</p><p>VNC服务器在启动时运行的命令位于<strong>中名为<strong> xstartup </strong>的配置文件中。您的主目录下的vnc </strong>文件夹。启动脚本是在上一步运行<strong> vncserver </strong>命令时创建的，但是您将创建自己的脚本来启动Xfce桌面。因为您将更改VNC服务器的配置方式，所以首先使用以下命令停止在端口<strong> 5901 </strong>上运行的VNC服务器实例:</p><pre><code class="language-bash">vncserver -kill :1</code></pre><p title="Output"><strong>输出</strong></p><pre><code class="language-bash">Killing Xtightvnc process ID 17648</code></pre><p>要在修改<strong> xstartup </strong>文件之前备份原始文件:</p><pre><code class="language-bash">mv ~/.vnc/xstartup ~/.vnc/xstartup.bak  </code></pre><p>然后您可以创建一个新的<strong> xstartup </strong>文件，并在文本编辑器中打开它。</p><pre><code class="language-bash">nano ~/.vnc/xstartup  </code></pre><p>现在将以下几行添加到文件中:</p><pre title="~/.vnc/xstartup"><code class="language-bash">~/.vnc/xstartup</code></pre><div title="~/.vnc/xstartup"><pre><code class="language-bash">#!/bin/bash  xrdb $HOME/.Xresources  startxfce4 &amp;</code></pre><p>添加完这些行后，<strong>保存</strong>并关闭文件。如果你用的是<strong> nano </strong>，按下<strong> CTRL + X，Y </strong>，然后<strong>回车</strong>即可。然后，为了确保VNC服务器能够正确使用这个新的启动文件，您需要使它可执行:</p><pre><code class="language-bash">chmod +x ~/.vnc/xstartup</code></pre></div><p>然后，<strong>重启</strong>VNC服务器:</p><pre><code class="language-bash">vncserver -localhost  </code></pre><p><em> <strong>注意</strong> : </em>这次该命令包括-localhost选项，它将VNC服务器绑定到您的服务器的环回接口。这将导致VNC只允许来自安装它的服务器的连接。</p><p>然后，您将在您的本地机器和您的服务器之间建立一个SSH隧道，实际上是欺骗VNC，让他认为来自您的本地机器的连接源自您的服务器。这种策略将在VNC周围增加一层额外的安全性，因为只有那些已经可以通过SSH访问您的服务器的用户才能访问它。</p><p title="Output"><strong>输出</strong></p><pre><code class="language-bash">New 'X' desktop is your_hostname:1    Starting applications specified in /home/noodi/.vnc/xstartup  Log file is /home/noodi/.vnc/your_hostname:1.log</code></pre><h3 id="step-3-—-connecting-to-the-vnc-desktop-securely"><span class="ez-toc-section" id="How_to_Connect_to_the_VNC_Desktop_Securely"/> <strong>如何安全连接VNC桌面</strong> <span class="ez-toc-section-end"/></h3><p>VNC本身在连接时不使用安全协议。为了安全地连接到您的服务器，您将建立一个SSH隧道，然后告诉您的VNC客户端使用该隧道进行连接，而不是直接连接。</p><p>在您的本地计算机上创建一个SSH连接，该连接将安全地转发到VNC的本地主机连接。您可以通过Linux或macOS上的终端使用以下ssh命令来实现这一点:</p><pre><code class="language-bash">ssh -L <span class="highlight">59000</span>:localhost:<span class="highlight">5901</span> -C -N -l <span class="highlight">noodi</span> <span class="highlight">your_server_ip</span>  </code></pre><p>看看这个ssh命令的选项意味着什么:</p><p><strong>-L 59000:localhost:5901:</strong>-L开关指定将本地计算机上的给定端口(59000)转发到目标服务器上的给定主机和端口(localhost:5901，表示目标服务器上的端口5901，定义为your_server_ip)。请注意，您指定的本地端口有些随意；只要该端口尚未绑定到其他服务，您就可以将其用作隧道的转发端口。</p><p><strong> -C: </strong>此标志启用压缩，这有助于最小化资源消耗并加快速度。</p><p><strong> -N: </strong>这个选项告诉ssh你不想执行任何远程命令。当您只想转发端口时，此设置很有用。</p><p><strong>-l noodi your _ server _ IP:</strong>-l开关允许您指定连接到服务器后要登录的用户。一定要换掉诺迪</p><p><strong> your_server_ip </strong>包含您的非根用户名称和您的服务器ip地址。</p><p><strong>阅读更多内容</strong>:这个命令建立一个SSH隧道，通过每台机器上的端口22(SSH的默认端口)将信息从VNC服务器上的端口5901转发到本地机器上的端口59000。假设您遵循了Ubuntu 20.04 的先决条件<a href="https://blog.eldernode.com/initial-server-setup-on-ubuntu-20/" target="_blank" rel="noopener noreferrer">初始服务器设置指南，您将添加一个UFW规则来允许通过OpenSSH连接到您的服务器。</a></p><p>这比简单地打开服务器的防火墙允许连接到端口5901更安全，因为这将允许任何人通过VNC访问您的服务器。通过SSH隧道连接，您将VNC访问限制在已经可以通过SSH访问服务器的机器上。</p><p>此外，如果您使用PuTTY连接到您的服务器，您可以通过右键单击终端窗口的顶部栏来创建SSH隧道，然后单击<strong>更改设置… </strong>选项。</p><p>当您通过最后一个部分时，在PuTTY重新配置窗口左侧的树形菜单中找到<strong>连接</strong>分支。展开<strong> SSH </strong>分支，点击<strong>隧道</strong>。在<strong>选项控制SSH端口转发</strong>屏幕上，输入59000作为<strong>源端口</strong>，输入localhost:5901作为<strong>目的端口</strong>，如下所示:</p><p> </p><p><img data-lazyloaded="1" src="../Images/72ddaf42637a0ab0ac2661f13a93850a.png" decoding="async" loading="lazy" class="aligncenter wp-image-23734 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/vnc_putty_reconf_local-1.png" alt="vnc_putty_reconf_local" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/vnc_putty_reconf_local-1.png 671w, https://blog.eldernode.com/wp-content/uploads/2020/08/vnc_putty_reconf_local-1-300x238.png 300w" data-sizes="(max-width: 671px) 100vw, 671px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/vnc_putty_reconf_local-1.png"/></p><p> </p><p>当你访问这个窗口时，点击<strong>添加</strong>按钮，然后<strong>应用</strong>按钮实现隧道。</p><p>一旦隧道运行，使用VNC客户端连接到<strong> localhost:59000 </strong>。您将看到使用您在步骤1中设置的密码进行身份验证的提示。</p><p>当您连接时，您将看到默认的Xfce桌面。</p><p>此外，您可以使用文件管理器或从命令行访问主目录中的文件。</p><p>在本地终端中按下<strong> CTRL+C </strong>来停止SSH隧道并返回到您的提示符。这也将断开您的VNC会话。</p><p><strong>最后</strong>，现在您可以配置您的VNC服务器作为systemd服务运行。</p><h3 id="step-4-—-running-vnc-as-a-system-service"><span class="ez-toc-section" id="Running_VNC_as_a_System_Service"/> <strong>运行VNC作为系统服务</strong> <span class="ez-toc-section-end"/></h3><p>您可以像任何其他服务一样，根据需要启动、停止和重启它。因此，当您设置VNC服务器作为systemd服务运行时。您还可以使用systemd的管理命令来确保VNC在服务器启动时启动。</p><p>但是首先，创建一个新的单元文件，名为<strong> /etc/systemd/system/ <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3c4a525f4f594e4a594e7c124f594e4a555f59">【邮件保护】</a> : </strong></p><pre><code class="language-bash">sudo nano /etc/systemd/system/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f7819994849285819285b7d9849285819e9492">[email protected]</a>  </code></pre><p>关于更多的解释，名称末尾的@符号将让我们传入一个可以在服务配置中使用的参数。您将使用它来指定管理服务时要使用的VNC显示端口。将以下几行添加到文件中。请务必更改<strong>用户</strong>、<strong>组</strong>、<strong>工作目录的值。</strong>和<strong> PIDFILE </strong>的值中的用户名来匹配您的用户名:</p><pre class="code-label" title=" /etc/systemd/system/vncserver@.service"><code class="language-bash">/etc/systemd/system/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="22544c41514750544750620c514750544b4147">[email protected]</a></code></pre><pre title=" /etc/systemd/system/vncserver@.service"><code class="language-bash">[Unit]  Description=Start TightVNC server at startup  After=syslog.target network.target    [Service]  Type=forking  User=noodi  Group=noodi  WorkingDirectory=/home/noodi    PIDFile=/home/noodi/.vnc/%H:%i.pid  ExecStartPre=-/usr/bin/vncserver -kill :%i &gt; /dev/null 2&gt;&amp;1  ExecStart=/usr/bin/vncserver -depth 24 -geometry 1280x800 -localhost :%i  ExecStop=/usr/bin/vncserver -kill :%i    [Install]  WantedBy=multi-user.target</code></pre><div title=" /etc/systemd/system/vncserver@.service"><p>而且让我们更了解上面的命令。如果VNC已经在运行，ExecStartPre 命令会停止它。ExecStart命令启动VNC，并将颜色深度设置为24位颜色，分辨率为1280×800。您也可以修改这些启动选项来满足您的需要。还要注意的是，<strong> ExecStart </strong>命令再次包含了<strong> -localhost </strong>选项。您现在可以保存并关闭文件，然后让系统知道新的单元文件:</p><pre><code class="language-bash">sudo systemctl daemon-reload</code></pre></div><p>要启用单位文件:</p><pre><code class="language-bash">sudo systemctl enable <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="85f3ebe6f6e0f7f3e0f7c5b4abf6e0f7f3ece6e0">[email protected]</a>  </code></pre><p>让我们再次解释一下,@符号后面的1表示服务应该出现在哪个显示号上，在这种情况下，默认为步骤2中讨论的1。</p><p>要停止当前仍在运行的VNC服务器实例，请执行以下操作:</p><pre><code class="language-bash">vncserver -kill :1  </code></pre><p>然后像启动任何其他systemd服务一样启动它:</p><pre><code class="language-bash">sudo systemctl start <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c4b2aaa7b7a1b6b2a1b684f5">[email protected]</a>  </code></pre><p>您可以使用以下命令验证它是否已启动:</p><pre><code class="language-bash">sudo systemctl status <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3f49515c4c5a4d495a4d7f0e">[email protected]</a>  </code></pre><p title="Output"><strong>输出</strong></p><pre><code class="language-bash">● <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3e48505d4d5b4c485b4c7e0f104d5b4c48575d5b">[email protected]</a> - Start TightVNC server at startup       Loaded: loaded (/etc/systemd/system/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="97e1f9f4e4f2e5e1f2e5d7b9e4f2e5e1fef4f2">[email protected]</a>; enabled; vendor preset: enabled)       Active: active (running) since Thu 2020-05-07 17:23:50 UTC; 6s ago      Process: 39768 ExecStartPre=/usr/bin/vncserver -kill :1 &gt; /dev/null 2&gt;&amp;1 (code=exited, status=2)      Process: 39772 ExecStart=/usr/bin/vncserver -depth 24 -geometry 1280x800 :1 (code=exited, status=0/SUCCESS)     Main PID: 39795 (Xtightvnc)  ...</code></pre><p>至此，只要您的服务器启动，VNC服务器就可以使用了，您可以像管理任何其他systemd服务一样使用<strong> systemctl </strong>命令来管理它。</p><p>然而，在客户端不会有任何不同。要重新连接，请再次启动SSH隧道。</p><pre><code class="language-bash">ssh -L <span class="highlight">59000</span>:localhost:<span class="highlight">5901</span> -C -N -l noodi <span class="highlight">your_server_ip  </span></code></pre><p>然后，为了连接到您的服务器，使用您的VNC客户端软件建立一个到<strong> localhost:59000 </strong>的新连接</p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>VNC，被许多人称为控制台，用于在网络中断和无法访问时监控服务器状态。使用VNC，您可以查看服务器的状态。并检查无法访问您的服务器的问题是什么。许多服务器在启动时会挂起，或者sshd服务可能无法在Linux服务器上正常工作。有了VNC，你可以进入服务器，用它来检查和解决问题。我们试图一步一步地教你如何在Ubuntu 20.04上安装和配置VNC。现在，您将能够通过用户友好的图形界面管理您的文件、软件和设置。你还可以远程运行图形软件，比如网络浏览器。</p></div></div>    
</body>
</html>