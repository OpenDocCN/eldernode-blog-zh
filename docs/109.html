<html>
<head>
<title>How to Repair Databases in MySQL - Tutorial ElderNode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何修复MySQL -教程ElderNode博客中的数据库</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/repair-databases-in-mysql/#0001-01-01">https://blog.eldernode.com/repair-databases-in-mysql/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/d9bee1df50d4c8da87b3048e43354b7c.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to Repair Databases in MySQL" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-2.png"/><p>如何修复MySQL中的数据库？有时候，一个MySQL数据库会<strong>崩溃</strong>。这个问题可以用<span> cPanel </span>、<span> phpMyAdmin </span>或者<span> WHM </span>修复。<strong>本文</strong>解释了如何修复MySQL <span>数据库</span>和<span>表</span>。</p><p>MySQL包括几个工具，可以用来检查和修复数据库表。跟随我们修复MySQL数据库。</p><p> </p><p><a href="https://eldernode.com/ssd-vps/"> <strong>购买SSD VPS托管服务器</strong> </a></p><p> </p><h3><span class="ez-toc-section" id="Step_1_Backup_the_databases"/>第一步:备份数据库<span class="ez-toc-section-end"/></h3><p>在尝试修复任何数据库之前，您必须首先<strong>将其恢复</strong>。要从所有数据库中<span>备份</span>所有文件，请按照以下步骤操作:</p><p><strong> <span> 1。</span>使用<a href="https://en.wikipedia.org/wiki/Secure_Shell"> SSH </a>登录</strong>到你的<span>服务器</span>。</p><p><strong> <span> 2。</span>为你的<span> Linux发行版</span>使用适当的<span>命令</span>停止<span> MySQL服务器</span>:</strong></p><p><span><strong>–</strong></span>对于<span> CentOS </span>和<span> Fedora </span>，键入以下命令:</p><pre class="command"><code class="language-bash">service mysqld stop</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>，键入以下命令:</p><pre class="command"><code class="language-bash">service mysql stop</code></pre><p><span> <strong> 3。</strong></span><strong>下面的命令</strong>根据<span>当前时间</span>(确切地说，是自1970年1月1日以来的秒数)将所有数据库中的所有文件复制到一个<span>目录名</span>。</p><p>这确保了每个数据库备份都存储在具有唯一名称的文件夹中。为了增加保护，您可以(也应该)将数据库文件分离到远离服务器的位置。</p><pre class="command"><code class="language-bash">cp -rfv /var/lib/mysql /var/lib/mysql$(date +%s)</code></pre><p><span> <strong> 4。</strong> </span> <span>重启</span><span>MySQL服务器</span>使用适合您的<span> Linux发行版</span>的命令:</p><p><span><strong>–</strong></span>对于<span> CentOS </span>和<span> Fedora </span>，键入以下命令:</p><pre class="command"><code class="language-bash">service mysqld start</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>，键入以下命令:</p><pre class="command"><code class="language-bash">service mysql start</code></pre><h3><span class="ez-toc-section" id="Step_2_Check_and_repair_a_table_with_MYSQLCHECK"/>第二步:用MYSQLCHECK检查并修复一个表<span class="ez-toc-section-end"/></h3><p>备份数据库后，您就可以进行故障排除了。当<strong>修复</strong>正在<span>运行</span>时，<span> mysqlcheck </span>应用程序使您能够检查<span> MySQL数据库</span>。当您想要在数据库<strong>中工作而不停止</strong>整个<span> MySQL服务</span>时，这个特性非常有用。</p><p>此外，<span> mysqlcheck </span>用于使用<strong> MyISAM </strong>或<strong> InnoDB </strong>数据库引擎的表中。</p><p>要使用<span> mysqlcheck </span>，请遵循以下步骤:</p><p><span> <strong> 1。</strong> </span>作为<span>根用户</span>，键入以下命令:</p><pre class="command"><code class="language-bash">cd /var/lib/mysql</code></pre><p><span> <strong> 2。</strong> </span>到<span>将</span><span>数据库</span>替换为您要检查的数据库的名称，键入以下命令:</p><pre class="command"><code class="language-bash">mysqlcheck DATABASE</code></pre><p>前面的命令检查指定数据库中的所有表。或者，键入以下命令来检查数据库中的特定表。</p><p>用数据库名替换数据库，用要检查的表名替换表:</p><pre class="command"><code class="language-bash">mysqlcheck DATABASE TABLE</code></pre><p><span> <strong> 3。</strong> </span> <span> Mysqlcheck </span>检查指定的数据库和表。如果一个表通过了检查，mysqlcheck会为该表显示<span> OK </span>。但是，如果mysqlcheck报告了一个表错误，请键入以下命令尝试修复它。</p><p>用数据库名替换<span>数据库</span>,用表名替换表:</p><pre class="command"><code class="language-bash">mysqlcheck -r DATABASE TABLE</code></pre><p><span> <strong> 4。</strong> </span>如果mysqlcheck不能成功<span>修复</span>表或表，转到下面的<span>方法</span>。</p><p> </p><h3><span class="ez-toc-section" id="Step_3_Identify_the_specific_engine"/>第三步:识别具体的发动机<span class="ez-toc-section-end"/></h3><p>如果运行<span> mysqlcheck </span>不能解决问题，下一步就是对数据库表中使用的引擎进行特定的诊断。</p><p>对于您的表数据库存储引擎，请遵循以下适当的过程。</p><p> </p><h4><span class="ez-toc-section" id="Repair_MyISAM_tables_with_myisamchk"/>用myisamchk修复MyISAM表<span class="ez-toc-section-end"/></h4><p>如果你为一个表使用了一个<span> MyISAM </span>存储引擎，你可以运行<span> myisamchk程序</span>来修复它。</p><p>为此，请按照下列步骤操作:</p><p><span> <strong>注意:</strong></span><span>myisamchk程序</span>只适用于在<span> MyISAM存储引擎</span>上运行的表，而不适用于InnoDB引擎。</p><p><strong> <span> 1。</span>使用适当的命令停止<span> MySQL服务器</span><span>Linux发行版</span>:</strong></p><p><span><strong>–</strong></span>为<span> CentOS </span>和<span> Fedora </span>:</p><pre class="command"><code class="language-bash">service mysqld stop</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>:</p><pre class="command"><code class="language-bash">service mysql stop</code></pre><p><span> <strong> 2。</strong> </span>键入以下命令:</p><pre class="command"><code class="language-bash">cd /var/lib/mysql</code></pre><p><span> <strong> 3。</strong> </span>切换到数据库所在的目录。例如，如果数据库名为Customers，请键入CD Customers。</p><p><span> <strong> 4。</strong> </span>键入以下命令，用您想要检查的表的名称替换<span>表</span>:</p><pre class="command"><code class="language-bash">myisamchk TABLE</code></pre><p>要检查数据库中的所有表，请键入以下命令:</p><div class="tip"><pre class="command"><code class="language-bash">myisamchk * .MYI</code></pre><p>如果前面的命令不起作用，可以尝试从<span> myisamchk </span>中<span>删除可能无法正常运行的临时文件</span>。</p><p>为此，请转到/var/lib/mysql文件夹，然后键入以下命令:</p></div><pre class="command"><code class="language-bash">ls * / *. TMD</code></pre><p>如果有<span> TMD文件</span>，输入以下命令删除它们:</p><pre class="command"><code class="language-bash">rm * / *. TMD</code></pre><p>然后尝试再次运行<span> myisamchk </span>。</p><p><span> <strong> 5。</strong> </span>要尝试修复一个表，键入下面的命令并用您想要修复的表的名称替换<span>表</span>:</p><pre class="command"><code class="language-bash">myisamchk --recover <em>TABLE</em></code></pre><p><span> <strong> 6。</strong> </span> <span>重启</span><span>MySQL服务器</span>使用适合您的<span> Linux发行版</span>的命令:</p><p><span><strong>–</strong></span>为<span> CentOS </span>和<span> Fedora </span>:</p><pre class="command"><code class="language-bash">service mysqld start</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>:</p><pre class="command"><code class="language-bash">service mysql start</code></pre><p><span> <strong> 7。</strong> </span>测试修好的表或表。</p><p> </p><p><img data-lazyloaded="1" src="../Images/d009e8e91f6535905e831998e5df54f6.png" decoding="async" loading="lazy" class="aligncenter wp-image-10504 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-1.png" alt="How to Repair Databases in MySQL" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-1.png 1342w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-1-300x206.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-1-1024x703.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-1-768x527.png 768w" data-sizes="(max-width: 1342px) 100vw, 1342px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/How-to-Repair-Databases-in-MySQL-1.png"/></p><p> </p><h4><span class="ez-toc-section" id="Execute_the_InnoDB_recovery_process"/>执行InnoDB恢复过程<span class="ez-toc-section-end"/></h4><p>如果您将<span> InnoDB存储引擎</span>用于数据库表，您可以运行<strong> InnoDB恢复进程</strong>。为此，请按照下列步骤操作:</p><p><span> <strong> 1。</strong> </span>使用<span>文本编辑器</span>打开你服务器上的<span> my.cnf </span>文件。<span> my.cnf </span>文件的<strong>位置</strong>取决于您的L <span> inux发行版</span>:</p><p><span><strong>–</strong></span>在<span> CentOS </span>和<span> Fedora </span>中，<strong> my.cnf文件</strong>位于/etc目录下。</p><p><span><strong>–</strong></span>在<span> Debian </span>和<span> Ubuntu </span>中，<strong> my.cnf文件</strong>位于/etc/mysql目录下。</p><p><span> <strong> 2。</strong> </span>在<strong> my.cnf </strong>文件中，找到<span>【mysqld】</span>部分。</p><p><span> <strong> 3。</strong> </span>在<span>【mysqld】</span>部分添加下面一行:</p><pre class="code"><code class="language-bash">innodb_force_recovery=4</code></pre><p><span> <strong> 4。</strong> </span> <span>保存</span>对<strong> my.cnf </strong>文件的修改。</p><p>然后<span>使用合适的<span>命令</span>重启</span>T2】MySQL服务器用于你的<span> Linux发行版</span>:</p><p><span><strong>–</strong></span>为<span> CentOS </span>和<span> Fedora </span>:</p><pre class="command"><code class="language-bash">service mysqld restart</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>:</p><pre class="command"><code class="language-bash">service mysql restart</code></pre><p><span> <strong> 5。</strong> </span>键入以下命令，将<span>的</span>所有数据库导出到<span> databases.sql </span>文件中:</p><pre class="command"><code class="language-bash">mysqldump --all-databases --add-drop-database --add-drop-table &gt; databases.sql</code></pre><p><span> <strong> 6。</strong> </span> <span>启动</span><strong>MySQL程序</strong>，然后尝试<span>使用<span> DROP DATABASE </span>命令</span>删除<span>损坏的数据库</span>。</p><p>如果MySQL无法删除数据库，可以在关闭MySQL服务器后，在<span>步骤8 </span>中手动删除。</p><p><span> <strong> 7。</strong> </span> <span>停止</span><strong>MySQL服务器</strong>使用适合您的<span> Linux发行版</span>的命令:</p><p><span><strong>–</strong></span>为<span> CentOS </span>和<span> Fedora </span>:</p><pre class="command"><code class="language-bash">service mysqld stop</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>:</p><pre class="command"><code class="language-bash">service mysql stop</code></pre><p> </p><p> </p><p><span> <strong> 8。</strong> </span>如果在<span>第6步</span>中不能删除数据库，输入以下命令<span>手动删除</span>。</p><p>用您想要删除的数据库的名称替换<span>数据库名</span>:</p><pre class="command"><code class="language-bash">cd /var/lib/mysql  rm -rf <em>DBNAME</em></code></pre><p><span> <strong>提示:</strong> </span>确保你<strong>没有删除</strong><span>MySQL目录</span>或<span> performance_schema </span>！</p><p><span> <strong> 9。</strong> </span>用你最喜欢的<span>文本编辑器</span>打开你服务器上的<span> my.cnf </span>文件。然后将以下命令放入<span>【mysqld】</span>部分:</p><pre class="code"><code class="language-bash"># innodb_force_recovery = 4</code></pre><p>该模式<strong>禁用</strong> <span> InnoDB恢复</span>。</p><p><span> <strong> 10。</strong> </span> <span>保存</span>对<span> my.cnf </span>文件的修改。然后<span>使用适用于您的<span> Linux发行版</span>的适当命令启动</span>MySQL服务器<span>:</span></p><p><span><strong>–</strong></span>为<span> CentOS </span>和<span> Fedora </span>:</p><pre class="command"><code class="language-bash">service mysqld start</code></pre><p><span><strong>–</strong></span>对于<span> Debian </span>和<span> Ubuntu </span>:</p><pre class="command"><code class="language-bash">service mysql start</code></pre><p><span> <strong> 11。</strong> </span>输入以下命令<span>从<strong>步骤5 </strong>中创建的备份文件中恢复</span>数据库:</p><pre class="command"><code class="language-bash">mysql &lt; databases.sql</code></pre><p><span> <strong> 12。</strong> </span>重建数据库测试。</p><p><strong>尊敬的用户</strong>，我们希望您能喜欢这个<a href="https://eldernode.com/category/tutorial/">教程</a>，您可以在评论区提出关于本次培训的问题，或者解决<a href="https://eldernode.com/blog/">老年人节点培训</a>领域的其他问题，请参考<a href="https://eldernode.com/ask">提问页面</a>部分，并尽快提出您的问题。腾出时间给其他用户和专家来回答你的问题。</p><p><span>好运</span>。</p></div></div>    
</body>
</html>