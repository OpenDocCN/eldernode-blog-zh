<html>
<head>
<title>How to Install and Configure the FTP server with PowerShell - ElderNode Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用PowerShell安装和配置FTP服务器- ElderNode Blog</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-and-configure-ftp-server/#0001-01-01">https://blog.eldernode.com/install-and-configure-ftp-server/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/4c2b09abddf1dac629107e67a5ff818c.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to Install and Configure the FTP server with PowerShell" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell.png"/><p>如何用<a href="http://eldernode.com/tag/powershell-commands/"> PowerShell </a>安装配置<a href="https://en.wikipedia.org/wiki/File_Transfer_Protocol"> FTP </a>服务器？我们已经在之前的教程中用图形方式考察了<a href="https://eldernode.com/install-ftp-server-on-windows-server/">如何在Windows Server 2019 </a>中安装FTP服务器，而在本文中的<span>，我们将教你如何用<span> PowerShell </span>来做到这一点。</span></p><p>我们将向您展示如何配置<strong>站点名称</strong>、<strong>端口</strong>和<strong>根文件夹</strong>。然后我们将解释如何创建<span> FTP用户</span>，如何<span>认证用户</span>，以及如何<span>配置SSL策略</span>和<span> NTFS权限</span>。</p><p> </p><p><a href="https://eldernode.com/vps/"><strong><em>elder node中可用的VPS服务器</em> </strong> </a></p><p> </p><h3><span class="ez-toc-section" id="How_to_Install_the_FTP_feature"/>如何安装FTP功能<span class="ez-toc-section-end"/></h3><p>在开始配置您的<span> FTP服务器</span>之前，您首先需要安装所需的Windows功能:</p><p><strong> <span> 1) </span> </strong> FTP</p><p><strong> <span> 2) </span> </strong> Web服务器(IIS)</p><p><strong> <span> 3) </span> </strong>管理工具用<span> PowerShell </span>进行管理</p><pre><code class="language-bash"># Install the Windows feature for FTP  Install-WindowsFeature Web-FTP-Server -IncludeAllSubFeature  Install-WindowsFeature Web-Server -IncludeAllSubFeature IncludeManagementTools</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/8546686af5e2d356ffe5407868d091c2.png" decoding="async" loading="lazy" class="aligncenter wp-image-12167 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-1.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-1.png 553w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-1-300x112.png 300w" data-sizes="(max-width: 553px) 100vw, 553px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-1.png"/></p><p> </p><p>安装完成后，导入<span> WebAdministration </span>模块。</p><p>这将映射一个<span>互联网信息服务</span> ( <strong> IIS </strong>)驱动器(<span> IIS:\ </span>)，通过它我们将配置我们的<strong> FTP站点</strong>，稍后在本文中<span>。</span></p><pre><code class="language-bash"># Import the module  Import-Module WebAdministration</code></pre><h3><span class="ez-toc-section" id="How_to_Configuring_the_site_name_port_and_root_folder"/>如何配置站点名称、端口和根文件夹<span class="ez-toc-section-end"/></h3><p>您可以使用<span> New-WebFtpSite cmdlet </span>创建一个新的<strong> FTP站点，方法是为您的FTP站点提供一个<span> FTP站点名称</span>、<span>根文件夹</span>和<span>端口号</span>。</strong></p><p><span> <strong>注意:</strong> </span>我们选择的是<span>端口21 </span>，这是<span>默认的FTP端口</span>，但是您也可以为您的<span> FTP站点</span>指定任何自定义端口。</p><pre><code class="language-bash"># Create the FTP site  $FTPSiteName = <span>'Default FTP Site'</span>  $FTPRootDir = <span>'D:\FTPRoot'</span>  $FTPPort = 21  New-WebFtpSite -Name $FTPSiteName -Port $FTPPort -PhysicalPath $FTPRootDir</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/13cf4205a0d46caf98e9dc13f133f9d9.png" decoding="async" loading="lazy" class="aligncenter wp-image-12169 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-2.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-2.png 615w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-2-300x107.png 300w" data-sizes="(max-width: 615px) 100vw, 615px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-2.png"/></p><p> </p><p>运行完<span> cmdlet </span>后，你会在<a href="https://eldernode.com/configure-default-site-in-iis-server/"> IIS管理器</a>中看到<strong> FTP站点</strong>和绑定。</p><p> </p><p><img data-lazyloaded="1" src="../Images/13aef6b45020157aa6d38c160ff3f9b5.png" decoding="async" loading="lazy" class="aligncenter wp-image-12170 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-3.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-3.png 656w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-3-300x161.png 300w" data-sizes="(max-width: 656px) 100vw, 656px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-3.png"/></p><p> </p><h3><span class="ez-toc-section" id="How_to_Create_FTP_users"/>如何创建FTP用户<span class="ez-toc-section-end"/></h3><p>创建一个新的<strong> FTP站点</strong>后，您可以<span>创建一个Windows用户或组</span>，通过它您可以控制对<strong> FTP服务器</strong>的访问。</p><p><strong>首先</strong>，创建<span> Windows本地组</span>:</p><pre><code class="language-bash"># Create the local Windows group  $FTPUserGroupName = <span>"FTP Users"</span>  $ADSI = [ADSI]<span>"WinNT://$env:ComputerName"</span>  $FTPUserGroup = $ADSI.Create(<span>"Group", "$FTPUserGroupName"</span>)  $FTPUserGroup.SetInfo()  $FTPUserGroup.Description = <span>"Members of this group can connect through FTP"</span>  $FTPUserGroup.SetInfo()</code></pre><p>然后我们将<strong>创建</strong>一个<span>新的本地FTP用户</span>，使用<strong>用户名</strong>和<strong>密码</strong>:</p><pre><code class="language-bash"># Create an FTP user  $FTPUserName = <span>"FTPUser"</span>  $FTPPassword = <span>'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a6f6e6d5d5d1c9d4c2979495">[email protected]</a>'</span>  $CreateUserFTPUser = $ADSI.Create(<span>"User"</span>, <span>"$FTPUserName"</span>)  $CreateUserFTPUser.SetInfo()  $CreateUserFTPUser.SetPassword(<span>"$FTPPassword"</span>)  $CreateUserFTPUser.SetInfo()</code></pre><p><strong>将<span> FTP用户</span>的</strong>添加到<span> Windows组</span>:</p><pre><code class="language-bash"># Add an FTP user to the group FTP Users  $UserAccount = New-Object System.Security.Principal.NTAccount(<span>"$FTPUserName"</span>)  $SID = $UserAccount.Translate([System.Security.Principal.SecurityIdentifier])  $Group = [ADSI]<span>"WinNT://$env:ComputerName/$FTPUserGroupName,Group"</span>  $User = [ADSI]<span>"WinNT://$SID"</span>  $Group.Add($User.Path)</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/af60abe69daf573d72f0513609106015.png" decoding="async" loading="lazy" class="aligncenter wp-image-12171 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-4.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-4.png 645w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-4-300x253.png 300w" data-sizes="(max-width: 645px) 100vw, 645px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-4.png"/></p><p> </p><h3><span class="ez-toc-section" id="How_to_Authenticate_FTP_users_to_access_FTP_server_data"/>如何认证FTP用户访问FTP服务器数据<span class="ez-toc-section-end"/></h3><p>现在<strong>在<strong> FTP站点</strong>上启用</strong>基本<span>认证</span>，并授权包含<span> FTP用户</span>的<span> Windows组</span>访问<span> FTP站点</span>。</p><pre><code class="language-bash"># Enable basic authentication on the FTP site  $FTPSitePath =<span> "IIS:\Sites\$FTPSiteName"</span>  $BasicAuth = <span>'ftpServer.security.authentication.basicAuthentication.enabled'</span>  Set-ItemProperty -Path $FTPSitePath -Name $BasicAuth -Value $True  # Add an authorization read rule for FTP Users.  $Param = @{  Filter = <span>"/system.ftpServer/security/authorization"</span>  Value = @{  accessType =<span> "Allow"</span>  roles = <span>"$FTPUserGroupName"</span>  permissions = 1  }  PSPath =<span> 'IIS:\'</span>  Location = $FTPSiteName  }  Add-WebConfiguration @param</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/fcd24341ee3ea41c13a9650673d914db.png" decoding="async" loading="lazy" class="aligncenter wp-image-12172 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-5.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-5.png 629w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-5-300x145.png 300w" data-sizes="(max-width: 629px) 100vw, 629px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-5.png"/></p><p> </p><p>你也可以在<span> IIS管理器</span> <span> &gt; &gt; </span> <span> FTP站点</span><span>&gt;&gt;</span><span><span>F</span>TP授权规则</span>下<strong>查看</strong>这些设置。</p><p><img data-lazyloaded="1" src="../Images/35527c5cd4bf6f2fea9ed983de356eb5.png" decoding="async" loading="lazy" class="aligncenter wp-image-12173 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-6.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-6.png 707w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-6-300x239.png 300w" data-sizes="(max-width: 707px) 100vw, 707px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-6.png"/></p><p> </p><h3><span class="ez-toc-section" id="SSL_policy_and_NTFS_permissions_to_the_FTP_root_folder"/>FTP根文件夹的SSL策略和NTFS权限<span class="ez-toc-section-end"/></h3><p>将<span> SSL策略</span>从<span>要求SSL </span>更改为<span>允许SSL连接</span>。</p><pre><code class="language-bash">$SSLPolicy = @(  <span>'ftpServer.security.ssl.controlChannelPolicy',  'ftpServer.security.ssl.dataChannelPolicy'</span>  )  Set-ItemProperty -Path $FTPSitePath -Name $SSLPolicy[0] -Value $false  Set-ItemProperty -Path $FTPSitePath -Name $SSLPolicy[1] -Value $false</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/18a8f34a5f085a53df2a81761566f970.png" decoding="async" loading="lazy" class="aligncenter wp-image-12174 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-7.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-7.png 626w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-7-300x82.png 300w" data-sizes="(max-width: 626px) 100vw, 626px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-7.png"/></p><p> </p><p>下面的命令在<span> FTPRoot文件夹</span>上设置<strong> NTFS权限</strong>，允许<span> FTP用户组</span>访问文件:</p><pre><code class="language-bash">$UserAccount = New-Object System.Security.Principal.NTAccount(<span>"$FTPUserGroupName"</span>)  $AccessRule = [System.Security.AccessControl.FileSystemAccessRule]::new($UserAccount,  <span>'ReadAndExecute'</span>,  <span>'ContainerInherit,ObjectInherit'</span>,  <span>'None'</span>,  <span>'Allow'</span>  )  $ACL = Get-Acl -Path $FTPRootDir  $ACL.SetAccessRule($AccessRule)  $ACL | Set-Acl -Path $FTPRootDir</code></pre><p> </p><p><img data-lazyloaded="1" src="../Images/2b796bf6e5d5e79e101b4cae690b4921.png" decoding="async" loading="lazy" class="aligncenter wp-image-12175 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-8.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-8.png 716w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-8-300x101.png 300w" data-sizes="(max-width: 716px) 100vw, 716px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-8.png"/></p><p> </p><p>你可以从<span>安全</span>标签下的<span> FTP根文件夹</span>属性中<strong>验证</strong>这一点。</p><p> </p><p><img data-lazyloaded="1" src="../Images/51a6ad98bc4affae0d41c61314fb3d78.png" decoding="async" loading="lazy" class="aligncenter wp-image-12176 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-9.jpg" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-9.jpg 365w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-9-229x300.jpg 229w" data-sizes="(max-width: 365px) 100vw, 365px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-9.jpg"/></p><p> </p><pre><code class="language-bash"># Restart the FTP site for all changes to take effect  Restart-WebItem <span>"IIS:\Sites\$FTPSiteName"</span> -Verbose</code></pre><p>您可以测试<strong> FTP服务器</strong>，它应该允许您<span>访问<strong> FTP根文件夹</strong>下的文件</span>、内容和<span>目录</span>。</p><p> </p><p><img data-lazyloaded="1" src="../Images/7d1d2c2392d015f44384d51a774e03a1.png" decoding="async" loading="lazy" class="aligncenter wp-image-12177 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-10.png" alt="How to Install and Configure the FTP server with PowerShell" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-10.png 677w, https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-10-300x206.png 300w" data-sizes="(max-width: 677px) 100vw, 677px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/How-to-Install-and-Configure-the-FTP-server-with-PowerShell-10.png"/></p><p> </p><p><span> <strong>亦作，见:</strong> </span></p><p><a href="https://eldernode.com/add-ftp-site-on-windows-server/">教程在Windows Server 2019上添加FTP站点</a></p><p><a href="https://eldernode.com/create-ftp-in-xampp/">如何在XAMPP创建FTP</a></p><p><a href="https://eldernode.com/install-ftp-server-on-windows-server/">如何在windows server 2019上安装FTP服务器</a></p><p><strong>尊敬的用户</strong>，我们希望您能喜欢这个<a href="https://eldernode.com/category/tutorial/">教程</a>，您可以在评论区提出关于本次培训的问题，或者解决<a href="https://eldernode.com/blog/">老年人节点培训</a>领域的其他问题，请参考<a href="https://eldernode.com/ask">提问页面</a>部分，并尽快提出您的问题。腾出时间给其他用户和专家来回答你的问题。</p><p><span>如何用PowerShell安装和配置FTP服务器</span></p><p><span>好运</span>。</p></div></div>    
</body>
</html>