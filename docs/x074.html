<html>
<head>
<title>8 Steps to Optimize Your WordPress with Varnish</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用清漆优化你的WordPress的8个步骤</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/optimize-your-wordpress-with-varnish/#0001-01-01">https://blog.eldernode.com/optimize-your-wordpress-with-varnish/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/f5f03cf455344c953363d35e1d4f67e4.png" data-src="https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish.webp" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="8 Steps to Optimize Your WordPress with Varnish.webp" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish.webp 2069w, https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish-300x164.webp 300w, https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish-1024x561.webp 1024w, https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish-768x421.webp 768w, https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish-1536x842.webp 1536w, https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish-2048x1122.webp 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2022/11/8-Steps-to-Optimize-Your-WordPress-with-Varnish.webp"/><p>缓存系统将静态页面和稳定的代码保存在内存中，当用户访问网站时，缓存服务会给出用户的响应。可以使用各种缓存服务。其中最受欢迎的是清漆。这篇文章将解释用清漆优化你的WordPress的8个步骤。如果你打算购买一台Linux VPS服务器，你可以在<a href="https://eldernode.com/"> Eldernode </a>网站上查看提供的软件包。</p><h2><span class="ez-toc-section" id="How_to_Optimize_Your_WordPress_with_Varnish"/> <strong>如何用清漆优化你的WordPress</strong><span class="ez-toc-section-end"/></h2><p><a href="https://blog.eldernode.com/varnish-cache-for-apache-on-ubuntu/"> Varnish </a>是一个HTTP加速器，专注于HTTP，作为缓存服务放在Apache或Nginx web服务器前面。它通常是为具有非常高的流量并不断得到服务的web服务器而设计的。目前，大型网站使用这一系统，其中包括维基百科和许多在线报纸，以及许多著名的社交网络。你可以使用Varnish来优化你的WordPress。</p><p>在这个来自<a href="https://blog.eldernode.com/tag/wordpress/"> WordPress培训</a>系列的教程中，你将学习如何用Varnish优化你的WordPress。</p><h3><span class="ez-toc-section" id="1-_Installing_Varnish"/> <strong> 1-安装清漆</strong>T3】</h3><p>优化你的WordPress的第一步是安装Varnish。Varnish cache也称为缓存反向HTTP代理，是一个快速、高性能的web应用程序，它通过将传入的HTTP请求转发到您的web服务器来加速您的网站。它位于网络服务器的前面，捕获大多数用户访问的所有网络流量，并将其存储在内存中。通过这样做，它增加了网页的检索时间。这个加速器适用于许多Linux发行版，包括RedHat、CentOS、Debian和Ubuntu。要在不同的操作系统上安装Varnish缓存，可以在<a href="https://varnish-cache.org/releases/"> Varnish官网</a>查看最新发布的版本。</p><h3><span class="ez-toc-section" id="2-_Adding_the_Plugin_on_WordPress"/> <strong> 2-在WordPress </strong>上添加插件<span class="ez-toc-section-end"/></h3><p>一旦安装了Varnish，第二步是在WordPress上添加Varnish HTTP cache插件。你也可以使用几个插件来代替Varnish HTTP缓存。为此，打开WordPress仪表盘，转到<strong>插件&gt;T3】添加新的</strong>路径:</p><p> </p><p><img data-lazyloaded="1" src="../Images/1ea2ba81d274e6ab1bb255d4892de7be.png" decoding="async" loading="lazy" class="aligncenter wp-image-41313 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2022/11/Add-new-plugin.webp" alt="Add-new-plugin" data-original-src="https://blog.eldernode.com/wp-content/uploads/2022/11/Add-new-plugin.webp"/></p><p> </p><p>现在搜索Varnish HTTP Purge并单击Install Now。最后，你应该激活它。</p><h3><span class="ez-toc-section" id="3-_Enabling_Custom_Permalinks"/> <strong> 3-启用自定义永久链接</strong> <span class="ez-toc-section-end"/></h3><p>在这一步中，您应该启用mod_rewrite，并为永久链接和归档使用自定义URL结构，以使Varnish HTTP Purge正确工作。为此，点击WordPress仪表盘中的<strong>设置&gt; &gt;永久链接&gt; &gt;自定义结构</strong>。</p><p>现在输入/%year%/%monthnum%/%post_id%并点击<strong>保存更改</strong>。最后，打开命令提示符，输入如下所示的命令:</p><pre><code class="language-bash">a2enmod rewrite</code></pre><h3><span class="ez-toc-section" id="4-_Moving_Apache_to_a_Different_Port"/> <strong> 4-将阿帕奇移动到不同的港口</strong> <span class="ez-toc-section-end"/></h3><p>将Apache迁移到不同的端口是优化WordPress网站的另一个步骤；这是你在配置Varnish来处理你的WordPress网站的所有流量之前应该做的。请注意，您应该使用文本编辑器在<strong> /etc/apache2/ports.conf </strong>中更改所有出现的端口80，并将<strong>/etc/Apache 2/sites-enabled/</strong>下的任何文件更改为<strong> 8080 </strong>。</p><h3><span class="ez-toc-section" id="5-_Serving_from_Varnish"/> <strong> 5-上漆</strong> <span class="ez-toc-section-end"/></h3><p>端口80可用后，更新Varnish配置，放在Apache和WordPress前面。用你想要的文本编辑器打开<strong> /etc/default/varnish </strong>，将端口从<strong> 6081 </strong>改为<strong> 80 </strong>。因为默认安装清漆将等待端口6081上的连接。</p><h3><span class="ez-toc-section" id="6-_Exclude_URLs"/> <strong> 6-排除网址</strong> <span class="ez-toc-section-end"/></h3><p>Varnish使用后端或源服务器来确定在哪里检索缓存中不持久的内容。有些URL不应该缓存。使用您想要的文本编辑器打开<strong> /etc/varnish/default.vcl </strong>，添加以下命令:</p><pre><code class="language-bash">if (req.url ~ "wp-admin|wp-login") {    return (pass);    }</code></pre><h3><span class="ez-toc-section" id="7-_Extend_Caching"/> <strong> 7-扩展缓存</strong> <span class="ez-toc-section-end"/></h3><p>在Cache-Control HTTP头中，Varnish使用了max-age参数。这可以确定内容在再次联系后端之前多久被视为新鲜。默认情况下，Varnish使用120秒，您可以通过更新<strong> /etc/varnish/default.vcl </strong>来延长这个时间段:</p><pre><code class="language-bash">sub vcl_backend_response {    if (beresp.ttl == 120s) {    set beresp.ttl = 1h;    }  }</code></pre><h3><span class="ez-toc-section" id="8-_Handling_Purge_Requests_and_Securing_Purge"/> <strong> 8-处理清除请求并确保清除</strong> <span class="ez-toc-section-end"/></h3><p>当更新WordPress中的内容时，Varnish HTTP Purge插件将要求Varnish将其从缓存中删除。它在下一次请求时从后端检索最新版本。您可以通过在/etc/varnish/default.vcl中添加以下vcl_recv来实现这一点:</p><pre><code class="language-bash">if (req.method == "PURGE") {    if (req.http.X-Purge-Method == "regex") {    ban("req.url ~ " + req.url + " &amp;&amp; req.http.host ~ " + req.http.host);    return (synth(200, "Banned."));    } else {    return (purge);    }  }</code></pre><p>就是这样！通过这8个步骤，你可以用Varnish成功优化你的WordPress。</p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>Varnish是一个缓存HTTP反向代理，可以帮助你优化你的WordPress网站。在这篇文章中，我们教你如何用8个步骤优化你的WordPress。我希望这篇教程对你有用，帮助你用Varnish优化你的WordPress。如果您有任何问题或建议，可以在评论区联系我们。</p></div></div>    
</body>
</html>