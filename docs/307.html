<html>
<head>
<title>How to add Swap Space on Ubuntu 20.04 swap partition on ubuntu 20</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Ubuntu 20上添加交换空间Ubuntu 20.04交换分区</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/add-swap-space-on-ubuntu-20-04/#0001-01-01">https://blog.eldernode.com/add-swap-space-on-ubuntu-20-04/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/dc28b4f77ade1884a2ba2378b4fb3d05.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to add Swap Space on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/07/IMG_2261.png"/><p>作为管理员，您在应用程序中会遇到内存不足的错误。在这篇文章中，我们将学习如何在Ubuntu 20.04上添加交换空间。加入我们来看看在您的服务器上添加了<a href="https://www.linux.com/news/all-about-linux-swap-space/" target="_blank" rel="noopener noreferrer">交换空间</a>之后，您可以多么容易地防范这个问题。</p><p> </p><h2><span class="ez-toc-section" id="How_to_add_Swap_Space_on_Ubuntu_2004"/> <span>如何在Ubuntu 20.04上添加交换空间</span> <span class="ez-toc-section-end"/></h2><h3 id="what-is-swap"><span class="ez-toc-section" id="What_is_Swap"/> <span>什么是互换？</span>T3】</h3><p>虽然RAM不能再保存一些数据，但硬盘上有一个区域被指定为操作系统可以临时存储数据的地方。这个区域被称为Swap。换句话说，当RAM中没有足够的空间来保存正在使用的应用程序数据时，您可以增加服务器在其工作“内存”中可以保存的信息量。</p><p>虽然写入磁盘的信息会慢一些(比保存在RAM中的信息慢)，但操作系统更喜欢将运行的应用程序数据保存在内存中，并使用交换。</p><h3 id="step-1-–-checking-the-system-for-swap-information"><span class="ez-toc-section" id="_1-_Checking_the_System_for_Swap_Information"/> <span> 1-检查系统互换信息</span> <span class="ez-toc-section-end"/></h3><p>首先，检查系统中是否有可用的交换空间。一个应该足够了，尽管有可能有多个交换文件或交换分区，</p><p>要验证这一点，请键入以下命令</p><pre><code class="language-bash">sudo swapon --show</code></pre><p>如果您没有收到任何输出，这意味着系统当前没有可用的交换空间。</p><p>要检查是否有任何活动的交换，使用<span> free </span>实用程序</p><pre><code class="language-bash">free -h    <span>Output</span>                  total        used        free      shared  buff/cache   available  Mem:          990Mi        36Mi       863Mi       4.0Mi        89Mi       837Mi  <span>Swap:            0B          0B          0B        </span></code></pre><h3 id="step-2-–-checking-available-space-on-the-hard-drive-partition"><span class="ez-toc-section" id="2-_Checking_Available_Space_on_the_Hard_Drive_Partition"/> <span> 2-检查硬盘分区上的可用空间</span> <span class="ez-toc-section-end"/></h3><p>要检查当前的磁盘使用情况以确保有足够的空间，请输入以下命令。</p><pre><code class="language-bash">df -h</code></pre><p title="Output"><span>输出</span></p><pre><code class="language-bash">Filesystem      Size  Used Avail Use% Mounted on  udev            488M     0  488M   0% /dev  tmpfs           100M  4.5M   96M   5% /run  /dev/vda1        25G  989M   23G   5% /  tmpfs           499M     0  499M   0% /dev/shm  tmpfs           5.0M     0  5.0M   0% /run/lock  tmpfs           499M     0  499M   0% /sys/fs/cgroup  tmpfs           100M     0  100M   0% /run/user/1001</code></pre><p><span class="ez-toc-section" id="3-_Creating_a_Swap_File"/> <span> 3-创建一个交换文件</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash"/></pre><h3 id="step-3-–-creating-a-swap-file">现在，您可以在您的文件系统上创建一个交换文件，因为您知道您的可用硬盘空间。要创建一个交换文件，使用<span> fallocate </span>程序创建一个指定大小的文件。您需要创建一个1G的文件，而下例中的服务器有1G的RAM。</h3><p>要验证保留的空间量是否正确，请输入以下命令。</p><pre><code class="language-bash">sudo fallocate -l <span>1G</span> /swapfile  </code></pre><p><span>输出</span></p><pre><code class="language-bash">ls -lh /swapfile</code></pre><p title="Output"><strong> <span> <a href="https://eldernode.com/linux-vps/">购买Linux虚拟专用服务器</a> </span> </strong></p><pre><code class="language-bash">-rw-r--r-- 1 root root 1.0G May 29 17:34 /swapfile</code></pre><pre><code class="language-bash"/></pre><p> </p><p><span class="ez-toc-section" id="4-_Enabling_the_Swap_File"/> <span> 4-启用交换文件</span>T3】</p><h3 id="step-4-–-enabling-the-swap-file">虽然该文件具有正确的大小，但是您应该将它转换为交换空间。为了让只有拥有<strong> root </strong>权限的用户才能读取内容，锁定文件的权限。</h3><p>使用以下命令，使该文件只能由root用户访问，</p><p>如果您想检查权限更改，请键入下面的命令。</p><pre><code class="language-bash">sudo chmod 600 /swapfil  </code></pre><p><span>输出</span></p><pre><code class="language-bash">ls -lh /swapfile  </code></pre><p title="Output">键入以下命令，将文件标记为交换空间:</p><pre><code class="language-bash"><span>-rw-------</span> 1 root root 1.0G May 29 17:34 /swapfile</code></pre><p><span>输出</span></p><pre><code class="language-bash">sudo mkswap /swapfile  </code></pre><p title="Output">您可以在标记文件后启用交换文件，以允许系统开始使用它。</p><pre><code class="language-bash">Setting up swapspace version 1, size = 1024 MiB (1073737728 bytes)  no label, UUID=b591444e-c12b-45a6-90fc-e8b24c67c006f</code></pre><p>要检查交换是否可用，请输入以下命令。</p><pre><code class="language-bash">sudo swapon /swapfile</code></pre><p><span>输出</span></p><pre><code class="language-bash">sudo swapon --show  </code></pre><p title="Output">您可以再次检查<span> free </span>实用程序的输出来证实您的发现:</p><pre><code class="language-bash">NAME      TYPE  SIZE USED PRIO  /swapfile file 1024M   0B   -2</code></pre><p><span>输出</span></p><pre><code class="language-bash">free -h  </code></pre><p title="Output"><span class="ez-toc-section" id="5-_Making_the_Swap_File_Permanent"/> <span> 5-使交换文件永久</span> <span class="ez-toc-section-end"/></p><pre><code class="language-bash">              total        used        free      shared  buff/cache   available  Mem:          990Mi        37Mi       860Mi       4.0Mi        92Mi       834Mi  <span>Swap:         1.0Gi          0B       1.0Gi</span></code></pre><p>最近的更改为当前会话启用了交换文件。如果重新启动，服务器将不会自动保留交换设置。要改变这一点，将交换文件添加到您的<span> /etc/fstab </span>文件中。</p><pre><code class="language-bash"/></pre><h3 id="step-5-–-making-the-swap-file-permanent">如果你遇到任何问题，备份<span> /etc/fstab </span></h3><p>sudo cp /etc/fstab /etc/fstab.bak</p><p>使用下面的命令，将交换文件信息添加到您的<span> /etc/fstab <span>文件的末尾。</span>T3】</span></p><p><span class="ez-toc-section" id="6-_Tuning_your_Swap_Settings"/> <span> 6-调整您的交换设置</span> <span class="ez-toc-section-end"/></p><p>要配置系统将数据从RAM交换到交换空间的频率，可以使用<span> swappiness </span>参数。您可以看到一个介于0和100之间的值，代表一个百分比。接近100的值会尝试将更多的数据放入交换区，以释放更多的RAM空间。</p><pre><code class="language-bash">echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab  </code></pre><pre><code class="language-bash"/></pre><pre><code class="language-bash"/></pre><h3 id="step-6-–-tuning-your-swap-settings">您可以通过键入以下命令来查看当前的交换度值:</h3><p><span>输出</span></p><p>此外，您可以使用<span> sysctl </span>命令将交换度设置为不同的值。</p><pre><code class="language-bash">cat /proc/sys/vm/swappiness  </code></pre><p title="Output">要将交换度设置为10，您可以键入:</p><pre><code class="language-bash">60</code></pre><p><span>输出</span></p><p>通过将该行添加到您的<span> /etc/sysctl.conf </span>文件中，您可以在重启时自动设置该值</p><pre><code class="language-bash">sudo sysctl vm.swappiness=10  </code></pre><p title="Output">此外，您还可以添加:</p><pre><code class="language-bash">vm.swappiness = 10</code></pre><p><strong> /etc/sysctl.conf </strong></p><pre><code class="language-bash">sudo nano /etc/sysctl.conf</code></pre><p>完成后，保存并关闭文件。</p><p> </p><pre><code class="language-bash">vm.swappiness=10  </code></pre><p>您还可以修改<span> vfs_cache_pressure <span>，以配置系统将选择在多大程度上缓存inode和dentry信息，而不是其他数据。然而，这是关于文件系统的访问数据，查找成本很高，并且经常被请求。再次通过查询</span> </span> <span> proc <span>文件系统来检查当前值:</span> </span></p><p><span>输出</span></p><p>您可以通过键入以下命令将其设置为更保守的值，如50:</p><pre><code class="language-bash">cat /proc/sys/vm/vfs_cache_pressure  </code></pre><p title="Output">此外，您可以通过将它添加到我们的配置文件中来更改它。</p><pre><code class="language-bash">100  </code></pre><p>最后，添加指定新值的行:</p><pre><code class="language-bash">sudo sysctl vm.vfs_cache_pressure=50  </code></pre><p> </p><pre><code class="language-bash">sudo nano /etc/sysctl.conf  </code></pre><p><strong> /etc/sysctl.conf </strong></p><p>完成后，保存并关闭文件。</p><p class="code-label" title="/etc/sysctl.conf"> </p><div title="/etc/sysctl.conf"><pre><code class="language-bash">vm.vfs_cache_pressure=50  </code></pre><p>亲爱的用户，我们希望你会喜欢这个关于如何在Ubuntu 20.04上添加交换空间的教程。你可以在评论区提出关于这个培训的问题，或者解决<a href="https://eldernode.com/blog/"> Eldernode培训</a>领域的其他问题，请参考<a href="https://eldernode.com/ask" target="_blank" rel="noopener noreferrer">提问页面</a>部分并在其中提出你的问题。</p></div><p><strong>同样，参见</strong></p><p><span><a href="https://eldernode.com/how-to-clear-cash-buffer-and-swap-memory-in-linux/">Linux中如何清除缓存缓冲区和交换内存</a> </span></p><p> </p><p> </p><p><strong>Also, see</strong></p><p class="fjpost-title px-0"><span><a href="https://eldernode.com/how-to-clear-cash-buffer-and-swap-memory-in-linux/">How to clear cache buffer and swap memory in Linux</a></span></p></div></div>    
</body>
</html>