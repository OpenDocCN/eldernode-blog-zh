<html>
<head>
<title>How to install Fail2Ban to protect SSH on CentOS 8 - how to protect SSH</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在CentOS 8上安装Fail2Ban保护SSH——如何保护SSH</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/install-fail2ban-centos-8/#0001-01-01">https://blog.eldernode.com/install-fail2ban-centos-8/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/5b7c63f9d76101bd9a75627b3d0d8038.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="How to install Fail2Ban to protect SSH on CentOS 8" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/IMG_2124.png"/><p>最近你复习了一下<span> <a href="https://eldernode.com/set-up-ssh-keys-on-centos-8/" target="_blank" rel="noopener noreferrer">宋承宪</a> </span>。在这篇文章中，你将学习<strong>如何在CentOS 8 </strong>上安装Fail2Ban来保护SSH。但是首先，什么是<strong> Fail2ban。</strong>这是一款免费、开源、广泛使用的入侵防御工具，它扫描日志文件，寻找显示过多密码失败等恶意迹象的<span><a href="https://en.wikipedia.org/wiki/IP_address#:~:text=In%20computer%20science%2C%20an%20Internet,interface%20identification%20and%20location%20addressing." target="_blank" rel="noopener noreferrer"/></span>IP地址，并禁止它们。默认情况下，它附带了各种服务的过滤器，包括<strong> sshd </strong>。</p><p> </p><p> </p><h2><span class="ez-toc-section" id="How_to_install_Fail2Ban_to_protect_SSH_on_CentOS_8"/> <span>如何在CentOS 8 </span> <span class="ez-toc-section-end"/>上安装Fail2Ban保护SSH</h2><p>推荐您阅读<span> <a href="https://eldernode.com/initial-set-up-centos-8/" target="_blank" rel="noopener noreferrer">初始设置centos 8 </a> </span>，让我们指导您更容易地了解如何安装和配置<strong> fail2ban </strong>，以保护<strong> SSH </strong>并提高<strong> SSH </strong>服务器安全性，抵御对<strong> CentOS 8 </strong>的暴力攻击。</p><p/><p/><h3><span class="ez-toc-section" id="Installing_Fail2ban_on_CentOS_8"/> <span>在CentOS 8 </span> <span class="ez-toc-section-end"/>上安装Fail2ban</h3><p>在这一段<strong>，</strong>登录到您的系统后，进入一个命令行界面来启用您系统上的EPEL库。因为<strong>的fail2ban </strong>包不在官方的仓库里，但是在<strong>的EPEL </strong>仓库里有。</p><pre><code class="language-bash">dnf install epel-release  OR  dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</code></pre><p>接下来，使用下面的命令安装<strong> Fail2ban </strong>包。</p><pre><code class="language-bash">dnf install fail2ban  </code></pre><p> </p><p><strong>另外，阅读相关文章</strong>:</p><p class="fjpost-title px-0"><span><a href="https://eldernode.com/difference-between-ssh-and-telnet/" target="_blank" rel="noopener noreferrer">SSH和Telnet的区别</a> </span></p><h3><span class="ez-toc-section" id="Configuring_Fail2ban_to_protect_SSH"/> <span>配置Fail2ban保护SSH </span> <span class="ez-toc-section-end"/></h3><p id="tecmint_incontent" align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><strong> fail2ban </strong>配置文件位于<strong> /etc/fail2ban/ </strong>目录下，过滤器存储在<strong> /etc/fail2ban/filter.d/ </strong>目录下。</p><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">我们不建议您从fail2ban服务器<strong> /etc/fail2ban/jail.conf，</strong>中修改全局配置文件，因为它可能会在将来的软件包升级中被覆盖或改进。</p><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">此外，您可以在<strong> jail.local </strong>文件或单独的<span> <strong>文件中创建和添加您的配置。conf </strong> </span>文件放在<strong> /etc/fail2ban/jail.d/ </strong>目录下作为备用。</p><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">请注意，在<strong> jail.local </strong>中设置的配置参数将覆盖在<strong> jail.conf </strong>中定义的任何参数。</p><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">在<strong> /etc/fail2ban/ </strong>目录下创建一个名为<strong> jail.local </strong>的单独文件。</p><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><pre><code class="language-bash">vi /etc/fail2ban/jail.local</code></pre></div><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">打开文件时，将以下配置粘贴到文件中。</p><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><strong>注意</strong>:<span>【默认】</span>该部分包含全局选项，<span>【sshd】</span>包含sshd监狱的参数。</p><pre data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><code class="language-bash">[DEFAULT] ignoreip = 192.168.56.2/24  bantime  = 21600 findtime  = 300  maxretry = 3  banaction = iptables-multiport  backend = systemd [sshd] enabled = true    </code></pre><p><img data-lazyloaded="1" src="../Images/f59dc1ffe2904b80183d1f6f6971d718.png" decoding="async" loading="lazy" class="aligncenter wp-image-10038 size-full" data-src="https://blog.eldernode.com/wp-content/uploads/2020/08/Fail2ban-Configuration.jpg" alt="Configuration" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/08/Fail2ban-Configuration.jpg 700w, https://blog.eldernode.com/wp-content/uploads/2020/08/Fail2ban-Configuration-300x114.jpg 300w" data-sizes="(max-width: 700px) 100vw, 700px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/08/Fail2ban-Configuration.jpg"/> <br/>现在，我们来看看上面配置中选项的解释:</p><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><ol><li><span> <strong> ignoreip </strong> </span>:指定不禁止的ip地址或主机名列表。</li><li><span> <strong> bantime </strong> </span>:指定主机被禁止的秒数(即有效禁止持续时间)。</li><li><span><strong/></span>:指定主机被禁止之前的失败次数。</li><li><span><strong>find time</strong>:</span>fail 2 ban如果主机在最后的“<strong> findtime </strong>”秒内生成了“<strong> maxretry </strong>”，将会禁止该主机。</li><li><span><strong>b动作</strong> </span>:禁止动作。</li><li><span> <strong>后端</strong> </span>:指定用于获取日志文件修改的后端。</li></ol></div><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><p>所以，上面的配置，意味着如果一个IP在最后的<strong> 5 </strong>分钟内失败<strong> 3 </strong>次，则禁止它<strong> 6 </strong>小时，并忽略IP地址<strong> 192.168.56.2 </strong>。</p><p>首先<strong> <b>、</b> </strong>启动并启用<strong> fail2ban </strong>服务，并使用以下systemctl命令检查它是否启动并运行。</p></div><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><pre><code class="language-bash">systemctl start fail2ban  systemctl enable fail2ban  systemctl status fail2ban</code></pre></div><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><h3><span class="ez-toc-section" id="Monitoring_Failed_and_Banned_IP_Address_Using_fail2ban-client"/> <span>监控失败，禁用IP地址使用fail 2 ban-客户端</span> <span class="ez-toc-section-end"/></h3><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">在这一步中，您可以在配置<strong> fail2ban </strong>来保护<strong> sshd之后，使用<strong> fail2ban-client </strong>来监控失败和被禁止的IP地址。</strong>其次，要查看fail2ban服务器的当前状态，请使用以下命令。</p><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><p>监控<strong> sshd </strong>监狱:</p></div><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><pre><code class="language-bash">fail2ban-client status sshd  </code></pre><figure id="attachment_34414" class="wp-caption aligncenter" aria-describedby="caption-attachment-34414"/></div><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw">接下来，运行下面的命令来解除fail2ban中的IP地址。</p><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><pre><code class="language-bash">fail2ban-client unban 192.168.56.1  </code></pre></div><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><p>但是，有关fail2ban的更多信息，请阅读下面的手册页。</p></div><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><pre><code class="language-bash">man jail.conf  man fail2ban-client</code></pre></div><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><strong> <span>好样的</span> </strong>！至此，您完成了教程的学习。</p><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/><div align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"><p>亲爱的用户，我们希望本教程能对你有所帮助，如果你有任何问题或想查看我们的用户关于本文的对话，请访问</p><span><a href="https://eldernode.com/ask" target="_blank" rel="noopener noreferrer">Ask page</a></span><p>。也为了提高你的知识，有这么多有用的教程准备</p><span><a href="https://eldernode.com/blog/" target="_blank" rel="noopener noreferrer">Eldernode training</a></span><p>.</p></div><p align="center" data-google-query-id="CKrjs8-dgusCFc7B3god9SgEXw"/></div></div>    
</body>
</html>