<html>
<head>
<title>Tutorial Configure MongoDB Remote Access on Ubuntu 20.04 - Eldernode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>教程在Ubuntu 20.04上配置MongoDB远程访问- Eldernode</h1>
<blockquote>原文：<a href="https://blog.eldernode.com/mongodb-remote-ubuntu-20/#0001-01-01">https://blog.eldernode.com/mongodb-remote-ubuntu-20/#0001-01-01</a></blockquote><div><div class="blog-details">                                  <img data-lazyloaded="1" src="../Images/51608271c2e9f0feab4eb304e5c47906.png" data-src="https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957.png" class="img-fluid mb-3 shadow-sm round-10 wp-post-image" alt="Tutorial and Configure MongoDB Remote Access on Ubuntu 20.04" decoding="async" data-srcset="https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957.png 2069w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957-300x164.png 300w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957-1024x561.png 1024w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957-768x421.png 768w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957-1536x842.png 1536w, https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957-2048x1122.png 2048w" data-sizes="(max-width: 2069px) 100vw, 2069px" data-original-src="https://blog.eldernode.com/wp-content/uploads/2020/09/IMG_1957.png"/><p><strong> MongoDB </strong>是现代web应用中使用的开源文档<a href="https://en.wikipedia.org/wiki/Database" target="_blank" rel="noopener noreferrer">数据库</a>。允许来自安装它的同一台服务器的连接。当您决定远程管理MongoDB或将其连接到单独的应用服务器时，您可能会发现需要对默认配置进行一些更改。作为<a href="https://eldernode.com/vps/" target="_blank" rel="noopener noreferrer"> VPS </a>提供商联系Eldernode团队，拥有自己的<a href="https://eldernode.com/linux-vps/" target="_blank" rel="noopener noreferrer"> Linux虚拟服务器</a>。</p><p> </p><p>为了让本教程更好地发挥作用，请考虑以下<strong>先决条件</strong>:</p><div class="fjpost-info"><p> </p><p>当<strong> MongoDB </strong>安装在您的服务器上时，我们认为您已经安装了MongoDB <span class="highlight"> 4.4 </span>或更新版本。你可以按照我们的教程<a href="https://eldernode.com/install-mongodb-ubuntu-20/">如何</a> <a href="https://eldernode.com/install-mongodb-ubuntu-20/">在Ubuntu 20.04 </a>上安装MongoDB来安装这个版本。</p></div><p> </p><p><b>此外</b>，我们<strong>强烈</strong>建议您通过为数据库创建一个管理用户帐户并启用认证来保护您的<strong> MongoDB </strong>安装。为此，请遵循我们的教程<a href="https://eldernode.com/secure-mongodb-ubuntu-20/" target="_blank" rel="noopener noreferrer">如何在Ubuntu 20.04 </a>上保护MongoDB。</p><h2/><p>.</p><h2><span class="ez-toc-section" id="Tutorial_MongoDB_Remote_Access_Configuration_on_Ubuntu_2004"/> <strong>教程Ubuntu 20.04上的MongoDB远程访问配置</strong> <span class="ez-toc-section-end"/></h2><p>加入我们的指南来配置一个<strong> MongoDB </strong>安装，以安全地允许来自可信的远程计算机的访问。为此，您将更新您的防火墙规则，以提供对MongoDB监听连接的端口的远程机器访问，然后更新其配置文件以更改其IP绑定设置。然后，作为最后一步，您将测试您的远程机器是否能够成功地连接到您的数据库。</p><p> </p><p> </p><p> </p><h3 id="step-1-—-adjusting-the-firewall"><span class="ez-toc-section" id="Step_1_Adjusting_the_Firewall"/>第一步:调整防火墙<span class="ez-toc-section-end"/></h3><p>如果您对我们关于<strong>先决条件</strong>和<a href="https://eldernode.com/initial-server-set-up-on-ubuntu-20-04-lts/" target="_blank" rel="noopener noreferrer">在您的服务器</a>上启用了UFW防火墙的请求持肯定态度，您的<strong> MongoDB </strong>安装将无法从互联网上访问。如果您只需要在本地将MongoDB与运行在同一服务器上的应用程序一起使用，请使用这个安全设置。它还可以帮助您从远程位置连接到MongoDB服务器。您可以通过添加一个新的UFW规则来允许传入连接到数据库正在侦听的端口，以便能够从远程位置连接到MongoDB服务器。然而，第一步是用<span> lsof </span>命令检查哪个端口正在监听。您将使用它返回系统中所有打开文件的列表。一旦它与<span> <strong> -i </strong> </span>选项结合，它只列出网络相关的文件或数据流。</p><p>要将<span> lsof -i </span>生成的输出重定向到搜索名为<span> mongo </span>的字符串的<span> grep </span>命令，请运行以下命令:</p><p>以下命令将</p><pre><code class="language-bash">sudo lsof -i | grep mongo</code></pre><p>这个示例输出显示MongoDB正在监听其默认端口27017上的连接:</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">mongod    82221         mongodb   11u  IPv4 913411      0t0  TCP localhost:<span>27017</span> (LISTEN)  </code></pre><p>正如您所猜测的，我们只能从某些可信的位置访问MongoDB，类似于托管应用程序的另一个服务器。要对此进行配置，请在MongoDB服务器上键入以下命令，这会打开对MongoDB默认端口的访问，同时显式地只允许其他受信任服务器的IP地址。当您运行以下命令时，请确保将<span><strong>trusted _ server _ ip</strong></span>更改为您将用来访问MongoDB实例的可信远程机器的IP地址:</p><pre><code class="language-bash">sudo ufw allow from <span>trusted_server_ip</span> to any port <span>27017</span></code></pre><p><span class="note"> <strong>请注意</strong>:如果您看到您安装的MongoDB正在监听来自</span>上一个命令输出的非默认端口，您可以使用 <span class="note">端口号来代替这个命令中的</span> <span> <strong> 27017 </strong> </span> <span class="note">。</span></p><p>每当您需要从另一台机器访问MongoDB时，再次使用这个命令，用新机器的IP地址代替trusted_server_ip。</p><p>您可以使用<span> ufw </span>验证防火墙设置的变化:</p><pre><code class="language-bash">sudo ufw status</code></pre><p>正如您在输出中看到的，现在允许从远程服务器到端口<span> <strong> 27017 </strong> </span>的流量:</p><p title="Output"><span>输出</span></p><pre><code class="language-bash">Status: active    To                         Action      From  --                         ------      ----  OpenSSH                    ALLOW       Anywhere  27017                      ALLOW       <span>trusted_server_ip</span>  OpenSSH (v6)               ALLOW       Anywhere (v6)  </code></pre><p>继续和我们一起将MongoDB绑定到服务器的公共IP地址，向您展示如何从您的远程机器访问它。如果需要查找自己的IP地址，可以看Linux教程上的<a href="https://eldernode.com/find-server-public-ip-linux/" target="_blank" rel="noopener noreferrer">查找IP地址。</a></p><p> </p><p class="fjpost-info"/><p/><p/><h3 id="step-2-—-configuring-a-public-bindip"><span class="ez-toc-section" id="Step_2_How_to_Configuring_a_Public_bindIP"/>步骤2:如何配置公共bindIP <span class="ez-toc-section-end"/></h3><p>请注意，MongoDB只能接受来自安装它的服务器的连接，因此，MongoDB当前绑定到<span> 127.0.0.1 </span>，即使端口是打开的，也是本地环回网络接口。</p><p>尝试编辑MongoDB配置文件— <span> /etc/mongod.conf </span> —以额外将MongoDB绑定到您的服务器的可公开路由的IP地址，从而允许远程连接。之后，您的MongoDB安装将能够监听从远程机器到MongoDB服务器的连接。</p><p>在您喜欢的文本编辑器中打开MongoDB配置文件。下面的例子使用了<span> nano </span>:</p><pre><code class="language-bash">sudo nano /etc/mongod.conf</code></pre><p>找到<span>网络接口</span>部分，然后找到<span>绑定Ip </span>值:</p><pre><code class="language-bash">. . .  # network interfaces  net:    port: 27017    bindIp: 127.0.0.1    . . .  </code></pre><p>在这一行后面添加一个逗号，然后是MongoDB服务器的公共IP地址:</p><pre><code class="language-bash">. . .  # network interfaces  net:    port: 27017    bindIp: 127.0.0.1<span>,mongodb_server_ip</span>    . . .  </code></pre><p>现在，您可以保存并关闭文件。如果你用的是<span> nano </span>，按下<span> CTRL + X </span>、<span> Y </span>，然后<span>回车</span>即可。</p><p>然后，重新启动MongoDB以使这一更改生效:</p><pre><code class="language-bash">sudo systemctl restart mongod</code></pre><p>接下来，您的<strong> MongoDB </strong>安装将能够接受来自您允许访问端口<span> 27017 </span>的任何机器的远程连接。尝试测试您在步骤1中允许通过防火墙的受信任的远程服务器是否可以到达您的服务器上运行的MongoDB实例。</p><h2/><p> </p><p> </p><h3 id="step-3-—-testing-remote-connectivity"><span class="ez-toc-section" id="Step_3_How_to_Testing_Remote_Connectivity"/>步骤3:如何测试远程连接<span class="ez-toc-section-end"/></h3><p>既然您已经配置了您的<strong> MongoDB </strong>安装来监听连接。源自其可公开路由的IP地址。并允许你的远程机器通过你服务器的防火墙访问Mongo的默认端口。您可以测试远程机器是否能够连接。</p><p><span class="note"> <strong>请注意</strong>:如先决条件一节所述，本教程假设你的远程机器是另一台运行Ubuntu 20.04的服务器。无论您的远程机器运行什么操作系统，步骤1和2中概述的启用远程连接的过程都应该有效。但是这一步中描述的测试方法并不能在所有操作系统中通用。<br/> </span></p><p>测试可信远程服务器是否能够连接到MongoDB实例的一种方法是使用<span> <strong> nc </strong> </span>命令。<span> <strong> nc </strong> </span>，netcat的简称，是一个用来与TCP或UDP建立网络连接的实用程序。这对于这种情况下的测试很有用。因为它允许您指定IP地址和端口号。</p><p>首先，使用SSH登录到您信任的服务器:</p><pre><code class="language-bash">ssh <span class="highlight">noodi</span>@<span class="highlight">trusted_server_ip</span></code></pre><p>然后运行下面的<span> nc </span>命令，其中包含了<span> -z </span>选项。这限制了<span> nc </span>只扫描目标服务器上的监听守护进程，而不向它发送任何数据。回想一下<a href="https://eldernode.com/install-mongodb-ubuntu-20/">先决条件安装教程</a>，MongoDB是作为一个服务守护进程运行的，这使得这个选项对于测试连通性非常有用。它还包括<span> v </span>选项，该选项增加了命令的冗长性，导致netcat返回一些本来不会返回的输出。</p><p>从您信任的远程服务器运行下面的<span> nc </span>命令<strong>，确保将<span> mongodb_server_ip </span>替换为您安装mongodb的服务器的ip地址:</strong></p><pre><code class="language-bash">nc -zv <span class="highlight">mongodb_server_ip</span> 27017</code></pre><h4/><p>如果受信任的服务器可以访问MongoDB守护进程，其输出将表明连接成功:</p><p><span>输出</span></p><pre><code class="language-bash">Connection to mongodb_server_ip 27017 port [tcp/*] succeeded!  </code></pre><p>假设您在远程服务器上安装了兼容版本的<span> mongo </span> shell，那么此时您可以直接连接到安装在主机服务器上的MongoDB实例。</p><p>一种连接方式是使用连接字符串URI，如下所示:</p><pre><code class="language-bash">mongo "mongodb://<span class="highlight">mongo_server_ip</span>:27017"</code></pre><p><strong>请注意</strong>:如果你遵循了推荐的<a href="https://blog.eldernode.com/secure-mongodb-ubuntu-20/" target="_blank" rel="noopener noreferrer">如何在Ubuntu 20.04上保护MongoDB</a>教程，你将会关闭未经认证的用户对你的数据库的访问。在这种情况下，您需要使用指定有效用户名的URI，如下所示:</p><pre><code class="language-bash">mongo "mongodb://<span class="highlight">username</span>@<span class="highlight">mongo_server_ip</span>:27017"</code></pre><p>shell会自动提示您输入用户密码。</p><p>至此，您已经确认了您的MongoDB服务器可以接受来自可信服务器的连接。</p><p> </p><h2><span class="ez-toc-section" id="Conclusion"/>结论<span class="ez-toc-section-end"/></h2><p>在本文中，您学习了“Ubuntu 20.04上的MongoDB远程访问配置”。此时，您可以从受信任的服务器远程管理您的Mongo数据库。或者，您可以将应用程序配置为在受信任的服务器上运行，并远程使用数据库。</p></div></div>    
</body>
</html>